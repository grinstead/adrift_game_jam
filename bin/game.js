'use strict';class u{constructor(a,b,c){this.name=c;this.h=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.h}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.h}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function v(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new u(c[1],c[2],c[3]))});return b}
const x=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function y(a,b){a.a.uniformMatrix4fv(a.c,!1,b);a.b.push(b)}function C(a,b,c,e=0){var d=a.b;d=d[d.length-1]||x;y(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}class D{constructor(a,b){this.a=a;this.c=b;this.b=[];a.uniformMatrix4fv(b,!1,x)}pop(){return this.b.pop()}}
class E{constructor(a,b){this.name=a.name;var c=this.a=a.a;a=this.type=a.type;switch(a){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.b=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.u=v(b)}}
function F(a,...b){const c=a.a,e=a.j;b.forEach(d=>{a.o.push(d);c.attachShader(e,d.b)});return a}function G(a,b){a.g.includes(b)||a.g.push(b);requestAnimationFrame(a.D)}
class H{constructor(a){this.name=a.name;this.l=a.l;a=this.a=a.a;this.s=!1;this.j=a.createProgram();this.o=[];this.c={};this.b={};this.stack=null;this.g=[];this.D=()=>{var b=this.a,c=this.j;b.useProgram(c);for(var e={},d={},g=this.o,f=0;f<g.length;f++)for(var n=g[f].u,p=0;p<n.length;p++){var l=n[p];1===l.type?l.h in e||(e[l.name]=b.getUniformLocation(c,l.h)):l.h in d||(d[l.name]=b.getAttribLocation(c,l.h))}this.c=e;this.b=d;if(c=this.l)if(c in this.c)this.stack=new D(b,this.c[c]);else throw Error(`No anchor point "${c}" in program`);
try{var r=this.g;this.g=[];for(f=0;f<r.length;r++)r[f](b,this)}finally{this.c={},this.b={},this.stack=null}}}link(){if(this.s)return this;var a=this.a,b=this.j;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.s=!0;return this}}
class Q{constructor(a,b,c,e,d){this.a=a;this.name=b;this.w=c;this.f=e;b=this.b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);d(a);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,null)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}
function R(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new Q(a.a,a.name,c,e,d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)})})}function S(a){const b=a.width,c=a.height;return new Q(a.a,a.name,b,c,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.A,0)})};function T(a,b){const c=a.b.a;let e=a.c;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.c=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.g,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.b.bindTexture();c.uniform1i(b.c.texture,0);c.enableVertexAttribArray(b.b.texturePosition);c.vertexAttribPointer(b.b.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.b.position);c.vertexAttribPointer(b.b.position,3,c.FLOAT,!1,20,0)}
function U(a,b){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.b.a;a.drawArrays(a.TRIANGLE_STRIP,b.v[0],b.F)}
class V{constructor(a,b){this.b=a;this.c=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],f=[],n=g.length;if(0===n)throw Error("Sprite declared with 0 points");const p=g[0].length;if(0==p)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=p/5;for(let r=0;r<n;r++){const t=g[r];if(t.length!==p)throw Error("Sprite declared with inconsistent lengths of elements");f.push(e);c.push.apply(c,t);e+=l}a[d]={G:this,name:d,v:f,F:l}}this.g=new Float32Array(c)}}
;function W(){const a=new Uint8Array(4096),b=(d,g)=>{d/=360;g/=360;return d*d+g*g},c=Math.min(b(16,0),b(16,0));for(let d=0;32>d;d++)for(let g=0;32>g;g++){const f=4*(32*d+g),n=b(g-16,d-16);if(1E-4>=n)a[f]=255,a[f+1]=255,a[f+2]=255,a[f+3]=255;else{var e=Math.sqrt(1E-4/n);const p=Math.floor(256*e);e=Math.floor(256*e*e);a[f]=255;a[f+1]=e;a[f+2]=e;a[f+3]=n>=c?0:p}}return a}
window.onload=async function(){function a(q,m){q=Date.now();const w=(q-I)/1E3;I=q;b.innerHTML=`fps=${Math.round(1/w)}`;y(m.stack,X);q=(q-Y)/1E3;const Z=Math.floor(10*q)-Math.floor(10*J);for(let k=0;k<Z;k++){var z=(Math.random()-.5)*Math.PI/4+Math.PI/2;const K=2*Math.random()+1,aa=4+285/360,ba=(t.f-110)/360,ca=K*Math.sin(z);z=K*Math.cos(z);100<A.length&&A.shift();A.push({x:aa,y:0,z:ba,B:z,C:.1*Math.sin(2*Math.PI*Math.random()),i:ca})}J=q;C(m.stack,Math.sin(q/4)-1.5,0,h.d/2+h.f);T(L,m);U(L,"main");
T(M,m);U(M,"main");C(m.stack,4,0,0);T(N,m);U(N,"idle");m.stack.pop();T(B,m);A.forEach(k=>{0<=k.z&&(k.i-=9.8*w,k.x+=k.B*w,k.y+=k.C*w,k.z+=k.i*w,C(m.stack,k.x,k.y,k.z),U(B,"main"),m.stack.pop())});m.stack.pop();T(B,m);C(m.stack,O/180,0,(g-P)/180);U(B,"main");G(m,a)}const b=document.getElementById("fps"),c=document.getElementById("canvas");var e=window.getComputedStyle(c);let d=parseInt(e.getPropertyValue("width"),10),g=parseInt(e.getPropertyValue("height"),10);e=window.devicePixelRatio||1;1!==e&&(c.width=
e*d,c.height=e*g);var f=c.getContext("webgl2",{antialias:!1,alpha:!1});f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.enable(f.DEPTH_TEST);f.depthFunc(f.LEQUAL);const n=new E({a:f,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n        float variance = 1.f / (position.z + 1.f);\n\n        vec4 result = vec4(position.x, position.y * variance, -.5f * (position.z - 1.f) * variance, variance);\n        gl_Position = result;\n\n        v_texturePosition = a_texturePosition;\n    }\n"),
p=new E({a:f,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }\n");e=new H({a:f,l:"projection"});F(e,n,p).link();const [l,r,t]=await Promise.all([R({a:f,src:"assets/Background Wall.png",name:"wall"}),R({a:f,
src:"assets/Floor 2.png",name:"floor"}),R({a:f,src:"assets/Hero Breathing0001.png",name:"idle"})]),h={w:r.w/360,f:34/360,d:175/360,m:175/209},L=new V(l,{main:[[l.w/360,-h.d/2,l.f/360,1,0,l.w/360,-h.d/2,0,1,1,0,-h.d/2,l.f/360,0,0,0,-h.d/2,0,0,1]]}),M=new V(r,{main:[[h.w,h.d/2,-h.f,1,1,0,h.d/2,-h.f,0,1,h.w,h.d/2,0,1,h.m,0,h.d/2,0,0,h.m,h.w,-h.d/2,0,1,0,0,-h.d/2,0,0,0]]}),N=new V(t,{idle:[[t.w/360,0,t.f/360,1,0,t.w/360,0,0,1,1,0,0,t.f/360,0,0,0,0,0,0,1]]});f=S({name:"fade",width:32,height:32,a:f,A:W()});
const B=new V(f,{main:[[16/360,0,-16/360,1,0,16/360,0,16/360,1,1,-16/360,0,-16/360,0,0,-16/360,0,16/360,0,1]]});let O=0,P=0;const X=new Float32Array([360/d,0,0,0,0,-360/g,.25,0,0,360/g,0,0,-1,-1,0,1]),A=[];let Y=Date.now(),I=Date.now(),J=0;G(e,a);c.onmousemove=q=>{O=q.offsetX;P=q.offsetY}};
