'use strict';class x{constructor(c,a,b){this.name=b;this.i=`${a}${b}`;switch(c){case "uniform":this.type=1;if("u_"!==a)throw Error(`uniform field "${this.i}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==a)throw Error(`in field "${this.i}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function y(c){const a=[];c.split("\n").forEach(b=>{(b=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(b))&&a.push(new x(b[1],b[2],b[3]))});return a}
const z=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function A(c,a){c.a.uniformMatrix4fv(c.c,!1,a);c.b.push(a)}function D(c,a,b,e=0){var d=c.b;d=d.length?d[d.length-1]:z;A(c,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],a*d[0]+b*d[4]+e*d[8]+d[12],a*d[1]+b*d[5]+e*d[9]+d[13],a*d[2]+b*d[6]+e*d[10]+d[14],a*d[3]+b*d[7]+e*d[11]+d[15]]))}
function E(c,a){var b=Math.cos(a);a=Math.sin(a);b=new Float32Array([b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1]);a=c.b;0===a.length?A(c,b):(a=a[a.length-1],A(c,new Float32Array([b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],b[8]*
a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15]])))}class I{constructor(c,a){this.a=c;this.c=a;this.b=[];c.uniformMatrix4fv(a,!1,z)}pop(){return this.b.pop()}}
class J{constructor(c,a){this.name=c.name;var b=this.a=c.a;c=this.type=c.type;switch(c){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${c}"`);}e=this.b=b.createShader(e);b.shaderSource(e,a);b.compileShader(e);if(!b.getShaderParameter(e,b.COMPILE_STATUS))throw a=`Failed to compile ${this.name} ${c}-shader: ${b.getShaderInfoLog(e)}`,b.deleteShader(e),Error(a);this.D=y(a)}}
function aa(c,...a){const b=c.a,e=c.l;a.forEach(d=>{c.u.push(d);b.attachShader(e,d.b)});return c}function K(c,a){c.g.includes(a)||c.g.push(a);requestAnimationFrame(c.I)}
class ba{constructor(c){this.name=c.name;this.m=c.m;c=this.a=c.a;this.v=!1;this.l=c.createProgram();this.u=[];this.c={};this.b={};this.stack=null;this.g=[];this.I=()=>{var a=this.a,b=this.l;a.useProgram(b);for(var e={},d={},h=this.u,f=0;f<h.length;f++)for(var n=h[f].D,p=0;p<n.length;p++){var k=n[p];1===k.type?k.i in e||(e[k.name]=a.getUniformLocation(b,k.i)):k.i in d||(d[k.name]=a.getAttribLocation(b,k.i))}this.c=e;this.b=d;if(b=this.m)if(b in this.c)this.stack=new I(a,this.c[b]);else throw Error(`No anchor point "${b}" in program`);
try{var q=this.g;this.g=[];for(f=0;f<q.length;q++)q[f](a,this)}finally{this.c={},this.b={},this.stack=null}}}link(){if(this.v)return this;var c=this.a,a=this.l;c.linkProgram(a);if(!c.getProgramParameter(a,c.LINK_STATUS)){var b=`Failed to link ${this.name} program: ${c.getProgramInfoLog(a)}`;c.deleteProgram(a);throw Error(b);}this.v=!0;return this}}
class L{constructor(c,a,b,e,d){this.a=c;this.name=a;this.w=b;this.f=e;a=this.b=c.createTexture();c.bindTexture(c.TEXTURE_2D,a);d(c);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,null)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}
function M(c){return(new Promise((a,b)=>{const e=new Image;e.onload=()=>void a(e);e.onerror=()=>{b(Error(`failed to load ${c.src}`))};e.mode="no-cors";e.src=c.src})).then(a=>{const b=a.naturalWidth,e=a.naturalHeight;return new L(c.a,c.name,b,e,d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,e,0,d.RGBA,d.UNSIGNED_BYTE,a)})})}function ca(c){const a=c.width,b=c.height;return new L(c.a,c.name,a,b,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a,b,0,e.RGBA,e.UNSIGNED_BYTE,c.G,0)})};function W(c,a){const b=c.b.a;let e=c.c;null!=e?b.bindBuffer(b.ARRAY_BUFFER,e):(c.c=e=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,e),b.bufferData(b.ARRAY_BUFFER,c.g,b.STATIC_DRAW));b.activeTexture(b.TEXTURE0);c.b.bindTexture();b.uniform1i(a.c.texture,0);b.enableVertexAttribArray(a.b.texturePosition);b.vertexAttribPointer(a.b.texturePosition,2,b.FLOAT,!1,20,12);b.enableVertexAttribArray(a.b.position);b.vertexAttribPointer(a.b.position,3,b.FLOAT,!1,20,0)}
function X(c,a,b){if(!c.data.hasOwnProperty(a))throw Error(`Can not render unknown "${a}"`);a=c.data[a];c=c.b.a;c.drawArrays(c.TRIANGLE_STRIP,a.F[b],a.J)}
class Y{constructor(c,a){this.b=c;this.c=null;c=this.data={};const b=[];let e=0;for(const d in a){const h=a[d],f=[],n=h.length;if(0===n)throw Error("Sprite declared with 0 points");const p=h[0].length;if(0==p)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const k=p/5;for(let q=0;q<n;q++){const t=h[q];if(t.length!==p)throw Error("Sprite declared with inconsistent lengths of elements");f.push(e);b.push.apply(b,t);e+=k}c[d]={O:this,name:d,F:f,J:k}}this.g=new Float32Array(b)}}
;function da(){const c=new Uint8Array(4096),a=(d,h)=>{d/=360;h/=360;return d*d+h*h},b=Math.min(a(16,0),a(16,0));for(let d=0;32>d;d++)for(let h=0;32>h;h++){const f=4*(32*d+h),n=a(h-16,d-16);if(1E-4>=n)c[f]=255,c[f+1]=255,c[f+2]=255,c[f+3]=255;else{var e=Math.sqrt(1E-4/n);const p=Math.floor(256*e);e=Math.floor(256*e*e);c[f]=255;c[f+1]=e;c[f+2]=e;c[f+3]=n>=b?0:p}}return c}
function Z({x:c=0,y:a=0,z:b=0,width:e,height:d,C:h,B:f,A:n,count:p}){const k=[];for(let q=0;q<p;q++){const t=Math.floor(q/n),u=q%n;k.push(ea({x:c,y:a,z:b,width:e,height:d,M:u*h,K:(u+1)*h,N:t*f,L:(t+1)*f}))}return k}function ea({x:c=0,y:a=0,z:b=0,width:e,height:d,M:h,N:f,K:n,L:p}){return[e-c,a,-b,n,p,-c,a,-b,h,p,e-c,a,d-b,n,f,-c,a,d-b,h,f]}
window.onload=async function(){function c(r,m){r=Date.now();const v=(r-N)/1E3;N=r;a.innerHTML=`fps=${Math.round(1/v)}`;A(m.stack,fa);r=(r-ha)/1E3;var F=Math.floor(10*r)-Math.floor(10*w);for(var B=0;B<F;B++){var G=(Math.random()-.5)*Math.PI/4+Math.PI/2;const g=2*Math.random()+1;var C=4-O/2+282/360;const ia=326/360,ja=g*Math.sin(G);G=g*Math.cos(G);100<H.length&&H.shift();H.push({s:!1,x:C,y:0,z:ia,j:G,H:.1*Math.sin(2*Math.PI*Math.random()),h:ja})}w=r;D(m.stack,-1.5,0,l.d/2+l.f+.5);F=Math.sin(Math.PI*
(w+0)/8)/2+Math.sin(Math.PI*(w+0)/3)/8;B=Math.sin(Math.PI*(w+170)/8)/2+Math.sin(Math.PI*(w+130)/3)/8;C=Math.asin((F-B)/100);E(m.stack,C);D(m.stack,0,0,(F+B)/2);const ka=Math.cos(C),la=Math.sin(C);W(P,m);X(P,"main",0);W(Q,m);X(Q,"main",0);D(m.stack,4,0,0);W(R,m);X(R,"idle",Math.floor(12*r)%16);m.stack.pop();W(S,m);H.forEach(g=>{g.s||(g.h-=9.8*ka*v,g.j-=9.8*la*v,g.x+=g.j*v,g.y+=g.H*v,g.z+=g.h*v,0>g.z?(g.z=-g.z,g.h*=-.25):.01>g.z&&.1>Math.abs(g.h)&&(g.s=!0),D(m.stack,g.x,g.y,g.z),X(S,"main",0),m.stack.pop())});
m.stack.pop();m.stack.pop();m.stack.pop();D(m.stack,T/180,0,(h-U)/180);r=Math.floor(8*r)%38;W(V,m);X(V,"blink",6>r?r:0);K(m,c)}const a=document.getElementById("fps"),b=document.getElementById("canvas");var e=window.getComputedStyle(b);let d=parseInt(e.getPropertyValue("width"),10),h=parseInt(e.getPropertyValue("height"),10);e=window.devicePixelRatio||1;b.width=e*d;b.height=e*h;var f=b.getContext("webgl2",{antialias:!1,alpha:!1});f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.enable(f.DEPTH_TEST);
f.depthFunc(f.LEQUAL);const n=new J({a:f,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n        float variance = 1.f / (position.z + 1.f);\n\n        vec4 result = vec4(position.x, position.y * variance, -.5f * (position.z - 1.f) * variance, position.w * variance);\n        gl_Position = result;\n\n        v_texturePosition = a_texturePosition;\n    }\n"),
p=new J({a:f,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }\n");e=new ba({a:f,m:"projection"});aa(e,n,p).link();const [k,q,t,u]=await Promise.all([M({a:f,src:"assets/Back Wall.png",name:"wall"}),M({a:f,
src:"assets/Floor 2.png",name:"floor"}),M({a:f,src:"assets/Hero Breathing.png",name:"idle"}),M({a:f,src:"assets/Enemy.png",name:"enemy"})]),l={w:q.w/360,f:34/360,d:175/360,o:175/209},P=new Y(k,{main:[[k.w/360,-l.d/2,k.f/360,1,0,k.w/360,-l.d/2,0,1,1,0,-l.d/2,k.f/360,0,0,0,-l.d/2,0,0,1]]}),Q=new Y(q,{main:[[l.w,l.d/2,-l.f,1,1,0,l.d/2,-l.f,0,1,l.w,l.d/2,0,1,l.o,0,l.d/2,0,0,l.o,l.w,-l.d/2,0,1,0,0,-l.d/2,0,0,0]]}),O=296/360,R=new Y(t,{idle:Z({x:O/2,width:296/360,height:434/360,C:296/t.w,B:434/t.f,A:6,
count:16})});f=ca({name:"fade",width:32,height:32,a:f,G:da()});const V=new Y(u,{blink:Z({x:.15,width:.3,height:.3,C:108/u.w,B:108/u.f,A:2,count:6})}),S=new Y(f,{main:[[16/360,0,-16/360,1,0,16/360,0,16/360,1,1,-16/360,0,-16/360,0,0,-16/360,0,16/360,0,1]]});let T=0,U=0;const fa=new Float32Array([360/d,0,0,0,0,-360/h,.25,0,0,360/h,0,0,-1,-1,0,1]),H=[];let ha=Date.now(),N=Date.now(),w=0;K(e,c);b.onmousemove=r=>{T=r.offsetX;U=r.offsetY}};
