'use strict';class aa{constructor(a,b,c){this.name=c;this.G=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.G}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.G}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ha(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new aa(c[1],c[2],c[3]))});return b}
const ia=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function ja(a,b){a.f.uniformMatrix4fv(a.j,!1,b);a.a.push(b)}function E(a,b,c,e=0){var d=a.a;d=d.length?d[d.length-1]:ia;ja(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function H(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ka{constructor(a,b){this.f=a;this.j=b;this.a=[];a.uniformMatrix4fv(b,!1,ia)}pop(){return this.a.pop()}push(a){var b=this.a;0===b.length?ja(this,a):(b=b[b.length-1],ja(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class I{constructor(a,b){this.name=a.name;var c=this.f=a.f;a=this.type=a.type;switch(a){case "vertex":var e=this.f.VERTEX_SHADER;break;case "fragment":e=this.f.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.a=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.Da=ha(b)}}
function la(a,...b){const c=a.f,e=a.ea;b.forEach(d=>{a.pa.push(d);c.attachShader(e,d.a)});return a}class ma{constructor(a){this.name=a.name;this.I=a.I;a=this.f=a.f;this.a=!1;this.ea=a.createProgram();this.pa=[];this.A={};this.C={};this.stack=null}link(){if(this.a)return this;var a=this.f,b=this.ea;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.a=!0;return this}}
function na(a,b){var c=a.f,e=a.ea;c.useProgram(e);for(var d={},h={},k=a.pa,f=0;f<k.length;f++)for(var g=k[f].Da,l=0;l<g.length;l++){var n=g[l];1===n.type?n.G in d||(d[n.name]=c.getUniformLocation(e,n.G)):n.G in h||(h[n.name]=c.getAttribLocation(e,n.G))}a.A=d;a.C=h;if(e=a.I)if(e in a.A)a.stack=new ka(c,a.A[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.A={},a.C={},a.stack=null}}
class qa{constructor(a,b,c,e,d){this.f=a;this.name=b;this.w=c;this.i=e;this.a=d(a)}bindTexture(){this.f.bindTexture(this.f.TEXTURE_2D,this.a)}}function ra(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new qa(a.f,a.name,c,e,sa(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function ta(a){const b=a.width,c=a.height;return new qa(a.f,a.name,b,c,sa(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.qa,0)}))}function ua(a){return new qa(a.f,a.name,a.width,a.height,()=>a.O)}
function sa(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);return c}};function K(a,b){const c=a.a.f;let e=a.j;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.j=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.F,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(b.A.texture,0);c.enableVertexAttribArray(b.C.texturePosition);c.vertexAttribPointer(b.C.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.C.position);c.vertexAttribPointer(b.C.position,3,c.FLOAT,!1,20,0)}
function O(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.a.f;const e=b.fa;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Xa)}
class R{constructor(a,b){this.a=a;this.j=null;a=this.data={};const c=[];let e=0;for(const d in b){const h=b[d],k=[],f=h.length;if(0===f)throw Error("Sprite declared with 0 points");const g=h[0].length;if(0==g)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=g/5;for(let n=0;n<f;n++){const t=h[n];if(t.length!==g)throw Error("Sprite declared with inconsistent lengths of elements");k.push(e);c.push.apply(c,t);e+=l}a[d]={nb:this,name:d,fa:k,Xa:l}}this.F=new Float32Array(c)}}
function va(a,b){for(var c=a.B;-1!==c&&c<=b;){c=a.F;const e=a.a+1;e===c.length?a.j===a.Ua?a.B=c=-1:(a.j++,a.a=0,a.B=c=b+c[0]):(a.a=e,a.B=c=b+c[e])}}function T(a,b,c){if(!a.Sa.includes(b))throw Error(`${a} does not have mode ${b}`);a.j=0;a.da=b;a.a=0;a.B=c+a.F[0]}function wa(a,b){const c=a.da;if(null==c)throw Error(`${a} tried rendering while inactive`);K(a.ta,b);O(a.ta,c,a.a)}
class xa{constructor(a,b){const c=a.v;this.V=a.name;this.Sa=a.Z;this.da=null;this.Ua="number"===typeof c?c:c?-1:0;this.ta=a.set;this.F=b;this.j=0;this.B=this.a=-1;this.Ra=a.Za}U(){const a=this.Ra;return null!=a?a[this.a]:void 0}name(){return this.V}toString(){return`Sprite/${this.V}`}}
function ya(a){const b=a.name,c=a.u,e=a.set.data;let d=-1;a.Z.forEach(k=>{const f=e[k];if(!f)throw Error(`Sprite/${b} has non-existent mode ${k}`);if(-1===d)d=f.fa.length;else if(d!==f.fa.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);if(a.U&&a.U.length!==d)throw Error(`Sprite/${b} given ${a.U.length} frame data points for ${d} frames`);
const h="number"===typeof c?Array(d).fill(c):c;return()=>new xa(a,h)}function V({x:a=0,y:b=0,z:c=0,width:e,height:d,ca:h,ba:k,$:f,count:g,sb:l=0,tb:n=0,ub:t=h,rb:y=k,N:v=!1}){const z=[];for(let r=0;r<g;r++){const w=l+r%f*t,L=n+Math.floor(r/f)*y;z.push(Ha({x:a,y:b,z:c,width:e,height:d,hb:w,fb:w+h,ib:L,gb:L+k,N:v}))}return z}function Ha({x:a=0,y:b=0,z:c=0,width:e,height:d,hb:h,ib:k,fb:f,gb:g,N:l=!1}){l?(l=f,f=a-e):(l=h,h=f,f=-a,a=e-a);return[a,b,-c,h,g,f,b,-c,l,g,a,b,d-c,h,k,f,b,d-c,l,k]};function W(a,b,c){a=a.j;null!=c?a.set(b,c):a.delete(b)}function X(a,b){b=a.j.get(b);const c=a.a;return!!b&&!!b.some(e=>(e=c.get(e))?(e.R=0,null!=e.W):!1)}function Ia(a){const b=a.j.get("showLights");if(b){const c=a.a;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.R,d.R=0,e):e,0)}return 0}function Ja(a,b,c){b=X(a,b)?1:0;return(X(a,c)?1:0)-b}
class Ka{constructor(a){this.a=new Map;this.j=new Map;a.addEventListener("keydown",b=>{La(this,b,!0)});a.addEventListener("keyup",b=>{La(this,b,!1)});a.onblur=()=>{this.a.clear()};a.onfocus=()=>{this.a.clear()}}}function La(a,b,c){b=b.key;a=a.a;const e=a.get(b);c?null==e?a.set(b,{W:Date.now(),R:1}):(null==e.W&&(e.W=Date.now()),e.R++):null!=e&&(e.W=null)};function Ma(a,b){const c=a.a.f,e=a.j;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.V);c.viewport(0,0,e.w,e.i);na(a.a,(d,h)=>{Na(d,h,a,b)})}
class Oa{constructor(a,b,c,e){b/=4;c/=4;var d=new I({f:a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),h=
new I({f:a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const k=new ma({f:a,I:"projection"});la(k,d,h).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);h=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,h);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=ta({name:"fade",width:64,height:64,f:a,qa:Pa(e)});this.a=k;this.j=ua({O:d,name:"lighting",
width:b,height:c,f:a});this.V=h;this.F=new R(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Na(a,b,c,e){e.Ta?a.clearColor(0,0,0,1):a.clearColor(0,0,0,window.a);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.$a(a,b,()=>{const d=c.F;K(d,b);const h=b.A.threshold,k=e.jb;e.Ya.forEach(f=>{if(!f.m){var g=f.startTime;g=(k-g)/(f.sa-g);a.uniform1f(h,.5*g*g);E(b.stack,f.x,f.y,f.z);O(d,"main",0);b.stack.pop()}})})}
function Pa(a){const b=new Uint8Array(16384),c=(h,k)=>{h/=a;k/=a;return h*h+k*k},e=Math.min(c(32,0),c(32,0));for(let h=0;64>h;h++)for(let k=0;64>k;k++){const f=4*(64*h+k);var d=c(k-32,h-32);const g=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const l=Math.max(Math.round(255*g*g),0);b[f]=d+Math.max(Math.round(20*g),0);b[f+1]=d;b[f+2]=d;b[f+3]=l}return b};function Qa(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Y=434/1.8;class Ra{constructor(a){this.l=a}}
async function Sa(a){const [b,c,e]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Ta({name:"hero_idle",O:b,ma:405,ha:434,na:220,oa:434,ga:16,v:!0,u:1/12,T:[{g:388,h:104,b:385,c:170},{g:792,h:105,b:790,c:170},{g:1198,h:105,b:1195,c:169},{g:1602,h:106,b:1600,c:170},{g:2008,h:106,b:2005,c:172},{g:388,h:539,b:385,c:604},{g:794,h:540,b:790,c:605},{g:1196,h:539,b:1196,c:604},{g:1602,h:539,
b:1602,c:604},{g:2009,h:541,b:2007,c:604},{g:386,h:974,b:385,c:1036},{g:792,h:972,b:790,c:1033},{g:1198,h:974,b:1196,c:1038},{g:1602,h:972,b:1601,c:1036},{g:2010,h:974,b:2005,c:1044},{g:386,h:1406,b:385,c:1477}]})();const d=Ta({name:"hero_walk",O:c,ma:424,ha:444,na:258,oa:444,ga:8,v:!0,u:.125,T:[{g:408,h:110,b:404,c:166},{g:830,h:110,b:829,c:166},{g:408,h:554,b:404,c:614},{g:830,h:554,b:829,c:614},{g:408,h:998,b:404,c:1055},{g:830,h:998,b:829,c:1055},{g:408,h:1444,b:404,c:1500},{g:830,h:1444,b:829,
c:1500}]})(),h=Ta({name:"hero_attack",O:e,ma:644,ha:565,na:284,oa:565,ga:5,v:!1,u:1/12,T:[{g:422,h:285,b:415,c:353},{g:936,h:367,b:868,c:380},{g:1507,h:311,b:1469,c:318},{g:162,h:948,b:206,c:943},{g:1025,h:934,b:976,c:962}]})();return{Qa:a,kb:d,Ea:h}}
function Ta(a){var b=a.O;const c=a.ma,e=a.ha,d=a.na,h=a.oa,k=Math.floor(b.w/c),f={x:d/Y,z:(e-h)/Y,width:c/Y,height:e/Y,ca:c/b.w,ba:e/b.i,$:k,count:a.ga},g=a.T&&a.T.map(({g:l,h:n,b:t,c:y},v)=>({Ka:{x:(l-(v%k*c+d))/Y,z:(Math.floor(v/k)*e+h-n)/Y,angle:Qa(-(n-y),l-t)}}));b=new R(b,{right:V(f),left:V({...f,N:!0})});return ya({name:a.name,set:b,Z:["left","right"],v:a.v,u:a.u,Za:g})};function Ua(a,b){var c=376/b;const e=c/(484/b),d=c/(268/b);c/=1.25;a=b/a*c;return{Wa:new Float32Array([a,0,0,0,0,0,1,d-e,0,c,0,0,0,0,0,(e+d)/2]),wb:e,vb:d,pb:a,qb:c,Y:554/b*e/c-1.25,H:.3}}async function Va(a,b){const [c,e,d,h]=await Promise.all([b("wall","assets/Back Wall.png"),b("floor","assets/floor.png"),b("ceiling","assets/ceiling.png"),b("wall","assets/side_wall.png")]);return{I:a,mb:c,Ma:e,Ia:d,bb:h}}
function Wa({mb:a,Ma:b,Ia:c,bb:e,I:d},h,k){k=-k-d.H;const f=2*d.H+k+h;var g=1-648/a.i,l=g*a.i/2.5*h/a.w;a=new R(a,{main:[[f,.5,2.5,l,1-g,f,.5,0,l,1,k,.5,2.5,0,1-g,k,.5,0,0,1]]});g=110/b.i;l=220/b.i;var n=(l-g)*b.i*h/b.w;b=new R(b,{main:[[f,-.5,-d.Y,n,1,k,-.5,-d.Y,0,1,f,-.5,0,n,l,k,-.5,0,0,l,f,.5,0,n,g,k,.5,0,0,g]]});g=144/c.i;l=32/c.i;h=(l-g)*c.i*h/c.w;c=new R(c,{main:[[f,-.5,2.5+d.Y,h,0,k,-.5,2.5+d.Y,0,0,f,-.5,2.5,h,l,k,-.5,2.5,0,l,f,.5,2.5,h,g,k,.5,2.5,0,g]]});h=438/e.w;g=318/e.w;l=194/e.i;n=1164/
e.i;const t=84/e.w;d=[k,-.5,2.5,h,l,k,-.5,0,h,n,k+d.H,-.5,2.5,g,l,k+d.H,-.5,0,g,n,k+d.H,.5,2.5,t,414/e.i,k+d.H,.5,0,t,964/e.i];h=[];for(g=0;g<d.length;g+=5)h.push(f+(k-d[g]),d[g+1],d[g+2],d[g+3],d[g+4]);e=new R(e,{right:[h],left:[d]});return{lb:a,La:b,Ha:c,ab:e}};function Xa(a){const b=a.J,c=a.K;return{M:a.M,P:[],o:a.o,J:b,K:c,Ba:a.Ba,ka:a.ka,S:Wa(a.M.Ja,c-b,b),X:a.X}};const Ya=new Float32Array([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
async function Za(a){const [b,c,e]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png"),a("creature_attack","assets/enemy_bite.png")]);var d=new R(b,{blink:V({x:.25,z:.25,width:.5,height:.5,ca:108/b.w,ba:108/b.i,$:2,count:6,N:!0})});a=ya({name:"creature_attack",set:new R(e,{bite:V({x:.5,z:.75,width:1,height:2,ba:530/e.i,ca:278/e.w,$:7,count:42,N:!0})}),Z:["bite"],v:!0,u:1/12});var h=Array(6).fill(.125);h[0]=4;d=ya({name:"creature_normal",set:d,Z:["blink"],v:!0,u:h});
h=[];var k=92,f=-22;const g=Math.sqrt(k*k+f*f);k/=g;f/=g;for(let l=0;29>l;l++){const n=l%5,t=Math.floor(l/5),y=[],v=(z,r)=>{const w=100*z,L=77*r-48;y.push((w*k+L*f)/g,z,(w*-f+L*k)/360,100*(n+z)/c.w,77*(t+r)/c.i)};v(1,1);v(0,1);v(1,0);v(0,0);h.push(y)}h=new R(c,{wiggle:h});return{Va:d,ob:a,eb:h}}class $a{constructor(a,b,c,e){const d=a.M.ra.Va();T(d,"blink",a.o);this.x=this.cb=b;this.y=c;this.z=e;this.ya=this.za=0;this.la=[Z(0,b,c,-1,1),Z(1,b,c,-1,-1),Z(2,b,c,1,1),Z(3,b,c,1,-1)];this.Ca=d}}
function ab(a){const b=a.o;a.P.forEach(c=>{c.x=c.cb+Math.sin(b);var e=.5*Math.cos(b);va(c.Ca,a.o);if(b>c.za){var d=c.ya;c.ya=(d+1)%c.la.length;d=c.la[d];e=c.x+.225*e+d.Oa;.05<Math.abs(e-d.aa)&&(c.za=b+.125,d.xa=b+.125,d.ua=d.aa,d.va=d.ia,d.wa=d.ja,d.aa=e,d.ia=c.y+d.Pa,d.ja=0)}})}
function bb(a,b){const c=a.stack,e=b.M.ra.eb,d=b.o,{x:h,z:k}={x:b.X.l,z:1.7};b.P.forEach(f=>{var g=f.x;const l=f.z;E(c,g,f.y,l);let n=h<g;g=Qa(k-l,h-g);n&&(c.push(Ya),g=Math.PI-g);H(c,g);wa(f.Ca,a);c.pop();n&&c.pop();c.pop()});K(e,a);b.P.forEach(f=>{const g=f.z-.1875;f.la.forEach(l=>{var n=f.x+l.Fa,t=f.y+l.Ga;let y=l.aa,v=l.ia,z=l.ja;var r=l.xa;d<r&&(r=1-(r-d)/.125,y=cb(r,l.ua,n,y),v=cb(r,l.va,t,v),z=cb(r,l.wa,g,z));n-=y;t-=v;r=g-z;const w=Math.sqrt(n*n+t*t+r*r);E(c,y,v,z);H(c,Qa(r,n));c.push(new Float32Array([w,
0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]));O(e,"wiggle",Math.abs((Math.floor(24*d)+l.Na)%57+1-29));c.pop();c.pop();c.pop()})})}function Z(a,b,c,e,d){const h=.4*e;d=.1*d;b+=h;c+=d;return{index:a,Fa:.05*e,Ga:0,Oa:h,Pa:d,xa:0,ua:b,va:c,wa:0,aa:b,ia:c,ja:0,Na:0}}function cb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};window.a=.1;function db(a){const b=1/18/18,c=h=>Math.max(0,Math.min(255,Math.round(256*(1-b*h*h)))),e=[];for(let h=0;2>h;h++)for(let k=0;18>k;k++)for(let f=0;2>f;f++){let g;var d=void 0;let l;d=k+6*f;18>d?(g=255,d=c(d),l=255):l=d=g=0;c(k+6*f);c(k+6*f+1);for(let n=0;2>n;n++)e.push(g,d,d,l)}a=ta({name:"spark",width:72,height:2,f:a,qa:new Uint8Array(e)});return new R(a,{fading:V({x:1/180,width:.04,height:2/180,ca:1/18,ba:1,$:18,count:18})})}function eb(a,b){return a.m?b.m?0:1:b.m?-1:a.y-b.y}
function fb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var m=Math.sin(Math.PI*(x+0)/8)/2+Math.sin(Math.PI*(x+0)/3)/8,q=Math.sin(Math.PI*(x+170)/8)/2+Math.sin(Math.PI*(x+130)/3)/8;ba=Math.asin((m-q)/100);za=Math.cos(ba);Aa=Math.sin(ba);Ba=(m+q)/2;if(F!==ca||-1===ca.B)X(g,"attack")?(F=ca,T(ca,"right",x),P&&P.stop(),m=M.createBufferSource(),m.buffer=Ca[Math.floor(Math.random()*Ca.length)],m.connect(M.destination),m.start(0)):(N=1.2*A*Ja(g,"left","right"),m=G.l+N,m<u.J+1.125?N=u.J+1.125-G.l:m>u.K-1.125&&(N=u.K-
1.125-G.l),0!==N?(G.l+=N,U=0>N,F!==da&&(F=da,T(da,U?"left":"right",x))):F!==oa?(F=oa,T(oa,U?"left":"right",x)):null==P&&0<x-4&&(P=M.createBufferSource(),P.buffer=gb,P.connect(M.destination),P.start(0)));va(F,x);m=Math.floor(48*x)-Math.floor(48*(x-A));for(q=0;q<m;q++){var B=2*Math.random()+1.4;let p=.1*Math.sin(2*Math.PI*Math.random());var C=F.U(),S=C&&C.Ka;if(!S)continue;C=G.l+S.x*(U?-1:1);const J=S.z,D=Math.PI/4*(Math.random()-.5)+S.angle;S=B*Math.sin(D);B=B*Math.cos(D)+N/A;100<Q.length&&Q.pop();
Q.push({m:!1,x:C,y:.01,z:J,s:B,L:p,D:S,startTime:x,sa:x+1.5,Aa:!1})}const hb=9.8*za*A,ib=9.8*Aa*A,Da=1-.8*A;Q.forEach(p=>{var J=p.m;if(!J&&x<p.sa){p.x+=p.s*A;p.y+=p.L*A;p.z+=p.D*A;J=p.D;p.Aa?(p.s*=Da,p.L*=Da):(J-=hb,p.s-=ib,p.D=J);if(p.x<u.J||p.x>u.K)p.m=!0;var D=p.y;if(-.5>D||.5<D){const Ea=0<D?.5:-.5;p.y=Ea+(Ea-D);p.L=-p.L}D=u.ka;p.z<D&&(-.01<J?(p.z=180,p.D=D,p.Aa=!0):(p.z=D-p.z,p.D=-.25*J))}else J||(p.m=!0)});Q.sort(eb);ab(u)}function b(m,q,B){q.stack.push(r.Wa);E(q.stack,-Math.min(Math.max(G.l,
u.J+1),u.K-1),0,-z);H(q.stack,ba);E(q.stack,0,0,Ba);B(m,q);q.stack.pop();q.stack.pop();q.stack.pop()}function c(m,q){const B=q.stack;m=u.S.lb;K(m,q);O(m,"main",0);m=u.S.La;K(m,q);O(m,"main",0);m=u.S.Ha;K(m,q);O(m,"main",0);m=u.S.ab;K(m,q);O(m,"left",0);O(m,"right",0);E(B,G.l,0,0);F.da=U?"left":"right";wa(F,q);B.pop();bb(q,u);K(Fa,q);Q.forEach(C=>{C.m||(E(B,C.x,C.y,C.z),H(B,(0<=C.s?Math.PI:0)+Math.atan(C.D/C.s)),O(Fa,"fading",Math.floor(12*(x-C.startTime))),B.pop(),B.pop())})}function e(m,q){m.bindFramebuffer(m.FRAMEBUFFER,
null);m.viewport(0,0,y,v);m.disable(m.BLEND);m.clearColor(0,0,0,1);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.activeTexture(m.TEXTURE1);Ga.j.bindTexture();m.uniform1i(q.A.lighting,1);m.activeTexture(m.TEXTURE0);b(m,q,c)}function d(){{const m=(Date.now()-jb)/1E3;A=m-u.o;x=u.o=m;ea=-1===ea?60:1/A/16+.9375*ea;h.innerHTML=`fps=${Math.round(ea)}`}window.a=Math.max(0,Math.min(1,window.a+A/4*Ja(g,"lightDown","lightUp")));Ia(g)%2&&(n=!n);!pa&&X(g,"fullscreen")&&(pa=k.requestFullscreen());z+=A*Ja(g,
"down","up");window.cameraZ=z;a();Ma(Ga,{$a:b,jb:x,Ya:Q,Ta:n});na(L,e);requestAnimationFrame(d)}const h=document.getElementById("fps"),k=document.getElementById("canvas");var f=window.getComputedStyle(k);const g=new Ka(document.body);W(g,"left",["a","ArrowLeft"]);W(g,"right",["d","ArrowRight"]);W(g,"showLights",["l"]);W(g,"attack",["f"," "]);W(g,"fullscreen",["u"]);W(g,"up",["w","ArrowUp"]);W(g,"down",["s","ArrowDown"]);W(g,"lightUp",["y"]);W(g,"lightDown",["h"]);var l=parseInt(f.getPropertyValue("width"),
10);f=parseInt(f.getPropertyValue("height"),10);let n=!1;const t=window.devicePixelRatio||1,y=t*l,v=t*f;k.width=y;k.height=v;let z=1.25;const r=Ua(l,f);console.log(r);const w=k.getContext("webgl2",{antialias:!1,alpha:!1});w.enable(w.DEPTH_TEST);w.depthFunc(w.LEQUAL);l=new I({f:w,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new I({f:w,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const L=new ma({f:w,I:"projection"});la(L,l,f).link();const Ga=new Oa(w,y,v,360),M=new AudioContext;l=(m,q)=>ra({f:w,name:m,src:q});const [kb,Ca,gb,lb,fa]=await Promise.all([Va(r,l),Promise.all([fb(M,"assets/Grunt1.mp3"),fb(M,"assets/Grunt2.mp3"),fb(M,"assets/Grunt3.mp3")]),fb(M,"assets/Theres something here.mp3"),Za(l),Sa(l)]);let P=null;const oa=fa.Qa,da=fa.kb,ca=fa.Ea,G=new Ra(2),u=Xa({M:{ra:lb,X:fa,Ja:kb},o:0,J:0,K:12,Ba:2.5,ka:0,X:G}),Fa=db(w),Q=[];let jb=Date.now(),x=0,ea=-1,A=0,N=0,U=!1,F=
da,pa=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(pa=null)});u.P.push(new $a(u,G.l+2,0,.75));let ba,Aa,za,Ba;requestAnimationFrame(d);k.onmousemove=()=>{}};
