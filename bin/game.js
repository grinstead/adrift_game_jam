'use strict';class ba{constructor(a,b,c){this.name=c;this.F=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.F}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.F}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ca(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new ba(c[1],c[2],c[3]))});return b}
const da=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function ea(a,b){a.b.uniformMatrix4fv(a.i,!1,b);a.a.push(b)}function G(a,b,c,e=0){var d=a.a;d=d.length?d[d.length-1]:da;ea(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function fa(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ha{constructor(a,b){this.b=a;this.i=b;this.a=[];a.uniformMatrix4fv(b,!1,da)}pop(){return this.a.pop()}push(a){var b=this.a;0===b.length?ea(this,a):(b=b[b.length-1],ea(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class ia{constructor(a,b){this.name=a.name;var c=this.b=a.b;a=this.type=a.type;switch(a){case "vertex":var e=this.b.VERTEX_SHADER;break;case "fragment":e=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.a=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.Fa=ca(b)}}
function ma(a,...b){const c=a.b,e=a.fa;b.forEach(d=>{a.oa.push(d);c.attachShader(e,d.a)});return a}class na{constructor(a){this.name=a.name;this.Z=a.Z;a=this.b=a.b;this.a=!1;this.fa=a.createProgram();this.oa=[];this.A={};this.B={};this.stack=null}link(){if(this.a)return this;var a=this.b,b=this.fa;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.a=!0;return this}}
function oa(a,b){var c=a.b,e=a.fa;c.useProgram(e);for(var d={},g={},l=a.oa,f=0;f<l.length;f++)for(var h=l[f].Fa,k=0;k<h.length;k++){var p=h[k];1===p.type?p.F in d||(d[p.name]=c.getUniformLocation(e,p.F)):p.F in g||(g[p.name]=c.getAttribLocation(e,p.F))}a.A=d;a.B=g;if(e=a.Z)if(e in a.A)a.stack=new ha(c,a.A[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.A={},a.B={},a.stack=null}}
class pa{constructor(a,b,c,e,d){this.b=a;this.name=b;this.w=c;this.j=e;this.a=d(a)}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}}function qa(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new pa(a.b,a.name,c,e,ra(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function sa(a){const b=a.width,c=a.height;return new pa(a.b,a.name,b,c,ra(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.pa,0)}))}function za(a){return new pa(a.b,a.name,a.width,a.height,()=>a.na)}
function ra(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);return c}};function J(a,b){const c=a.a.b;let e=a.i;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.i=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.D,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(b.A.texture,0);c.enableVertexAttribArray(b.B.texturePosition);c.vertexAttribPointer(b.B.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.B.position);c.vertexAttribPointer(b.B.position,3,c.FLOAT,!1,20,0)}
function L(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.a.b;const e=b.ga;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Ta)}
class M{constructor(a,b){this.a=a;this.i=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],l=[],f=g.length;if(0===f)throw Error("Sprite declared with 0 points");const h=g[0].length;if(0==h)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const k=h/5;for(let p=0;p<f;p++){const r=g[p];if(r.length!==h)throw Error("Sprite declared with inconsistent lengths of elements");l.push(e);c.push.apply(c,r);e+=k}a[d]={eb:this,name:d,ga:l,Ta:k}}this.D=new Float32Array(c)}}
function Aa(a,b,c){if(!a.Pa.includes(b))throw Error(`${a} does not have mode ${b}`);a.i=0;a.ea=b;a.K=0;a.a=c+a.D[0]}function Ba(a,b,c){const e=a.ea;if(null==e)throw Error(`${a} tried rendering while inactive`);let d=a.K;var g=a.a;if(-1!==g&&g<=c){g=a.D;const l=d+1;l===g.length?a.i===a.Qa?a.a=-1:(a.i++,d=0,a.K=d,a.a=c+g[d]):(d=l,a.K=d,a.a=c+g[d])}J(a.sa,b);L(a.sa,e,d)}
class Ca{constructor(a,b){const c=a.ia;this.T=a.name;this.Pa=a.X;this.ea=null;this.Qa="number"===typeof c?c:c?-1:0;this.sa=a.set;this.D=b;this.i=0;this.a=this.K=-1}name(){return this.T}toString(){return`Sprite/${this.T}`}}
function Da(a){const b=a.name,c=a.ha,e=a.set.data;let d=-1;a.X.forEach(l=>{const f=e[l];if(!f)throw Error(`Sprite/${b} has non-existent mode ${l}`);if(-1===d)d=f.ga.length;else if(d!==f.ga.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);const g="number"===typeof c?Array(d).fill(c):c;return()=>new Ca(a,g)}
function Ea({da:a=0,lb:b=0,mb:c=0,ca:e,U:d,aa:g,ba:l,m:f,count:h,o:k=!1}){const p=e/g;g=d/g;return Q({x:a*p,y:b,z:c*g,width:p,height:g,N:e/l.w,M:d/l.j,m:f,count:h,o:k})}function Q({x:a=0,y:b=0,z:c=0,width:e,height:d,N:g,M:l,m:f,count:h,ib:k=0,jb:p=0,kb:r=g,hb:z=l,o:x=!1}){const v=[];for(let t=0;t<h;t++){const B=k+t%f*r,R=p+Math.floor(t/f)*z;v.push(Fa({x:a,y:b,z:c,width:e,height:d,Da:B,Ba:B+g,Ea:R,Ca:R+l,o:x}))}return v}
function Fa({x:a=0,y:b=0,z:c=0,width:e,height:d,Da:g,Ea:l,Ba:f,Ca:h,o:k=!1}){k?(k=f,f=a-e):(k=g,g=f,f=-a,a=e-a);return[a,b,-c,g,h,f,b,-c,k,h,a,b,d-c,g,l,f,b,d-c,k,l]};function W(a,b,c){a=a.i;null!=c?a.set(b,c):a.delete(b)}function Ga(a,b){b=a.i.get(b);const c=a.a;return!!b&&!!b.some(e=>(e=c.get(e))?(e.S=0,null!=e.V):!1)}function Ha(a){const b=a.i.get("showLights");if(b){const c=a.a;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.S,d.S=0,e):e,0)}return 0}function Ia(a,b,c){b=Ga(a,b)?1:0;return(Ga(a,c)?1:0)-b}
class Va{constructor(a){this.a=new Map;this.i=new Map;a.addEventListener("keydown",b=>{Wa(this,b,!0)});a.addEventListener("keyup",b=>{Wa(this,b,!1)});a.onblur=()=>{this.a.clear()};a.onfocus=()=>{this.a.clear()}}}function Wa(a,b,c){b=b.key;a=a.a;const e=a.get(b);c?null==e?a.set(b,{V:Date.now(),S:1}):(null==e.V&&(e.V=Date.now()),e.S++):null!=e&&(e.V=null)};function Xa(a,b){const c=a.i.b,e=a.a;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.T);c.viewport(0,0,e.w,e.j);oa(a.i,(d,g)=>{Ya(d,g,a,b)})}
class Za{constructor(a,b,c,e){b/=4;c/=4;var d=new ia({b:a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),g=
new ia({b:a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const l=new na({b:a,Z:"projection"});ma(l,d,g).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=sa({name:"fade",width:64,height:64,b:a,pa:$a(e)});this.i=l;this.a=za({na:d,name:"lighting",
width:b,height:c,b:a});this.T=g;this.D=new M(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Ya(a,b,c,e){e.Ra?a.clearColor(0,0,0,1):a.clearColor(0,0,0,window.a);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.Va(a,b,()=>{const d=c.D;J(d,b);const g=b.A.threshold,l=e.Za;e.Ua.forEach(f=>{if(!f.s){var h=f.startTime;h=(l-h)/(f.ra-h);a.uniform1f(g,.5*h*h);G(b.stack,f.x,f.y,f.z);L(d,"main",0);b.stack.pop()}})})}
function $a(a){const b=new Uint8Array(16384),c=(g,l)=>{g/=a;l/=a;return g*g+l*l},e=Math.min(c(32,0),c(32,0));for(let g=0;64>g;g++)for(let l=0;64>l;l++){const f=4*(64*g+l);var d=c(l-32,g-32);const h=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const k=Math.max(Math.round(255*h*h),0);b[f]=d+Math.max(Math.round(20*h),0);b[f+1]=d;b[f+2]=d;b[f+3]=k}return b};function ab(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const X=434/1.8,bb=new Map;class cb{constructor(a){this.l=a}}
async function db(a){[a]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Da({name:"hero_idle",set:eb({name:"hero_idle",na:a,ab:405,La:434,bb:220,cb:434,Ja:16,Ia:[{g:388,h:104,c:385,f:170},{g:792,h:105,c:790,f:170},{g:1198,h:105,c:1195,f:169},{g:1602,h:106,c:1600,f:170},{g:2008,h:106,c:2005,f:172},{g:388,h:539,c:385,f:604},{g:794,h:540,c:790,f:605},{g:1196,h:539,c:1196,f:604},{g:1602,
h:539,c:1602,f:604},{g:2009,h:541,c:2007,f:604},{g:386,h:974,c:385,f:1036},{g:792,h:972,c:790,f:1033},{g:1198,h:974,c:1196,f:1038},{g:1602,h:972,c:1601,f:1036},{g:2010,h:974,c:2005,f:1044},{g:386,h:1406,c:385,f:1477}]}),X:["left","right"],ia:!0,ha:1/12})();console.log(bb);return{Oa:a}}
function eb(a){const b=a.na,c=a.ab,e=a.La,d=a.bb,g=a.cb,l=a.Ja,f=Math.floor(b.w/c),h={x:d/X,z:(e-g)/X,width:c/X,height:e/X,N:c/b.w,M:e/b.j,m:f,count:l},k=a.Ia.map(({g:p,h:r,c:z,f:x},v)=>({x:(p-(v%f*c+d))/X,z:(Math.floor(v/f)*e+g-r)/X,angle:ab(-(r-x),p-z)}));if(k.length!==l)throw Error(`flareData length ${k.length} but expects ${l}`);bb.set(a.name,k);return new M(b,{right:Q(h),left:Q({...h,o:!0})})};async function fb(a){[a]=await Promise.all([a("wall","assets/Back Wall.png"),a("floor","assets/floor.png")]);const b=a.w/360;return{$a:new M(a,{main:[[b,.5,2.5,1,.5,b,.5,0,1,1,0,.5,2.5,0,.5,0,.5,0,0,1]]})}};function gb(a){return{$:a.$,R:[],v:a.v,G:a.G,H:a.H,Aa:a.Aa,la:a.la,W:a.W}};const hb=new Float32Array([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
async function ib(a){const [b,c,e]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png"),a("creature_attack","assets/enemy_bite.png")]);var d=new M(b,{blink:Q({x:.25,z:.25,width:.5,height:.5,N:108/b.w,M:108/b.j,m:2,count:6,o:!0})});a=Da({name:"creature_attack",set:new M(e,{bite:Q({x:.5,z:.75,width:1,height:2,M:530/e.j,N:278/e.w,m:7,count:42,o:!0})}),X:["bite"],ia:!0,ha:1/12});var g=Array(6).fill(.125);g[0]=4;d=Da({name:"creature_normal",set:d,X:["blink"],ia:!0,ha:g});
g=[];var l=92,f=-22;const h=Math.sqrt(l*l+f*f);l/=h;f/=h;for(let k=0;29>k;k++){const p=k%5,r=Math.floor(k/5),z=[],x=(v,t)=>{const B=100*v,R=77*t-48;z.push((B*l+R*f)/h,v,(B*-f+R*l)/360,100*(p+v)/c.w,77*(r+t)/c.j)};x(1,1);x(0,1);x(1,0);x(0,0);g.push(z)}g=new M(c,{wiggle:g});return{gb:d,Sa:a,Ya:g}}class jb{constructor(a,b,c,e){const d=a.$.qa.Sa();Aa(d,"bite",a.v);this.x=this.Xa=b;this.y=c;this.z=e;this.xa=this.ya=0;this.ma=[kb(0,b,c,-1,1),kb(1,b,c,-1,-1),kb(2,b,c,1,1),kb(3,b,c,1,-1)];this.Wa=d}}
function lb(a){const b=a.v;a.R.forEach(c=>{c.x=c.Xa+Math.sin(b);var e=.5*Math.cos(b);if(b>c.ya){var d=c.xa;c.xa=(d+1)%c.ma.length;d=c.ma[d];e=c.x+.225*e+d.Ma;.05<Math.abs(e-d.Y)&&(c.ya=b+.125,d.wa=b+.125,d.ta=d.Y,d.ua=d.ja,d.va=d.ka,d.Y=e,d.ja=c.y+d.Na,d.ka=0)}})}
function mb(a,b){const c=a.stack,e=b.$.qa.Ya,d=b.v,{x:g,z:l}={x:b.W.l,z:1.7};b.R.forEach(f=>{var h=f.x;const k=f.z;G(c,h,f.y,k);let p=g<h;h=ab(l-k,g-h);p&&(c.push(hb),h=Math.PI-h);fa(c,h);Ba(f.Wa,a,d);c.pop();p&&c.pop();c.pop()});J(e,a);b.R.forEach(f=>{const h=f.z-.1875;f.ma.forEach(k=>{var p=f.x+k.Ga,r=f.y+k.Ha;let z=k.Y,x=k.ja,v=k.ka;var t=k.wa;d<t&&(t=1-(t-d)/.125,z=nb(t,k.ta,p,z),x=nb(t,k.ua,r,x),v=nb(t,k.va,h,v));p-=z;r-=x;t=h-v;const B=Math.sqrt(p*p+r*r+t*t);G(c,z,x,v);fa(c,ab(t,p));c.push(new Float32Array([B,
0,0,0,0,r,0,0,0,0,1,0,0,0,0,1]));L(e,"wiggle",Math.abs((Math.floor(24*d)+k.Ka)%57+1-29));c.pop();c.pop();c.pop()})})}function kb(a,b,c,e,d){const g=.4*e;d=.1*d;b+=g;c+=d;return{index:a,Ga:.05*e,Ha:0,Ma:g,Na:d,wa:0,ta:b,ua:c,va:0,Y:b,ja:c,ka:0,Ka:0}}function nb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};const ob=[{I:422,J:285,O:415,P:353},{I:936,J:367,O:868,P:380},{I:1507,J:311,O:1469,P:318},{I:162,J:948,O:206,P:943},{I:1025,J:934,O:976,P:962}];window.a=.1;
function pb(a){const b=1/18/18,c=g=>Math.max(0,Math.min(255,Math.round(256*(1-b*g*g)))),e=[];for(let g=0;2>g;g++)for(let l=0;18>l;l++)for(let f=0;2>f;f++){let h;var d=void 0;let k;d=l+6*f;18>d?(h=255,d=c(d),k=255):k=d=h=0;c(l+6*f);c(l+6*f+1);for(let p=0;2>p;p++)e.push(h,d,d,k)}a=sa({name:"spark",width:72,height:2,b:a,pa:new Uint8Array(e)});return new M(a,{fading:Q({x:1/180,width:.04,height:2/180,N:1/18,M:1,m:18,count:18})})}function qb(a,b){return a.s?b.s?0:1:b.s?-1:a.y-b.y}
function rb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var n=Math.sin(Math.PI*(u+0)/8)/2+Math.sin(Math.PI*(u+0)/3)/8,q=Math.sin(Math.PI*(u+170)/8)/2+Math.sin(Math.PI*(u+130)/3)/8;ja=Math.asin((n-q)/100);Ja=Math.cos(ja);Ka=Math.sin(ja);La=(n+q)/2;C===ta&&u-S<5/Y||(Ga(h,"attack")?(C=ta,S=u,Y=12,T&&T.stop(),n=N.createBufferSource(),n.buffer=Ma[Math.floor(Math.random()*Ma.length)],n.connect(N.destination),n.start(0)):(K=1.2*D*Ia(h,"left","right"),n=H.l+K,n<A.G+1.125?K=A.G+1.125-H.l:n>A.H-1.125&&(K=A.H-1.125-H.l),
0!==K?(H.l+=K,O=0>K,C!==ua&&(C=ua,S=u,Y=8)):C!==U?(C=U,S=u,Y=12,Aa(U,O?"left":"right",u)):null==T&&S<u-4&&(T=N.createBufferSource(),T.buffer=sb,T.connect(N.destination),T.start(0))));n=Math.floor(48*u)-Math.floor(48*(u-D));for(q=0;q<n;q++){var E=2*Math.random()+1.4;let m=.1*Math.sin(2*Math.PI*Math.random()),I;var y=void 0,w=void 0;if(C===U)w=bb.get(U.name())[U.K],I=H.l+w.x*(O?-1:1),y=w.z,w=w.angle;else if(I=H.l+(tb-(K?.05:0))*(O?-1:1),y=328/360,w=Math.PI/2,C===ta){y=Math.floor(Y*(u-S));w=ob[y];I=
H.l+(w.I-(y%3*644+284))*(O?-1:1)/360;m=-Math.abs(m);y=(565-(w.J-565*Math.floor(y/3)))/360;var aa=(w.O-w.I)*(O?-1:1);w=Math.atan((w.J-w.P)/aa);0<aa&&(w+=Math.PI)}aa=Math.PI/4*(Math.random()-.5)+w;w=E*Math.sin(aa);E=E*Math.cos(aa)+K/D;100<V.length&&V.pop();V.push({s:!1,x:I,y:0,z:y,u:E,L:m,C:w,startTime:u,ra:u+1.5,za:!1})}const ub=9.8*Ja*D,vb=9.8*Ka*D,Na=1-.8*D;V.forEach(m=>{var I=m.s;if(!I&&u<m.ra){m.x+=m.u*D;m.y+=m.L*D;m.z+=m.C*D;I=m.C;m.za?(m.u*=Na,m.L*=Na):(I-=ub,m.u-=vb,m.C=I);if(m.x<A.G||m.x>A.H)m.s=
!0;var P=m.y;if(-.5>P||.5<P){const Oa=0<P?.5:-.5;m.y=Oa+(Oa-P);m.L=-m.L}P=A.la;m.z<P&&(-.01<I?(m.z=180,m.C=P,m.za=!0):(m.z=P-m.z,m.C=-.25*I))}else I||(m.s=!0)});V.sort(qb);lb(A)}function b(n,q,E){q.stack.push(R);G(q.stack,-Math.min(Math.max(H.l,A.G+2),A.H-2),0,-v);fa(q.stack,ja);G(q.stack,0,0,La);E(n,q);q.stack.pop();q.stack.pop();q.stack.pop()}function c(n,q){const E=q.stack;n=Pa.$a;J(n,q);L(n,"main",0);J(Qa,q);L(Qa,"main",0);J(Ra,q);L(Ra,"main",0);G(E,H.l,0,0);C===U?(C.ea=O?"left":"right",Ba(C,
q,u)):(J(C,q),L(C,O?"left":"right",Math.floor(Y*(u-S))));E.pop();mb(q,A);J(Sa,q);V.forEach(y=>{y.s||(G(E,y.x,y.y,y.z),fa(E,(0<=y.u?Math.PI:0)+Math.atan(y.C/y.u)),L(Sa,"fading",Math.floor(12*(u-y.startTime))),E.pop(),E.pop())})}function e(n,q){n.bindFramebuffer(n.FRAMEBUFFER,null);n.viewport(0,0,z,x);n.disable(n.BLEND);n.clearColor(0,0,0,1);n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);n.activeTexture(n.TEXTURE1);va.a.bindTexture();n.uniform1i(q.A.lighting,1);n.activeTexture(n.TEXTURE0);b(n,q,c)}
function d(){{const n=(Date.now()-wb)/1E3;D=n-A.v;u=A.v=n;ka=-1===ka?60:1/D/16+.9375*ka;g.innerHTML=`fps=${Math.round(ka)}`}window.a=Math.max(0,Math.min(1,window.a+D/4*Ia(h,"lightDown","lightUp")));Ha(h)%2&&(p=!p);!wa&&Ga(h,"fullscreen")&&(wa=l.requestFullscreen());v+=D*Ia(h,"down","up");window.cameraZ=v;a();Xa(va,{Va:b,Za:u,Ua:V,Ra:p});oa(Ta,e);requestAnimationFrame(d)}const g=document.getElementById("fps"),l=document.getElementById("canvas");var f=window.getComputedStyle(l);const h=new Va(document.body);
W(h,"left",["a","ArrowLeft"]);W(h,"right",["d","ArrowRight"]);W(h,"showLights",["l"]);W(h,"attack",["f"," "]);W(h,"fullscreen",["u"]);W(h,"up",["w","ArrowUp"]);W(h,"down",["s","ArrowDown"]);W(h,"lightUp",["y"]);W(h,"lightDown",["h"]);var k=parseInt(f.getPropertyValue("width"),10);f=parseInt(f.getPropertyValue("height"),10);let p=!1;var r=window.devicePixelRatio||1;const z=r*k,x=r*f;l.width=z;l.height=x;let v=1.25;var t=376/f;r=t/(484/f);var B=t/(268/f);t/=1.25;const R=new Float32Array([f/k*t,0,0,
0,0,0,1,B-r,0,t,0,0,0,0,0,(r+B)/2]),F=l.getContext("webgl2",{antialias:!1,alpha:!1});F.enable(F.DEPTH_TEST);F.depthFunc(F.LEQUAL);k=new ia({b:F,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new ia({b:F,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const Ta=new na({b:F,Z:"projection"});ma(Ta,k,f).link();const va=new Za(F,z,x,360),N=new AudioContext;k=(n,q)=>qa({b:F,name:n,src:q});const [Pa,la,xa,ya,Ma,sb,xb,Z,Ua]=await Promise.all([fb(k),qa({b:F,src:"assets/floor.png",name:"floor"}),qa({b:F,src:"assets/Hero Walking with axe.png",name:"walk"}),qa({b:F,src:"assets/Axe Chop.png",name:"attack"}),Promise.all([rb(N,"assets/Grunt1.mp3"),rb(N,"assets/Grunt2.mp3"),rb(N,"assets/Grunt3.mp3")]),rb(N,"assets/Theres something here.mp3"),ib(k),k("ceiling",
"assets/ceiling.png"),db(k)]);let T=null;f=220/la.j;r=la.w/360;k=70/360;B=442/la.j;f/=2;r*=2;B/=2;const Qa=new M(la,{main:[[r,-.5,-k,1,1,0,-.5,-k,0,1,r,-.5,0,1,B,0,-.5,0,0,B,r,.5,0,1,f,0,.5,0,0,f]]});f=Z.w/360;f*=2;const Ra=new M(Z,{main:[[f,-.5,2.5+k,1,0,0,-.5,2.5+k,0,0,f,-.5,2.5,1,31/Z.j,0,-.5,2.5,0,31/Z.j,f,.5,2.5,1,144/Z.j,0,.5,2.5,0,144/Z.j]]}),tb=1.125*(387/405-220/405),U=Ua.Oa,ua=new M(xa,{right:Ea({da:258/424,ca:424,U:444,ba:xa,aa:360,m:2,count:8}),left:Ea({da:1-258/424,ca:424,U:444,ba:xa,
aa:360,m:2,count:8,o:!0})}),ta=new M(ya,{right:Ea({da:284/644,ca:644,U:565,ba:ya,aa:360,m:3,count:5}),left:Ea({da:1-284/644,ca:644,U:565,ba:ya,aa:360,m:3,count:5,o:!0})});new M(va.a,{main:[Fa({width:2,height:1,Da:0,Ea:0,Ba:1,Ca:1})]});const H=new cb(4),A=gb({$:{qa:xb,W:Ua,fb:Pa},v:0,G:0,H:12,Aa:2.5,la:0,W:H}),Sa=pb(F),V=[];let wb=Date.now(),u=0,ka=-1,D=0,K=0,O=!1,S=0,C=ua,Y=12,wa=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(wa=null)});A.R.push(new jb(A,H.l+2,
0,.75));let ja,Ka,Ja,La;requestAnimationFrame(d);l.onmousemove=()=>{}};
