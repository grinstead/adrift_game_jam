'use strict';class aa{constructor(a,b,c){this.name=c;this.ja=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.ja}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.ja}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ba(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new aa(c[1],c[2],c[3]))});return b}
const da=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function fa(a,b){a.i.uniformMatrix4fv(a.A,!1,b);a.a.push(b)}function A(a,b,c,d=0){var e=a.a;e=e.length?e[e.length-1]:da;fa(a,new Float32Array([e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],b*e[0]+c*e[4]+d*e[8]+e[12],b*e[1]+c*e[5]+d*e[9]+e[13],b*e[2]+c*e[6]+d*e[10]+e[14],b*e[3]+c*e[7]+d*e[11]+e[15]]))}function B(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ha{constructor(a,b){this.i=a;this.A=b;this.a=[];a.uniformMatrix4fv(b,!1,da)}depth(){return this.a.length}pop(){return this.a.pop()}push(a){var b=this.a;0===b.length?fa(this,a):(b=b[b.length-1],fa(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+
a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class ia{constructor(a,b){this.name=a.name;var c=this.i=a.i;a=this.type=a.type;switch(a){case "vertex":var d=this.i.VERTEX_SHADER;break;case "fragment":d=this.i.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}d=this.a=c.createShader(d);c.shaderSource(d,b);c.compileShader(d);if(!c.getShaderParameter(d,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(d)}`,c.deleteShader(d),Error(b);this.jb=ba(b)}}
function ja(a,...b){const c=a.i,d=a.Ha;b.forEach(e=>{a.Sa.push(e);c.attachShader(d,e.a)});return a}class ka{constructor(a){this.name=a.name;this.da=a.da;a=this.i=a.i;this.a=!1;this.Ha=a.createProgram();this.Sa=[];this.Z={};this.fa={};this.stack=null}link(){if(this.a)return this;var a=this.i,b=this.Ha;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.a=!0;return this}}
function la(a,b){var c=a.i,d=a.Ha;c.useProgram(d);for(var e={},f={},g=a.Sa,h=0;h<g.length;h++)for(var k=g[h].jb,l=0;l<k.length;l++){var n=k[l];1===n.type?n.ja in e||(e[n.name]=c.getUniformLocation(d,n.ja)):n.ja in f||(f[n.name]=c.getAttribLocation(d,n.ja))}a.Z=e;a.fa=f;if(d=a.da)if(d in a.Z)a.stack=new ha(c,a.Z[d]);else throw Error(`No anchor point "${d}" in program`);try{b(c,a)}finally{a.Z={},a.fa={},a.stack=null}}
class ma{constructor(a,b,c,d,e){this.i=a;this.name=b;this.w=c;this.u=d;this.a=e(a)}bindTexture(){this.i.bindTexture(this.i.TEXTURE_2D,this.a)}}function na(a){return(new Promise((b,c)=>{const d=new Image;d.onload=()=>void b(d);d.onerror=()=>{c(Error(`failed to load ${a.src}`))};d.mode="no-cors";d.src=a.src})).then(b=>{const c=b.naturalWidth,d=b.naturalHeight;return new ma(a.i,a.name,c,d,oa(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,d,0,e.RGBA,e.UNSIGNED_BYTE,b)}))})}
function pa(a){const b=a.width,c=a.height;return new ma(a.i,a.name,b,c,oa(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,d.UNSIGNED_BYTE,a.Ja,0)}))}function qa(a){return new ma(a.i,a.name,a.width,a.height,()=>a.Y)}
function oa(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);return c}};function C(a,b,c){a=a.A;null!=c?a.set(b,c):a.delete(b)}function ra(a,b){b=a.A.get(b);const c=a.a;return!!b&&!!b.some(d=>(d=c.get(d))?(d.wa=0,null!=d.Aa):!1)}function sa(a){const b=a.A.get("showLights");if(b){const c=a.a;return b.reduce((d,e)=>(e=c.get(e))?(d+=e.wa,e.wa=0,d):d,0)}return 0}function ta(a,b,c){b=ra(a,b)?1:0;return(ra(a,c)?1:0)-b}
class ua{constructor(a){this.a=new Map;this.A=new Map;a.addEventListener("keydown",b=>{va(this,b,!0)});a.addEventListener("keyup",b=>{va(this,b,!1)});a.onblur=()=>{this.a.clear()};a.onfocus=()=>{this.a.clear()}}}function va(a,b,c){b=b.key;a=a.a;const d=a.get(b);c?null==d?a.set(b,{Aa:Date.now(),wa:1}):(null==d.Aa&&(d.Aa=Date.now()),d.wa++):null!=d&&(d.Aa=null)};function D(a,b){const c=a.a.i;let d=a.A;null!=d?c.bindBuffer(c.ARRAY_BUFFER,d):(a.A=d=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,a.ha,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(b.Z.texture,0);c.enableVertexAttribArray(b.fa.texturePosition);c.vertexAttribPointer(b.fa.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.fa.position);c.vertexAttribPointer(b.fa.position,3,c.FLOAT,!1,20,0)}
function G(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.a.i;const d=b.Ia;a.drawArrays(a.TRIANGLE_STRIP,d[c%d.length],b.Pb)}
class H{constructor(a,b){this.a=a;this.A=null;a=this.data={};const c=[];let d=0;for(const e in b){const f=b[e],g=[],h=f.length;if(0===h)throw Error("Sprite declared with 0 points");const k=f[0].length;if(0==k)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=k/5;for(let n=0;n<h;n++){const q=f[n];if(q.length!==k)throw Error("Sprite declared with inconsistent lengths of elements");g.push(d);c.push.apply(c,q);d+=l}a[e]={hc:this,name:e,Ia:g,Pb:l}}this.ha=new Float32Array(c)}}
function wa(a,b){for(var c=a.H;-1!==c&&c<=b;){c=a.ha;const d=a.I+1;d===c.length?a.A===a.Db?a.H=c=-1:(a.A++,a.I=0,a.H=c=b+c[0]):(a.I=d,a.H=c=b+c[d])}}function xa(a,b){if(b!==a.a){if(!a.za.includes(b))throw Error(`${a} does not have mode ${b}`);a.a=b}}
class ya{constructor(a,b,c,d){const e=a.M;this.Ba=a.name;this.za=a.ta;this.a=c;this.Db="number"===typeof e?e:e?-1:0;this.Wa=a.set;this.ha=b;this.I=this.A=0;this.H=d+b[0];this.zb=a.Qb}ya(){const a=this.zb;return null!=a?a[this.I]:void 0}X(a){D(this.Wa,a);G(this.Wa,this.a,this.I)}name(){return this.Ba}toString(){return`Sprite/${this.Ba}`}}
function za(a){const b=a.name,c=a.L,d=a.set.data;let e=-1;a.ta.forEach(g=>{const h=d[g];if(!h)throw Error(`Sprite/${b} has non-existent mode ${g}`);if(-1===e)e=h.Ia.length;else if(e!==h.Ia.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===e)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==e)throw Error(`Sprite/${b} given ${c.length} frame times for ${e} frames`);if(a.ya&&a.ya.length!==e)throw Error(`Sprite/${b} given ${a.ya.length} frame data points for ${e} frames`);
const f="number"===typeof c?Array(e).fill(c):c;return(g,h)=>new ya(a,f,g,h)}function K({x:a=0,y:b=0,z:c=0,width:d,height:e,qa:f,pa:g,ma:h,count:k,kc:l=0,lc:n=0,mc:q=f,jc:m=g,oa:u=!1}){const t=[];for(let w=0;w<k;w++){const E=l+w%h*q,I=n+Math.floor(w/h)*m;t.push(Aa({x:a,y:b,z:c,width:d,height:e,$b:E,Yb:E+f,ac:I,Zb:I+g,oa:u}))}return t}
function Aa({x:a=0,y:b=0,z:c=0,width:d,height:e,depth:f=0,$b:g,ac:h,Yb:k,Zb:l,oa:n=!1}){n?(n=k,k=a-d):(n=g,g=k,k=-a,a=d-a);return[a,-b,-c,g,l,k,-b,-c,n,l,a,f-b,e-c,g,h,k,f-b,e-c,n,h]};function Ba(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Ca=new Float32Array([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
async function Da(a,b){const [c,d,e,f,g,h,k]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png"),a("creature_attack","assets/enemy_bite.png"),b("assets/Enemy Dying.mp3"),b("assets/enemy_scream.mp3"),b("assets/Enemy Notices You.mp3"),a("creature_death","assets/Enemy Dying.png")]);var l=new H(c,{blink:K({x:.25,z:.25,width:.5,height:.5,qa:108/c.w,pa:108/c.u,ma:2,count:6,oa:!0})});a=za({name:"creature_attack",set:new H(e,{bite:K({x:.5,z:.75,width:1,height:2,pa:530/
e.u,qa:278/e.w,ma:7,count:42,oa:!0})}),ta:["bite"],M:!1,L:1/12});b=za({name:"creature_death",set:new H(k,{left:K({x:330/(460/1.8),y:.375,z:0,width:660/(460/1.8),height:1.8,qa:660/k.w,pa:500/k.u,ma:3,count:12}),right:K({x:1.32,y:.375,z:0,width:2.64,height:1.8,qa:660/k.w,pa:500/k.u,ma:3,count:12,oa:!0})}),ta:["left","right"],M:!1,L:.125});var n=Array(6).fill(.125);n[0]=4;l=za({name:"creature_normal",set:l,ta:["blink"],M:!0,L:n});n=[];var q=92,m=-22;const u=Math.sqrt(q*q+m*m);q/=u;m/=u;for(let t=0;29>
t;t++){const w=t%5,E=Math.floor(t/5),I=[],S=(X,ca)=>{const J=100*X,N=77*ca-48;I.push((J*q+N*m)/u,X,(J*-m+N*q)/360,100*(w+X)/d.w,77*(E+ca)/d.u)};S(1,1);S(0,1);S(1,0);S(0,0);n.push(I)}n=new H(d,{wiggle:n});return{Ib:l,Gb:a,Hb:b,Xb:n,ob:f,pb:g,Ua:h}}
class Ha{constructor(a,b,c,d){const e=a.h.T.Ib("blink",a.l),f=a.o;this.a=e;this.x=b;this.y=c;this.z=d;this.ab=this.bb=this.speed=0;this.Ga=[Ia(0,b,c,-1,1,f),Ia(1,b,c,-1,-1,f),Ia(2,b,c,1,1,f),Ia(3,b,c,1,-1,f)];this.s=e;this.state=Ja(this,a)}v(a,b){const c=this.state.Da;c&&c();this.state=b=b(this,a);b.D(a)}O(a,b,c){this.s=a(c,b)}}
function Ja(a,b){a.s=a.a;return{name:"creature_normal",D:()=>{const c=Math.abs(a.x-b.j.m);4>c&&(.5>c?a.v(b,Ka):a.v(b,La))},N:(c,d,e)=>{c=d.stack;const f=a.x;A(c,f,a.y,a.z);(e=e.x<f)&&c.push(Ca);a.s.X(d);e&&c.pop();c.pop()}}}
function La(a,b){const c=b.l;L(b.audio,a,b.h.T.Ua);a.s=a.a;return{name:"creature_hunting",D:()=>{const d=b.l;var e=b.j.m;const f=Math.abs(a.x-b.j.m);.25<f&&(e=(e<a.x?-1:1)*(.01+.02*Math.min(1,(b.l-c)/3)),a.speed=e,a.x+=e);.5>f&&1<d-c&&a.v(b,Ka)},N:(d,e,f)=>{d=e.stack;const g=a.x,h=a.z;A(d,g,a.y,h);let k=f.x<g;f=Ba(f.z-h,f.x-g);k&&(d.push(Ca),f=Math.PI-f);B(d,f);a.s.X(e);d.pop();k&&d.pop();d.pop()}}}
function Ka(a,b){const c=b.h.T.Gb("bite",b.l);a.s=c;L(b.audio,a,b.h.T.pb);let d=!1;return{name:"creature_attack",D:()=>{const e=c.I;10>=e?d=b.j.m<a.x:15>e||-1===c.H&&a.v(b,La)},N:(e,f)=>{e=f.stack;A(e,a.x,a.y,a.z);let g=d;g&&e.push(Ca);a.s.X(f);g&&e.pop();e.pop()}}}
function Ma(a,b){L(b.audio,a,b.h.T.ob);const c=b.h.T.Hb(b.j.m<a.x?"left":"right",b.l);a.s=c;return{name:"creature_death",D:()=>{1<c.I&&a.Ga.length&&(a.Ga=[]);-1===c.H&&b.$.splice(b.$.indexOf(a),1)},N:(d,e)=>{d=e.stack;A(d,a.x,a.y,b.o);c.X(e);d.pop()}}}function O(a,b){a.$.push(new Ha(a,b,0,a.o+.5+.5*Math.random()))}
function Na(a){const b=a.l;a.$.forEach(c=>{wa(c.s,b);c.state.D(a);var d=c.Ga;if(0!==d.length){var e=c.speed,f=a.l;if(f>c.bb){let g=c.ab;c.ab=(g+1)%d.length;d=d[g];e=c.x+.225*e+d.xb;.05<Math.abs(e-d.Ea)&&(c.bb=f+.125,d.$a=f+.125,d.Xa=d.Ea,d.Ya=d.Na,d.Za=d.Oa,d.Ea=e,d.Na=c.y+d.yb,d.Oa=a.o)}}})}
function Oa(a,b,c){const d=b.stack,e=c.h.T.Xb,f=c.l,g=Pa(c.j);c.$.forEach(h=>{h.state.N(a,b,g)});D(e,b);c.$.forEach(h=>{const k=h.z-.1875;h.Ga.forEach(l=>{var n=h.x+l.kb,q=h.y+l.lb;let m=l.Ea,u=l.Na,t=l.Oa;var w=l.$a;f<w&&(w=1-(w-f)/.125,m=Qa(w,l.Xa,n,m),u=Qa(w,l.Ya,q,u),t=Qa(w,l.Za,k,t));n-=m;q-=u;w=k-t;const E=Math.sqrt(n*n+q*q+w*w);A(d,m,u,t);B(d,Ba(w,n));d.push(new Float32Array([E,0,0,0,0,q,0,0,0,0,1,0,0,0,0,1]));G(e,"wiggle",Math.abs((Math.floor(24*Date.now()/1E3)+l.tb)%57+1-29));d.pop();d.pop();
d.pop()})})}function Ia(a,b,c,d,e,f){const g=.4*d;e=.1*e;b+=g;c+=e;return{index:a,kb:.05*d,lb:0,xb:g,yb:e,$a:0,Xa:b,Ya:c,Za:f,Ea:b,Na:c,Oa:f,tb:0}}function Qa(a,b,c,d){return a*(a*d+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};class P{constructor(a){this.a=!1;this.x=a}N(a,b,c){a=b.stack;const d=c.h.ba.Cb;A(a,this.x,0,c.o);D(d,b);G(d,this.a?"on":"off",0);a.pop()}}class Q{constructor(a,b){this.a=b;this.x=a}Ka(){return Ra(this.a,"down")}N(a,b,c){a=b.stack;const d=c.h.ba.hb;A(a,this.x,0,c.o);D(d,b);G(d,c.Ca?"lowerHatch":"lowerHatchClosed",0);a.pop()}}
class R{constructor(a,b){this.a=b;this.x=a}Ka(){return Ra(this.a,"up")}N(a,b,c){a=b.stack;const d=c.h.ba.Ab,e=c.h.ba.hb;A(a,this.x,0,c.o);D(d,b);G(d,"main",0);D(e,b);G(e,"upperHatch",0);a.pop()}}function Ra(a,b){return{Pa:a,bc:b,eb:Date.now()/1E3,gb:1}};const Sa=434/1.8;function Pa(a){return{x:a.m,z:a.R+1.8-.1}}function Ta(a){return(a=a.s.ya())?a.Va:null}function T(a,b){a.ib=b;0!==b&&(a.ua=Math.sign(b))}
class Ua{constructor(a,b,c){this.m=b;this.ka=0;this.R=c;this.ua=1;this.ib=0;this.s=a.Ma("right",0);this.state={name:"unstarted",D:d=>this.v(d,U),N:()=>{throw Error("Hero did not get processed before rendering!");}}}O(a,b,c=-1===this.ua?"left":"right"){this.s=a(c,b)}X(a,b){a=b.stack;A(a,this.m,this.ka,this.R);this.s.X(b);a.pop()}v(a,b,c){const d=this.state.Da;d&&d();this.state=b=b(this,a,c);b.D(a)}}function Va(a,b,c){const d=c.j.state.N;d?d(a,b):c.j.X(a,b)}
function U(a,b){let c=!0;a.O(b.h.j.Ma,b.l);return{name:"normal",D:d=>{const e=d.j,f=d.l;var g=d.input;const h=ta(g,"down","up");if(!h||!d.S.some(l=>{if(l instanceof P){if(1===h&&!l.a&&.4>Math.abs(e.m-l.x))return e.v(d,Wa,l),!0}else if(l instanceof Q){if(-1===h&&.4>Math.abs(e.m-l.x)&&d.Ca)return e.v(d,Xa,l),!0}else if(l instanceof R&&"final"!==d.name&&1===h&&.4>Math.abs(e.m-l.x))return e.v(d,Ya,l),!0}))if(ra(g,"attack"))e.v(d,Za);else{g=1.6*d.Fa*ta(g,"left","right");var k=e.m+g;k<d.J+1?g=d.J+1-e.m:
k>d.K-1&&(g=d.K-1-e.m);T(e,g/d.Fa);k=-1===e.ua?"left":"right";g?(e.m+=g,c&&(c=!1,e.O(d.h.j.Nb,f))):c||(c=!0,e.O(d.h.j.Ma,f));xa(e.s,k)}}}}function Za(a,b){const c=a.m+300/Sa*a.ua;var d=b.$.find(e=>.6>Math.abs(c-e.x));d&&"creature_death"!==d.state.name&&d.v(b,Ma);a.O(b.h.j.Eb,b.l);T(a,0);d=b.h.j.ub;L(b.audio,a,d[Math.floor(Math.random()*d.length)]);return{name:"attacking",D:e=>{-1===a.s.H&&a.v(e,U)}}}
function Wa(a,b,c){a.O(b.h.j.Mb,b.l,"main");T(a,0);a.m=c.x;return{name:"switch_on",D:()=>{if(!c.a&&6<=a.s.I){L(b.audio,c,b.h.j.Bb);b.Ca=!0;c.a=!0;const d=b.S.find(e=>e instanceof Q);d&&L(b.audio,d,b.h.ba.vb)}-1===a.s.H&&a.v(b,U)}}}function Ya(a,b,c){a.O(b.h.j.Fb,b.l,"up");T(a,0);a.ka=.55;a.m=c.x;b.transition=c.Ka();return{name:"climbing",D:d=>{-1===a.s.H?a.v(d,U):a.R=d.o+.3*Math.min(5,a.s.I)},Da:()=>{a.ka=0;a.R=b.o}}}
function $a(a,b){T(a,0);a.O(b.h.j.Jb,b.l,"down");a.ka=.55;b.sa++;return{name:"descending",D:c=>{-1===a.s.H?a.v(c,U):a.R=c.o+.3*Math.min(5,8-a.s.I)},Da:()=>{a.ka=0;a.R=b.o;b.sa--}}}function Xa(a,b,c){T(a,0);a.m=c.x;a.O(b.h.j.Kb,b.l,"enter");b.transition=c.Ka();return{name:"descending",D:d=>{-1===a.s.H&&a.v(d,U)}}}
function ab(a,b){const c=b.l;a.O(b.h.j.Lb,b.l,"exit");T(a,0);b.sa++;return{name:"entering_hatch",D:()=>{const d=a.s;if(b.l<c+1){var e=b.l;if(!d.za.includes("exit"))throw Error(`${d} does not have mode ${"exit"}`);d.A=0;d.a="exit";d.I=0;d.H=e+d.ha[0]}else-1===d.H?a.v(b,U):a.R=b.o+([-.5,-.5,-.3,-.3][a.s.I]||0)},N:(d,e)=>{b.l<c+1||a.X(d,e)},Da:()=>{b.sa--;a.R=b.o}}}
async function bb(a,b){const [c,d,e,f,g,h,k,l,n]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png"),a("hero_climbing","assets/Climbing Up.png"),a("hero_hatch","assets/climbing_in.png"),a("hero_light","assets/Hero flipping Switch.png"),Promise.all([b("assets/Grunt1.mp3"),b("assets/Grunt2.mp3"),b("assets/Grunt3.mp3")]),b("assets/light.mp3"),Promise.all([b("assets/Hero Dying 1.mp3"),b("assets/Hero Dying 2.mp3"),
b("assets/Hero Dying 3.mp3")])]);a={name:"hero_hatch_enter",Y:g,C:350,B:406,F:161,G:479,ia:6,M:!1,L:.125,ca:[{f:201,g:137,b:172,c:175},{f:422,g:246,b:461,c:259},{f:67,g:659,b:113,c:651},{f:419,g:658,b:462,c:648},{f:80,g:1041,b:106,c:1067},null],ea:"enter"};b={name:"hero_climbing_up",Y:f,C:222,B:412,F:110,G:412,ia:8,M:!1,L:.125,ca:[{f:128,g:60,b:65,c:54},{f:329,g:155,b:277,c:148},{f:579,g:58,b:518,c:56},{f:772,g:157,b:721,c:156},{f:95,g:575,b:65,c:567},{f:337,g:472,b:286,c:465},null,null],ea:"up",
scale:1.4};return{ub:k,Ma:V({name:"hero_idle",Y:c,C:405,B:434,F:220,G:434,ia:16,M:!0,L:1/12,ca:[{f:388,g:104,b:385,c:170},{f:792,g:105,b:790,c:170},{f:1198,g:105,b:1195,c:169},{f:1602,g:106,b:1600,c:170},{f:2008,g:106,b:2005,c:172},{f:388,g:539,b:385,c:604},{f:794,g:540,b:790,c:605},{f:1196,g:539,b:1196,c:604},{f:1602,g:539,b:1602,c:604},{f:2009,g:541,b:2007,c:604},{f:386,g:974,b:385,c:1036},{f:792,g:972,b:790,c:1033},{f:1198,g:974,b:1196,c:1038},{f:1602,g:972,b:1601,c:1036},{f:2010,g:974,b:2005,
c:1044},{f:386,g:1406,b:385,c:1477}]}),Nb:V({name:"hero_walk",Y:d,C:424,B:444,F:258,G:444,ia:8,M:!0,L:.125,ca:[{f:408,g:110,b:404,c:166},{f:830,g:110,b:829,c:166},{f:408,g:554,b:404,c:614},{f:830,g:554,b:829,c:614},{f:408,g:998,b:404,c:1055},{f:830,g:998,b:829,c:1055},{f:408,g:1444,b:404,c:1500},{f:830,g:1444,b:829,c:1500}]}),Eb:V({name:"hero_attack",Y:e,C:644,B:565,F:284,G:565,ia:5,M:!1,L:1/12,ca:[{f:422,g:285,b:415,c:353},{f:936,g:367,b:868,c:380},{f:1507,g:311,b:1469,c:318},{f:162,g:948,b:206,
c:943},{f:1025,g:934,b:976,c:962}]}),Fb:V(b),Jb:V({...b,name:"hero_hatch_descend",ea:"down",fb:!0}),Kb:V(a),Lb:V({...a,name:"hero_hatch_exit",ea:"exit",fb:!0}),Mb:V({name:"hero_switch",Y:h,C:274,B:444,F:104,G:442,ia:9,M:!1,L:1/12,ea:"main",ca:null}),Bb:l,wb:n}}
function V(a){var b=a.Y;const c=a.C,d=a.B,e=a.F,f=a.G,g=a.fb?m=>[...m].reverse():m=>m,h=Sa/(a.scale||1),k=Math.floor(b.w/c),l={x:e/h,z:(d-f)/h,width:c/h,height:d/h,qa:c/b.w,pa:d/b.u,ma:k,count:a.ia},n=a.ca&&a.ca.map((m,u)=>{if(!m)return{Va:null};const t=m.f,w=m.g;return{Va:{x:(t-(u%k*c+e))/h,z:(Math.floor(u/k)*d+f-w)/h,angle:Ba(-(w-m.c),t-m.b)}}});let q;a.ea?(q=[a.ea],b=new H(b,{[a.ea]:g(K(l))})):(q=["left","right"],b=new H(b,{right:g(K(l)),left:g(K({...l,oa:!0}))}));return za({name:a.name,set:b,
ta:q,M:a.M,L:a.L,Qb:n&&g(n)})};function cb(a,b){var c=376/b;const d=c/(484/b),e=c/(268/b);c/=1.25;const f=b/a*c;return{Ob:new Float32Array([f,0,0,0,0,0,1/1.5,(e-d)/1.5,0,c,0,0,0,0,0,(d+e)/2]),dc:d,cc:e,Sb:f,Tb:c,C:a,B:b,la:554/b*d/c-1.25,W:.3}}
async function db(a,b,c){const [d,e,f,g,h,k,l,n]=await Promise.all([b("ladder","assets/ladder.png"),b("wall","assets/Back Wall.png"),b("floor","assets/floor.png"),b("ceiling","assets/ceiling.png"),b("wall","assets/side_wall.png"),b("set_pieces","assets/set_pieces.png"),b("lights","assets/Light Switch Flip.png"),c("assets/Metal Door.mp3")]);b=new H(d,{main:[W(a,d,{F:d.w,G:d.u,C:d.w,B:d.u,offsetY:.55,na:1.25})]});c={};c.barrel1=[W(a,k,{F:370,G:270,C:338,B:222,offsetY:.55})];c.upperHatch=[W(a,k,{F:2036,
G:725,C:345,B:311,offsetY:.56,na:2.2,offsetX:-.1})];c.lowerHatch=[W(a,k,{F:2036,G:725,C:345,B:311,offsetY:.1,qb:!0,na:.5})];c.lowerHatchClosed=[W(a,k,{F:842,G:1166,C:349,B:187,offsetY:.1,na:.3})];c=new H(k,c);const q=new H(l,{on:[W(a,l,{F:316,G:1110,C:118,B:152,offsetY:.75,na:1.4})],off:[W(a,l,{F:316,G:298,C:118,B:152,offsetY:.75,na:1.4})]});return{da:a,fc:e,sb:f,nb:g,Vb:h,Ab:b,hb:c,Cb:q,vb:n}}
function eb({fc:a,sb:b,nb:c,Vb:d,da:e},f,g){const h=g-e.W;g=g+f+e.W;var k=494/a.u,l=1016/a.u,n=(l-k)*a.u/2.5*f/a.w;a=new H(a,{main:[[g,.75,2.5,n,k,g,.75,0,n,l,h,.75,2.5,0,k,h,.75,0,0,l]]});k=110/b.u;l=220/b.u;n=(l-k)*b.u/1.5*f/b.w;b=new H(b,{main:[[g,-.75,-e.la,n,1,h,-.75,-e.la,0,1,g,-.75,0,n,l,h,-.75,0,0,l,g,.75,0,n,k,h,.75,0,0,k]]});k=144/c.u;l=32/c.u;f=(l-k)*c.u/1.5*f/c.w;c=new H(c,{main:[[g,-.75,2.5+e.la,f,0,h,-.75,2.5+e.la,0,0,g,-.75,2.5,f,l,h,-.75,2.5,0,l,g,.75,2.5,f,k,h,.75,2.5,0,k]]});f=438/
d.w;k=318/d.w;l=194/d.u;n=1164/d.u;const q=84/d.w;e=[h,-.75,2.5,f,l,h,-.75,0,f,n,h+e.W,-.75,2.5,k,l,h+e.W,-.75,0,k,n,h+e.W,.75,2.5,q,414/d.u,h+e.W,.75,0,q,964/d.u];f=[];for(k=0;k<e.length;k+=5)f.push(g+(h-e[k]),e[k+1],e[k+2],e[k+3],e[k+4]);d=new H(d,{right:[f],left:[e]});return{ec:a,rb:b,mb:c,Ub:d}}
function W(a,b,{offsetX:c=0,offsetY:d=0,na:e=0,F:f,G:g,C:h,B:k,qb:l=!1,ic:n=!1}){let q=(g-k)/b.u;g/=b.u;l&&(l=q,q=g,g=l);l=(f-h)/b.w;b=f/b.w;n&&(n=l,l=b,b=n);const m=a.Sb;n=a.Tb;f=(d+.75)/1.5;f=a.dc*(1-f)+a.cc*f;c=c*m/f;e=e*n/f;h=h/a.C/2;k=k/a.B/2;a=(c-h)*f/m;h=(c+h)*f/m;c=(e+k)*f/n;k=(e-k)*f/n;return[a,d,c,l,q,h,d,c,b,q,a,d,k,l,g,h,d,k,b,g]};function L(a,b,c){const d=a.A;var e=d.get(b);e&&e.stop();a=a.a;e=a.createBufferSource();e.buffer=c;e.connect(a.destination);e.start();d.set(b,e)}function fb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.a.decodeAudioData(c))}class gb{constructor(){this.a=new AudioContext;this.A=new WeakMap}};function hb(a){const b=a.l,c=a.Fa,d=a.j,e=a.Qa;var f=48*(1-a.Ra);f=Math.floor(f*b)-Math.floor(f*(b-c));for(let m=0;m<f;m++){var g=2*Math.random()+1.4;let u=.1*Math.sin(2*Math.PI*Math.random());var h=Ta(d);if(!h)break;const t=d.m+h.x*d.ua,w=h.z+d.R,E=Math.PI/4*(Math.random()-.5)+h.angle;h=g*Math.sin(E);g=g*Math.cos(E)+d.ib;100<e.length&&e.pop();e.push({U:!1,x:t,y:d.ka+.01,z:w,aa:g,ra:u,ga:h,startTime:b,Ta:b+1.5,cb:!1})}const k=a.o,l=9.8*c,n=0*c,q=1-.8*c;e.forEach(m=>{var u=m.U;if(!u&&b<m.Ta){m.x+=
m.aa*c;m.y+=m.ra*c;m.z+=m.ga*c;u=m.ga;m.cb?(m.aa*=q,m.ra*=q):(u-=l,m.aa-=n,m.ga=u);if(m.x<a.J||m.x>a.K||m.z>a.o+2.5)m.U=!0;const t=m.y;if(-.75>t||.75<t){const w=0<t?.75:-.75;m.y=w+(w-t);m.ra=-m.ra}m.z<k&&(-.01<u?(m.z=k,m.ga=0,m.cb=!0):(m.z=k+k-m.z,m.ga=-.25*u))}else u||(m.U=!0)});e.sort(ib)}
function jb(a){const b=1/18/18,c=f=>Math.max(0,Math.min(255,Math.round(256*(1-b*f*f)))),d=[];for(let f=0;2>f;f++)for(let g=0;18>g;g++)for(let h=0;2>h;h++){let k;var e=void 0;let l;e=g+6*h;18>e?(k=255,e=c(e),l=255):l=e=k=0;c(g+6*h);c(g+6*h+1);for(let n=0;2>n;n++)d.push(k,e,e,l)}a=pa({name:"spark",width:72,height:2,i:a,Ja:new Uint8Array(d)});return new H(a,{fading:K({x:1/180,width:.04,height:2/180,qa:1/18,pa:1,ma:18,count:18})})}function ib(a,b){return a.U?b.U?0:1:b.U?-1:a.y-b.y}
function kb(a,b){const c=b.h.Wb,d=a.stack;D(c,a);b.Qa.forEach(e=>{e.U||(A(d,e.x,e.y,e.z),B(d,(0<=e.aa?Math.PI:0)+Math.atan(e.ga/e.aa)),G(c,"fading",Math.floor(12*(b.l-e.startTime))),d.pop(),d.pop())})};function Z(a){const b=a.J,c=a.K,d=a.o,e=a.V;return{name:a.name,h:e.h,input:e.input,audio:e.audio,$:[],l:0,Rb:Date.now()/1E3-1/60,Fa:0,J:b,K:c,o:d,xa:eb(e.h.ba,c-b,b),Qa:[],Ca:!1,j:new Ua(e.h.j,(c+b)/2,d),transition:null,sa:0,P:a.P,S:[],La:!1,Ra:0}};function lb(a,b,c){const d=a.a.i,e=a.A;d.bindFramebuffer(d.FRAMEBUFFER,a.za);d.viewport(0,0,e.w,e.u);la(a.a,(f,g)=>{mb(f,g,b,a,c)})}
class nb{constructor(a,b,c,d){b/=4;c/=4;var e=new ia({i:a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  gl_Position = u_projection * vec4(a_position, 1);\n  v_texturePosition = a_texturePosition;\n}"),f=new ia({i:a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\nuniform vec4 u_color;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    \n    if (u_threshold != -1.f) {\n      color.a -= u_threshold;\n      if (color.a <= u_threshold) {\n          discard;\n      }\n      output_color = color;\n    } else {\n      if (color.a == 0.f) {\n        discard;\n      }\n      output_color = u_color;\n    }\n}");const g=
new ka({i:a,da:"projection"});ja(g,e,f).link();e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);f=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,f);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0);a.bindFramebuffer(a.FRAMEBUFFER,
null);const h=128/d;d=pa({name:"fade",width:64,height:64,i:a,Ja:ob(d)});this.a=g;this.A=qa({Y:e,name:"lighting",width:b,height:c,i:a});this.za=f;this.ha=new H(d,{main:[[h,0,-h,1,0,h,0,h,1,1,-h,0,-h,0,0,-h,0,h,0,1]]});a=pa({name:"solid",width:1,height:1,i:a,Ja:new Uint8Array([255,255,255,255])});this.Ba=new H(a,{main:[[0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,1,0,0]]})}}
function mb(a,b,c,d,e){a.blendFunc(a.ONE,a.ONE);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);const f=b.Z.threshold,g=b.Z.color;a.uniform1f(f,-1);const h=b.stack;c(h,()=>{const k=d.Ba;D(k,b);e.forEach(n=>{a.uniform4f(g,0,0,0,window.lightsOn||n.Ca?1:n.P);const q=n.h.ba.da,m=n.J-q.W;h.push(new Float32Array([n.K+q.W-m,0,0,0,0,0,0,0,0,0,2*q.la+2.5,0,m,-.75,n.o-q.la,1]));G(k,"main",0);h.pop()});const l=d.ha;D(l,b);a.uniform4f(g,0,0,0,1);e.forEach(n=>{const q=n.l;n.Qa.forEach(m=>
{if(!m.U){var u=m.startTime;u=(q-u)/(m.Ta-u);a.uniform1f(f,.5*u*u);A(h,m.x,m.y,m.z);G(l,"main",0);h.pop()}})})})}function ob(a){const b=new Uint8Array(16384),c=(f,g)=>{f/=a;g/=a;return f*f+g*g},d=Math.min(c(32,0),c(32,0));for(let f=0;64>f;f++)for(let g=0;64>g;g++){const h=4*(64*f+g);var e=c(g-32,f-32);const k=1-Math.sqrt(e/d);e=1E-4>=e?5:0;const l=Math.max(Math.round(255*k*k),0);b[h]=e+Math.max(Math.round(20*k),0);b[h+1]=e;b[h+2]=e;b[h+3]=l}return b};function pb(a,b){const c=a.a;let d=c.get(b);d||(d=qb(a.V,b),c.set(b,d));return d}function rb(a,b){a.va.name!==b&&(a.va=pb(a,b))}class sb{constructor(a,b){this.V=a;this.a=new Map([[b.name,b]]);this.va=b}}
function qb(a,b){switch(b){case "start":return a=Z({V:a,name:b,K:5,J:-5,o:80,P:.4}),a.j.m=-1,a.S.push(new P(1),new Q(3,"second")),a;case "second":return a=Z({V:a,name:b,K:5,J:-10,o:75,P:.4}),a.S.push(new P(1),new R(3,"start"),new Q(-7,"third")),O(a,-4),a;case "third":return a=Z({V:a,name:b,K:5,J:-10,o:70,P:.4}),a.S.push(new P(2),new R(-7,"second"),new Q(3,"fourth")),O(a,0),a;case "fourth":return a=Z({V:a,name:b,K:12,J:0,o:65,P:.2}),O(a,1.5),O(a,9),a.S.push(new P(6),new R(3,"third"),new Q(10,"fifth")),
a;case "fifth":return a=Z({V:a,name:b,K:28,J:7,o:60,P:0}),O(a,20),O(a,25),a.S.push(new P(23),new R(10,"fourth"),new Q(25,"final")),a;case "final":return a=Z({V:a,name:b,J:10,K:45,o:55,P:0}),a.S.push(new R(25,"fifth")),a;default:throw Error(`Unrecognized room name "${b}"`);}}function tb(a){return{x:Math.min(Math.max(a.j.m,a.J+1),a.K-1),y:0,z:a.o+1.25}};let ub=()=>{};function vb(){document.getElementById("intro").remove();document.getElementById("skipActions").remove();document.getElementById("gameActions").classList.remove("hidden");const a=document.getElementById("canvas");a.classList.add("visible");a.addEventListener("dblclick",()=>{a.requestFullscreen()});document.getElementById("fullscreen").addEventListener("click",()=>{a.requestFullscreen()});requestAnimationFrame(ub)}
function wb(){document.getElementById("start").remove();document.getElementById("skip").addEventListener("click",()=>{vb()});document.getElementById("skipActions").classList.remove("hidden")}function xb(){const a=document.getElementById("start"),b=document.getElementById("introVideo");b.addEventListener("ended",()=>{vb()},{once:!0});a.addEventListener("click",()=>{b.play().then(()=>{wb();b.addEventListener("click",()=>{b.paused?b.play():b.pause()})},c=>{console.error(c)})},{once:!0})}
window.onload=async function(){function a(r,p){r.push(u.Ob);A(r,-M.x,-M.y,-M.z);A(r,0,0,Ea);B(r,Fa);p();r.pop();r.pop();r.pop()}function b(r,p,v){const y=p.stack;A(y,0,0,v.o);var z=v.xa.ec;D(z,p);G(z,"main",0);z=v.xa.rb;D(z,p);G(z,"main",0);z=v.xa.mb;D(z,p);G(z,"main",0);z=v.xa.Ub;D(z,p);G(z,"left",0);G(z,"right",0);y.pop();v.S.forEach(x=>{x.N(r,p,v)});Va(r,p,v);Oa(r,p,v);kb(p,v)}function c(r,p,v){r.bindFramebuffer(r.FRAMEBUFFER,null);r.viewport(0,0,q,m);r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);
r.clearColor(0,0,0,1);r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);r.activeTexture(r.TEXTURE1);E.A.bindTexture();r.uniform1i(p.Z.lighting,1);r.activeTexture(r.TEXTURE0);a(p.stack,()=>{v.forEach(y=>{const z=p.stack.depth();b(r,p,y);p.stack.depth()!==z&&console.error("yo!")})})}function d(){const r=Date.now()/1E3;N=-1===N?60:.125/(r-Ga)+.875*N;e.innerHTML=`fps=${Math.round(N)}`;Ga=r;var p=Math.sin(Math.PI*(r+0)/8)/2+Math.sin(Math.PI*(r+0)/3)/8,v=Math.sin(Math.PI*(r+170)/8)/2+Math.sin(Math.PI*(r+130)/
3)/8;Fa=Math.asin((p-v)/100);Ea=(p+v)/2;p=J.va;v=null;var y=p.transition;y&&(y.eb+y.gb<r?(p.transition=null,rb(J,y.Pa),p=J.va):v=pb(J,y.Pa));const z=v?[p,v]:[p];z.forEach(x=>{{const F=r-x.Rb;x.Fa=F-x.l;x.l=F}});M=tb(p);v&&(y=Math.sin(Math.PI/2*((r-y.eb)/y.gb)),v=tb(v),M={x:M.x*(1-y)+v.x*y,y:M.y*(1-y)+v.y*y,z:M.z*(1-y)+v.z*y});sa(h)%2&&(l=!l,window.lightsOn=l);"fifth"===p.name&&(p.P=Math.max(0,.2*(1-p.l/5)));"final"===p.name&&(!p.La&&32<p.l&&(p.La=!0,L(p.audio,p,p.h.j.wb[1])),v=Math.min(1,p.l/30),
1===v&&1!==p.Ra&&L(p.audio,p,p.h.T.Ua),p.Ra=v*v);z.forEach(x=>{{let Y=x.transition;var F=x.j;wa(F.s,x.l);F.state.D(x);if(x.transition&&!Y){Y=x.transition;{F=pb(J,Y.Pa);const ea=F.j;"up"===Y.bc?(ea.m=x.j.m,ea.v(F,ab)):(ea.m=x.j.m,ea.v(F,$a))}}hb(x);Y||x.sa||Na(x)}});lb(E,a,z);la(w,(x,F)=>c(x,F,z));p.La||requestAnimationFrame(d)}const e=document.getElementById("fps"),f=document.getElementById("canvas");var g=window.getComputedStyle(f);xb();const h=new ua(document.body);C(h,"left",["a","ArrowLeft"]);
C(h,"right",["d","ArrowRight"]);C(h,"showLights",["l"]);C(h,"attack",["f"," "]);C(h,"up",["w","ArrowUp"]);C(h,"down",["s","ArrowDown"]);C(h,"lightUp",["y"]);C(h,"lightDown",["h"]);var k=parseInt(g.getPropertyValue("width"),10);g=parseInt(g.getPropertyValue("height"),10);let l=!1;const n=window.devicePixelRatio||1,q=n*k,m=n*g;f.width=q;f.height=m;const u=cb(k,g),t=f.getContext("webgl2",{antialias:!1,alpha:!1});t.enable(t.BLEND);t.enable(t.DEPTH_TEST);t.depthFunc(t.LEQUAL);k=new ia({i:t,type:"vertex"},
"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n\n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
g=new ia({i:t,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const w=new ka({i:t,da:"projection"});ja(w,k,g).link();const E=new nb(t,q,m,360),I=new gb;k=(r,p)=>na({i:t,name:r,src:p});g=r=>fb(I,r);const [S,X,ca]=await Promise.all([db(u,k,g),Da(k,g),bb(k,g)]);k={h:{T:X,j:ca,ba:S,Wb:jb(t)},input:h,audio:I};const J=new sb(k,qb(k,"start"));let N=-1;document.addEventListener("fullscreenchange",()=>{});let M={x:0,y:0,z:0},Fa,Ea,Ga=Date.now();ub=d;f.onmousemove=()=>{}};
