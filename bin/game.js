'use strict';class ca{constructor(a,b,c){this.name=c;this.C=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.C}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.C}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function da(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new ca(c[1],c[2],c[3]))});return b}
const fa=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function ha(a,b){a.a.uniformMatrix4fv(a.i,!1,b);a.b.push(b)}function D(a,b,c,e=0){var d=a.b;d=d.length?d[d.length-1]:fa;ha(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function ia(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ma{constructor(a,b){this.a=a;this.i=b;this.b=[];a.uniformMatrix4fv(b,!1,fa)}pop(){return this.b.pop()}push(a){var b=this.b;0===b.length?ha(this,a):(b=b[b.length-1],ha(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class na{constructor(a,b){this.name=a.name;var c=this.a=a.a;a=this.type=a.type;switch(a){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.b=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.za=da(b)}}
function oa(a,...b){const c=a.a,e=a.$;b.forEach(d=>{a.ga.push(d);c.attachShader(e,d.b)});return a}class pa{constructor(a){this.name=a.name;this.S=a.S;a=this.a=a.a;this.b=!1;this.$=a.createProgram();this.ga=[];this.u={};this.v={};this.stack=null}link(){if(this.b)return this;var a=this.a,b=this.$;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.b=!0;return this}}
function qa(a,b){var c=a.a,e=a.$;c.useProgram(e);for(var d={},g={},h=a.ga,f=0;f<h.length;f++)for(var k=h[f].za,l=0;l<k.length;l++){var n=k[l];1===n.type?n.C in d||(d[n.name]=c.getUniformLocation(e,n.C)):n.C in g||(g[n.name]=c.getAttribLocation(e,n.C))}a.u=d;a.v=g;if(e=a.S)if(e in a.u)a.stack=new ma(c,a.u[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.u={},a.v={},a.stack=null}}
class xa{constructor(a,b,c,e,d){this.a=a;this.name=b;this.w=c;this.j=e;this.b=d(a)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}function I(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new xa(a.a,a.name,c,e,ya(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function za(a){const b=a.width,c=a.height;return new xa(a.a,a.name,b,c,ya(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.ha,0)}))}function Aa(a){return new xa(a.a,a.name,a.width,a.height,()=>a.fa)}
function ya(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);return c}};function J(a,b){const c=a.b.a;let e=a.i;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.i=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.B,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.b.bindTexture();c.uniform1i(b.u.texture,0);c.enableVertexAttribArray(b.v.texturePosition);c.vertexAttribPointer(b.v.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.v.position);c.vertexAttribPointer(b.v.position,3,c.FLOAT,!1,20,0)}
function M(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.b.a;const e=b.aa;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Na)}
class N{constructor(a,b){this.b=a;this.i=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],h=[],f=g.length;if(0===f)throw Error("Sprite declared with 0 points");const k=g[0].length;if(0==k)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=k/5;for(let n=0;n<f;n++){const r=g[n];if(r.length!==k)throw Error("Sprite declared with inconsistent lengths of elements");h.push(e);c.push.apply(c,r);e+=l}a[d]={Xa:this,name:d,aa:h,Na:l}}this.B=new Float32Array(c)}}
function Ba(a,b,c){if(!a.Ja.includes(b))throw Error(`${a} does not have mode ${b}`);a.b=0;a.Z=b;a.K=0;a.i=Ca(a,0,c)}function Da(a,b,c){const e=a.Z;if(null==e)throw Error(`${a} tried rendering while inactive`);let d=a.K;const g=a.i;-1!==g&&g<=c&&(++d===a.B.length&&(d=0,a.b++),a.K=d,a.i=Ca(a,d,c));J(a.la,b);M(a.la,e,d)}
class Ea{constructor(a,b){const c=a.ma;this.N=a.name;this.Ja=a.ba;this.Z=null;this.Ka="number"===typeof c?c:c?-1:0;this.la=a.set;this.B=b;this.b=0;this.i=this.K=-1}name(){return this.N}toString(){return`Sprite/${this.N}`}}function Ca(a,b,c){const e=a.B;return b+1===e.length&&a.b===a.Ka?-1:c+e[b]}
function Fa(a){const b=a.name,c=a.ka,e=a.set.data;let d=-1;a.ba.forEach(h=>{const f=e[h];if(!f)throw Error(`Sprite/${b} has non-existent mode ${h}`);if(-1===d)d=f.aa.length;else if(d!==f.aa.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);const g="number"===typeof c?Array(d).fill(c):c;return()=>new Ea(a,g)}
function Ga({Y:a=0,bb:b=0,cb:c=0,X:e,O:d,U:g,W:h,l:f,count:k,s:l=!1}){const n=e/g;g=d/g;return T({x:a*n,y:b,z:c*g,width:n,height:g,V:e/h.w,T:d/h.j,l:f,count:k,s:l})}function T({x:a=0,y:b=0,z:c=0,width:e,height:d,V:g,T:h,l:f,count:k,Za:l=0,$a:n=0,ab:r=g,Ya:x=h,s:t=!1}){const y=[];for(let A=0;A<k;A++){const G=l+A%f*r,ea=n+Math.floor(A/f)*x;y.push(Ha({x:a,y:b,z:c,width:e,height:d,xa:G,va:G+g,ya:ea,wa:ea+h,s:t}))}return y}
function Ha({x:a=0,y:b=0,z:c=0,width:e,height:d,xa:g,ya:h,va:f,wa:k,s:l=!1}){l?(l=f,f=a-e):(l=g,g=f,f=-a,a=e-a);return[a,b,-c,g,k,f,b,-c,l,k,a,b,d-c,g,h,f,b,d-c,l,h]};function X(a,b,c){a=a.i;null!=c?a.set(b,c):a.delete(b)}function Ia(a,b){b=a.i.get(b);const c=a.b;return!!b&&!!b.some(e=>(e=c.get(e))?(e.M=0,null!=e.P):!1)}function Ja(a){const b=a.i.get("showLights");if(b){const c=a.b;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.M,d.M=0,e):e,0)}return 0}function Ka(a,b,c){b=Ia(a,b)?1:0;return(Ia(a,c)?1:0)-b}
class Wa{constructor(a){this.b=new Map;this.i=new Map;a.addEventListener("keydown",b=>{Xa(this,b,!0)});a.addEventListener("keyup",b=>{Xa(this,b,!1)});a.onblur=()=>{this.b.clear()};a.onfocus=()=>{this.b.clear()}}}function Xa(a,b,c){b=b.key;a=a.b;const e=a.get(b);c?null==e?a.set(b,{P:Date.now(),M:1}):(null==e.P&&(e.P=Date.now()),e.M++):null!=e&&(e.P=null)};function Ya(a,b){const c=a.i.a,e=a.b;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.N);c.viewport(0,0,e.w,e.j);qa(a.i,(d,g)=>{Za(d,g,a,b)})}
class $a{constructor(a,b,c,e){b/=4;c/=4;var d=new na({a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),g=
new na({a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const h=new pa({a,S:"projection"});oa(h,d,g).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=za({name:"fade",width:64,height:64,a,ha:ab(e)});this.i=h;this.b=Aa({fa:d,name:"lighting",
width:b,height:c,a});this.N=g;this.B=new N(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Za(a,b,c,e){e.La?a.clearColor(0,0,0,1):a.clearColor(0,0,0,.2);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.Pa(a,b,()=>{const d=c.B;J(d,b);const g=b.u.threshold,h=e.Ta;e.Oa.forEach(f=>{if(!f.m){var k=f.startTime;k=(h-k)/(f.ja-k);a.uniform1f(g,.5*k*k);D(b.stack,f.x,f.y,f.z);M(d,"main",0);b.stack.pop()}})})}
function ab(a){const b=new Uint8Array(16384),c=(g,h)=>{g/=a;h/=a;return g*g+h*h},e=Math.min(c(32,0),c(32,0));for(let g=0;64>g;g++)for(let h=0;64>h;h++){const f=4*(64*g+h);var d=c(h-32,g-32);const k=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const l=Math.max(Math.round(255*k*k),0);b[f]=d+Math.max(Math.round(20*k),0);b[f+1]=d;b[f+2]=d;b[f+3]=l}return b};function bb(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Y=434/1.8,cb=new Map;
async function db(a){[a]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Fa({name:"hero_idle",set:eb({name:"hero_idle",fa:a,Ua:405,Fa:434,Va:220,Wa:434,Da:16,Ca:[{g:388,h:104,c:385,f:170},{g:792,h:105,c:790,f:170},{g:1198,h:105,c:1195,f:169},{g:1602,h:106,c:1600,f:170},{g:2008,h:106,c:2005,f:172},{g:388,h:539,c:385,f:604},{g:794,h:540,c:790,f:605},{g:1196,h:539,c:1196,f:604},{g:1602,
h:539,c:1602,f:604},{g:2009,h:541,c:2007,f:604},{g:386,h:974,c:385,f:1036},{g:792,h:972,c:790,f:1033},{g:1198,h:974,c:1196,f:1038},{g:1602,h:972,c:1601,f:1036},{g:2010,h:974,c:2005,f:1044},{g:386,h:1406,c:385,f:1477}]}),ba:["left","right"],ma:!0,ka:1/12})();console.log(cb);return{Ia:a}}
function eb(a){const b=a.fa,c=a.Ua,e=a.Fa,d=a.Va,g=a.Wa,h=a.Da,f=Math.floor(b.w/c),k={x:d/Y,z:(e-g)/Y,width:c/Y,height:e/Y,V:c/b.w,T:e/b.j,l:f,count:h},l=a.Ca.map(({g:n,h:r,c:x,f:t},y)=>({x:(n-(y%f*c+d))/Y,z:(Math.floor(y/f)*e+g-r)/Y,angle:bb(-(r-t),n-x)}));if(l.length!==h)throw Error(`flareData length ${l.length} but expects ${h}`);cb.set(a.name,l);return new N(b,{right:T(k),left:T({...k,s:!0})})};const fb=.15*.75;
async function gb(a){const [b,c]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png")]);a=new N(b,{blink:T({x:.15,z:.15,width:.3,height:.3,V:108/b.w,T:108/b.j,l:2,count:6})});var e=Array(6).fill(.125);e[0]=4;a=Fa({name:"creature_normal",set:a,ba:["blink"],ma:!0,ka:e});e=[];var d=92,g=-22;const h=Math.sqrt(d*d+g*g);d/=h;g/=h;for(let f=0;29>f;f++){const k=f%5,l=Math.floor(f/5),n=[],r=(x,t)=>{const y=100*x,A=77*t-48;n.push((y*d+A*g)/h,x,(y*-g+A*d)/360/2,100*(k+x)/c.w,
77*(l+t)/c.j)};r(1,1);r(0,1);r(1,0);r(0,0);e.push(n)}e=new N(c,{wiggle:e});return{Ma:a,Sa:e}}class hb{constructor(a,b,c,e){const d=a.ua.ia.Ma();Ba(d,"blink",a.H);this.x=this.Ra=b;this.y=c;this.z=e;this.ra=this.sa=0;this.ea=[ib(0,b,c,-1,1),ib(1,b,c,-1,-1),ib(2,b,c,1,1),ib(3,b,c,1,-1)];this.Qa=d}}
function jb(a){const b=a.H;a.L.forEach(c=>{c.x=c.Ra+.5*Math.sin(b);var e=.5*Math.cos(b);if(b>c.sa){var d=c.ra;c.ra=(d+1)%c.ea.length;d=c.ea[d];e=c.x+.225*e+d.Ga;.05<Math.abs(e-d.R)&&(c.sa=b+.125,d.qa=b+.125,d.na=d.R,d.oa=d.ca,d.pa=d.da,d.R=e,d.ca=c.y+d.Ha,d.da=0)}})}
function kb(a,b){const c=a.stack,e=b.ua.ia.Sa,d=b.H;b.L.forEach(g=>{D(c,g.x,g.y,g.z);Da(g.Qa,a,d);c.pop()});J(e,a);b.L.forEach(g=>{const h=g.z-fb;g.ea.forEach(f=>{var k=g.x+f.Aa,l=g.y+f.Ba;let n=f.R,r=f.ca,x=f.da;var t=f.qa;d<t&&(t=1-(t-d)/.125,n=lb(t,f.na,k,n),r=lb(t,f.oa,l,r),x=lb(t,f.pa,h,x));k-=n;l-=r;t=h-x;const y=Math.sqrt(k*k+l*l+t*t);D(c,n,r,x);ia(c,bb(t,k));c.push(new Float32Array([y,0,0,0,0,l,0,0,0,0,1,0,0,0,0,1]));M(e,"wiggle",Math.abs((Math.floor(24*d)+f.Ea)%57+1-29));c.pop();c.pop();
c.pop()})})}function ib(a,b,c,e,d){const g=.2*e;d=.1*d;b+=g;c+=d;return{index:a,Aa:.05*e,Ba:0,Ga:g,Ha:d,qa:0,na:b,oa:c,pa:0,R:b,ca:c,da:0,Ea:0}}function lb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};const mb=[{D:422,F:285,I:415,J:353},{D:936,F:367,I:868,J:380},{D:1507,F:311,I:1469,J:318},{D:162,F:948,I:206,J:943},{D:1025,F:934,I:976,J:962}];
function nb(a){const b=1/18/18,c=g=>Math.max(0,Math.min(255,Math.round(256*(1-b*g*g)))),e=[];for(let g=0;2>g;g++)for(let h=0;18>h;h++)for(let f=0;2>f;f++){let k;var d=void 0;let l;d=h+6*f;18>d?(k=255,d=c(d),l=255):l=d=k=0;c(h+6*f);c(h+6*f+1);for(let n=0;2>n;n++)e.push(k,d,d,l)}a=za({name:"spark",width:72,height:2,a,ha:new Uint8Array(e)});return new N(a,{fading:T({x:1/180,width:.04,height:2/180,V:1/18,T:1,l:18,count:18})})}function ob(a,b){return a.m?b.m?0:1:b.m?-1:a.y-b.y}
function pb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var q=Math.sin(Math.PI*(u+0)/8)/2+Math.sin(Math.PI*(u+0)/3)/8,p=Math.sin(Math.PI*(u+170)/8)/2+Math.sin(Math.PI*(u+130)/3)/8;ja=Math.asin((q-p)/100);La=Math.cos(ja);Ma=Math.sin(ja);Na=(q+p)/2;q=0;B===ra&&u-O<5/U||(Ia(k,"attack")?(B=ra,O=u,U=12,P&&P.stop(),p=K.createBufferSource(),p.buffer=Oa[Math.floor(Math.random()*Oa.length)],p.connect(K.destination),p.start(0)):(q=1.2*Ka(k,"left","right"),Z=q*E,0!==Z?(Q+=Z,L=0>Z,B!==sa&&(B=sa,O=u,U=8)):B!==R?(B=R,O=u,
U=12,Ba(R,L?"left":"right",u)):null==P&&O<u-4&&(P=K.createBufferSource(),P.buffer=qb,P.connect(K.destination),P.start(0))));p=Math.floor(48*u)-Math.floor(48*(u-E));for(let m=0;m<p;m++){var C=2*Math.random()+1.4;let F=.1*Math.sin(2*Math.PI*Math.random()),H;var w=void 0,v=void 0;if(B===R)v=cb.get(R.name())[R.K],H=Q+v.x*(L?-1:1),w=v.z,v=v.angle;else if(H=Q+(rb-(Z?.05:0))*(L?-1:1),w=328/360,v=Math.PI/2,B===ra){w=Math.floor(U*(u-O));v=mb[w];H=Q+(v.D-(w%3*644+284))*(L?-1:1)/360;F=-Math.abs(F);w=(565-(v.F-
565*Math.floor(w/3)))/360;var aa=(v.I-v.D)*(L?-1:1);v=Math.atan((v.F-v.J)/aa);0<aa&&(v+=Math.PI)}aa=Math.PI/4*(Math.random()-.5)+v;v=C*Math.sin(aa);C=C*Math.cos(aa)+q;100<S.length&&S.pop();S.push({m:!1,x:H,y:0,z:w,o:C,G:F,A:v,startTime:u,ja:u+1.5,ta:!1})}const sb=9.8*La*E,tb=9.8*Ma*E,Pa=1-.8*E;S.forEach(m=>{var F=m.m;if(!F&&u<m.ja){m.x+=m.o*E;m.y+=m.G*E;m.z+=m.A*E;F=m.A;m.ta?(m.o*=Pa,m.G*=Pa):(F-=sb,m.o-=tb,m.A=F);const H=m.y;if(-.5>H||.5<H){const Qa=0<H?.5:-.5;m.y=Qa+(Qa-H);m.G=-m.G}0>m.z&&(-.01<
F?(m.z=180,m.A=0,m.ta=!0):(m.z=-m.z,m.A=-.25*F))}else F||(m.m=!0)});S.sort(ob);jb(V)}function b(q,p,C){p.stack.push(ea);D(p.stack,-Q,0,-y);ia(p.stack,ja);D(p.stack,0,0,Na);C(q,p);p.stack.pop();p.stack.pop();p.stack.pop()}function c(q,p){const C=p.stack;J(Ra,p);M(Ra,"main",0);J(Sa,p);M(Sa,"main",0);J(Ta,p);M(Ta,"main",0);D(C,Q,0,0);B===R?(B.Z=L?"left":"right",Da(B,p,u)):(J(B,p),M(B,L?"left":"right",Math.floor(U*(u-O))));C.pop();kb(p,V);J(Ua,p);S.forEach(w=>{w.m||(D(C,w.x,w.y,w.z),ia(C,(0<=w.o?Math.PI:
0)+Math.atan(w.A/w.o)),M(Ua,"fading",Math.floor(12*(u-w.startTime))),C.pop(),C.pop())})}function e(q,p){q.bindFramebuffer(q.FRAMEBUFFER,null);q.viewport(0,0,x,t);q.disable(q.BLEND);q.clearColor(0,0,0,1);q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);q.activeTexture(q.TEXTURE1);ta.b.bindTexture();q.uniform1i(p.u.lighting,1);q.activeTexture(q.TEXTURE0);b(q,p,c)}function d(){{const q=(Date.now()-ub)/1E3;E=q-V.H;u=V.H=q;ka=-1===ka?60:1/E/16+.9375*ka;g.innerHTML=`fps=${Math.round(ka)}`}Ja(k)%2&&(n=!n);
!ua&&Ia(k,"fullscreen")&&(ua=h.requestFullscreen());y+=E*Ka(k,"down","up");window.cameraZ=y;a();Ya(ta,{Pa:b,Ta:u,Oa:S,La:n});qa(Va,e);requestAnimationFrame(d)}const g=document.getElementById("fps"),h=document.getElementById("canvas");var f=window.getComputedStyle(h);const k=new Wa(document.body);X(k,"left",["a","ArrowLeft"]);X(k,"right",["d","ArrowRight"]);X(k,"showLights",["l"]);X(k,"attack",["f"," "]);X(k,"fullscreen",["u"]);X(k,"up",["w","ArrowUp"]);X(k,"down",["s","ArrowDown"]);var l=parseInt(f.getPropertyValue("width"),
10);f=parseInt(f.getPropertyValue("height"),10);let n=!1;var r=window.devicePixelRatio||1;const x=r*l,t=r*f;h.width=x;h.height=t;let y=1.25;var A=376/f;r=A/(484/f);var G=A/(268/f);A/=1.25;const ea=new Float32Array([f/l*A,0,0,0,0,0,1,G-r,0,A,0,0,0,0,0,(r+G)/2]),z=h.getContext("webgl2",{antialias:!1,alpha:!1});z.enable(z.DEPTH_TEST);z.depthFunc(z.LEQUAL);l=new na({a:z,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new na({a:z,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const Va=new pa({a:z,S:"projection"});oa(Va,l,f).link();const ta=new $a(z,x,t,360),K=new AudioContext;l=(q,p)=>I({a:z,name:q,src:p});const [ba,la,va,wa,Oa,qb,vb,W,wb]=await Promise.all([I({a:z,src:"assets/Back Wall.png",name:"wall"}),I({a:z,src:"assets/floor.png",name:"floor"}),I({a:z,src:"assets/Hero Walking with axe.png",name:"walk"}),I({a:z,src:"assets/Axe Chop.png",name:"attack"}),Promise.all([pb(K,"assets/Grunt1.mp3"),pb(K,"assets/Grunt2.mp3"),pb(K,"assets/Grunt3.mp3")]),pb(K,"assets/Theres something here.mp3"),
gb(l),l("ceiling","assets/ceiling.png"),db(l)]);let P=null;f=222/la.j;r=la.w/360;l=70/360;G=442/la.j;f/=2;r*=2;G/=2;const Ra=new N(ba,{main:[[ba.w/360,.5,ba.j/360,1,0,ba.w/360,.5,0,1,1,0,.5,ba.j/360,0,0,0,.5,0,0,1]]}),Sa=new N(la,{main:[[r,-.5,-l,1,1,0,-.5,-l,0,1,r,-.5,0,1,G,0,-.5,0,0,G,r,.5,0,1,f,0,.5,0,0,f]]});f=W.w/360;f*=2;const Ta=new N(W,{main:[[f,-.5,2.5+l,1,0,0,-.5,2.5+l,0,0,f,-.5,2.5,1,31/W.j,0,-.5,2.5,0,31/W.j,f,.5,2.5,1,133/W.j,0,.5,2.5,0,133/W.j]]}),rb=1.125*(387/405-220/405),R=wb.Ia,
sa=new N(va,{right:Ga({Y:258/424,X:424,O:444,W:va,U:360,l:2,count:8}),left:Ga({Y:1-258/424,X:424,O:444,W:va,U:360,l:2,count:8,s:!0})}),ra=new N(wa,{right:Ga({Y:284/644,X:644,O:565,W:wa,U:360,l:3,count:5}),left:Ga({Y:1-284/644,X:644,O:565,W:wa,U:360,l:3,count:5,s:!0})});new N(ta.b,{main:[Ha({width:2,height:1,xa:0,ya:0,va:1,wa:1})]});const V={ua:{ia:vb},L:[],H:0},Ua=nb(z),S=[];let ub=Date.now(),u=0,ka=-1,E=0,Q=4,Z=0,L=!1,O=0,B=sa,U=12,ua=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||
(ua=null)});V.L.push(new hb(V,Q+2,0,.4));let ja,Ma,La,Na;requestAnimationFrame(d);h.onmousemove=()=>{}};
