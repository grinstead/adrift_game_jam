'use strict';class aa{constructor(c,a,b){this.name=b;this.j=`${a}${b}`;switch(c){case "uniform":this.type=1;if("u_"!==a)throw Error(`uniform field "${this.j}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==a)throw Error(`in field "${this.j}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ma(c){const a=[];c.split("\n").forEach(b=>{(b=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(b))&&a.push(new aa(b[1],b[2],b[3]))});return a}
const x=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function y(c,a){c.a.uniformMatrix4fv(c.f,!1,a);c.b.push(a)}function z(c,a,b,e=0){var d=c.b;d=d.length?d[d.length-1]:x;y(c,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],a*d[0]+b*d[4]+e*d[8]+d[12],a*d[1]+b*d[5]+e*d[9]+d[13],a*d[2]+b*d[6]+e*d[10]+d[14],a*d[3]+b*d[7]+e*d[11]+d[15]]))}
function na(c,a){var b=Math.cos(a);a=Math.sin(a);b=new Float32Array([b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1]);a=c.b;0===a.length?y(c,b):(a=a[a.length-1],y(c,new Float32Array([b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12],b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],
b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],b[8]*a[3]+b[9]*a[7]+b[10]*a[11]+b[11]*a[15],b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15]])))}class oa{constructor(c,a){this.a=c;this.f=a;this.b=[];c.uniformMatrix4fv(a,!1,x)}pop(){return this.b.pop()}}
class G{constructor(c,a){this.name=c.name;var b=this.a=c.a;c=this.type=c.type;switch(c){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${c}"`);}e=this.b=b.createShader(e);b.shaderSource(e,a);b.compileShader(e);if(!b.getShaderParameter(e,b.COMPILE_STATUS))throw a=`Failed to compile ${this.name} ${c}-shader: ${b.getShaderInfoLog(e)}`,b.deleteShader(e),Error(a);this.J=ma(a)}}
function H(c,...a){const b=c.a,e=c.B;a.forEach(d=>{c.F.push(d);b.attachShader(e,d.b)});return c}class L{constructor(c){this.name=c.name;this.s=c.s;c=this.a=c.a;this.b=!1;this.B=c.createProgram();this.F=[];this.m={};this.h={};this.stack=null}link(){if(this.b)return this;var c=this.a,a=this.B;c.linkProgram(a);if(!c.getProgramParameter(a,c.LINK_STATUS)){var b=`Failed to link ${this.name} program: ${c.getProgramInfoLog(a)}`;c.deleteProgram(a);throw Error(b);}this.b=!0;return this}}
class M{constructor(c,a,b,e,d){this.a=c;this.name=a;this.w=b;this.c=e;a=this.b=c.createTexture();c.bindTexture(c.TEXTURE_2D,a);d(c);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,null)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}
function N(c){return(new Promise((a,b)=>{const e=new Image;e.onload=()=>void a(e);e.onerror=()=>{b(Error(`failed to load ${c.src}`))};e.mode="no-cors";e.src=c.src})).then(a=>{const b=a.naturalWidth,e=a.naturalHeight;return new M(c.a,c.name,b,e,d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,e,0,d.RGBA,d.UNSIGNED_BYTE,a)})})}function pa(c){const a=c.width,b=c.height;return new M(c.a,c.name,a,b,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a,b,0,e.RGBA,e.UNSIGNED_BYTE,c.L,0)})};function T(c,a){const b=c.b.a;let e=c.f;null!=e?b.bindBuffer(b.ARRAY_BUFFER,e):(c.f=e=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,e),b.bufferData(b.ARRAY_BUFFER,c.N,b.STATIC_DRAW));b.activeTexture(b.TEXTURE0);c.b.bindTexture();b.uniform1i(a.m.texture,0);b.enableVertexAttribArray(a.h.texturePosition);b.vertexAttribPointer(a.h.texturePosition,2,b.FLOAT,!1,20,12);b.enableVertexAttribArray(a.h.position);b.vertexAttribPointer(a.h.position,3,b.FLOAT,!1,20,0)}
function U(c,a,b){if(!c.data.hasOwnProperty(a))throw Error(`Can not render unknown "${a}"`);a=c.data[a];c=c.b.a;const e=a.K;c.drawArrays(c.TRIANGLE_STRIP,e[b%e.length],a.O)}
class V{constructor(c,a){this.b=c;this.f=null;c=this.data={};const b=[];let e=0;for(const d in a){const h=a[d],l=[],n=h.length;if(0===n)throw Error("Sprite declared with 0 points");const p=h[0].length;if(0==p)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const q=p/5;for(let u=0;u<n;u++){const t=h[u];if(t.length!==p)throw Error("Sprite declared with inconsistent lengths of elements");l.push(e);b.push.apply(b,t);e+=q}c[d]={U:this,name:d,K:l,O:q}}this.N=new Float32Array(b)}}
;function W(c,a,b){c=c.f;null!=b?c.set(a,b):c.delete(a)}function X(c,a){a=c.f.get(a);const b=c.b;return!!a&&a.some(e=>b.get(e))}function qa(c){const a=X(c,"left")?1:0;return(X(c,"right")?1:0)-a}class ra{constructor(c){this.b=new Map;this.f=new Map;c.addEventListener("keydown",a=>{Y(this,a,!0)});c.addEventListener("keyup",a=>{Y(this,a,!1)});c.onblur=()=>{this.b.clear()};c.onfocus=()=>{this.b.clear()}}}
function Y(c,a,b){a=a.key;c=c.b;const e=c.get(a);b?null==e&&c.set(a,Date.now()):null!=e&&c.delete(a)};class sa{constructor(c){const a=new G({a:c,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    gl_Position = position;\n    v_texturePosition = a_texturePosition;\n}"),b=new G({a:c,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n    output_color = color;\n}");
H(new L({a:c,s:"projection"}),a,b).link();c.bindTexture(c.TEXTURE_2D,c.createTexture());c.texImage2D(c.TEXTURE_2D,0,c.RGBA,512,256,0,c.RGBA,c.UNSIGNED_BYTE,null)}};function ta(){const c=new Uint8Array(4096),a=(d,h)=>{d/=360;h/=360;return d*d+h*h},b=Math.min(a(16,0),a(16,0));for(let d=0;32>d;d++)for(let h=0;32>h;h++){const l=4*(32*d+h),n=a(h-16,d-16);if(1E-4>=n)c[l]=255,c[l+1]=255,c[l+2]=255,c[l+3]=255;else{var e=Math.sqrt(1E-4/n);const p=Math.floor(256*e);e=Math.floor(256*e*e);c[l]=255;c[l+1]=e;c[l+2]=e;c[l+3]=n>=b?0:p}}return c}
function Z({A:c=0,V:a=0,W:b=0,v:e,o:d,u:h,g:l,count:n,l:p=!1}){const q=e/360,u=d/360;return ua({x:c*q,y:a,z:b*u,width:q,height:u,I:e/h.w,H:d/h.c,g:l,count:n,l:p})}function ua({x:c=0,y:a=0,z:b=0,width:e,height:d,I:h,H:l,g:n,count:p,l:q=!1}){const u=[];for(let t=0;t<p;t++){const w=Math.floor(t/n),A=t%n;u.push(va({x:c,y:a,z:b,width:e,height:d,S:A*h,P:(A+1)*h,T:w*l,R:(w+1)*l,l:q}))}return u}
function va({x:c=0,y:a=0,z:b=0,width:e,height:d,S:h,T:l,P:n,R:p,l:q=!1}){q?q=n:(q=h,h=n);return[e-c,a,-b,h,p,-c,a,-b,q,p,e-c,a,d-b,h,l,-c,a,d-b,q,l]}
window.onload=async function(){function c(f,k){f=Date.now();const r=(f-ba)/1E3;ba=f;b.innerHTML=`fps=${Math.round(1/r)}`;y(k.stack,wa);f=(f-xa)/1E3;const C=Math.sin(Math.PI*(B+0)/8)/2+Math.sin(Math.PI*(B+0)/3)/8,D=Math.sin(Math.PI*(B+170)/8)/2+Math.sin(Math.PI*(B+130)/3)/8,E=Math.asin((C-D)/100),I=Math.cos(E),O=Math.sin(E);F=1.2*r*qa(h);0!==F&&(Q+=F,P=0>F);const J=Math.floor(10*f)-Math.floor(10*B);for(let g=0;g<J;g++){var v=(Math.random()-.5)*Math.PI/4+Math.PI/2;const ca=2*Math.random()+1,za=Q+(ya-
(F?.05:0))*(P?-1:1),Aa=326/360,Ba=ca*Math.sin(v);v=ca*Math.cos(v);100<K.length&&K.shift();K.push({C:!1,x:za,y:0,z:Aa,D:v,M:.1*Math.sin(2*Math.PI*Math.random()),i:Ba})}K.forEach(g=>{g.C||(g.i-=9.8*I*r,g.D-=9.8*O*r,g.x+=g.D*r,g.y+=g.M*r,g.z+=g.i*r,0>g.z?(g.z=-g.z,g.i*=-.25):.01>g.z&&.1>Math.abs(g.i)&&(g.C=!0))});B=f;z(k.stack,-1.5,0,m.d/2+m.c+.5);na(k.stack,E);z(k.stack,0,0,(C+D)/2);T(da,k);U(da,"main",0);T(ea,k);U(ea,"main",0);z(k.stack,Q,0,0);0===F?(T(fa,k),U(fa,P?"left":"right",Math.floor(12*f))):
(T(ha,k),U(ha,P?"left":"right",Math.floor(8*f)));k.stack.pop();T(ia,k);K.forEach(g=>{g.C||(z(k.stack,g.x,g.y,g.z),U(ia,"main",0),k.stack.pop())});k.stack.pop();k.stack.pop();k.stack.pop();z(k.stack,ja/180,0,(n-ka)/180);f=Math.floor(8*f)%38;T(la,k);U(la,"blink",6>f?f:0)}function a(){var f=u,k=f.a,r=f.B;k.useProgram(r);for(var C={},D={},E=f.F,I=0;I<E.length;I++)for(var O=E[I].J,J=0;J<O.length;J++){var v=O[J];1===v.type?v.j in C||(C[v.name]=k.getUniformLocation(r,v.j)):v.j in D||(D[v.name]=k.getAttribLocation(r,
v.j))}f.m=C;f.h=D;if(r=f.s)if(r in f.m)f.stack=new oa(k,f.m[r]);else throw Error(`No anchor point "${r}" in program`);try{c(k,f)}finally{f.m={},f.h={},f.stack=null}requestAnimationFrame(a)}const b=document.getElementById("fps"),e=document.getElementById("canvas");var d=window.getComputedStyle(e);const h=new ra(document.body);W(h,"left",["a","ArrowLeft"]);W(h,"right",["d","ArrowRight"]);let l=parseInt(d.getPropertyValue("width"),10),n=parseInt(d.getPropertyValue("height"),10);e.width=l;e.height=n;
d=e.getContext("webgl2",{antialias:!1,alpha:!1});d.enable(d.BLEND);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.enable(d.DEPTH_TEST);d.depthFunc(d.LEQUAL);var p=new G({a:d,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n        float variance = 1.f / (position.z + 1.f);\n\n        vec4 result = vec4(position.x, position.y * variance, -.5f * (position.z - 1.f) * variance, position.w * variance);\n        gl_Position = result;\n\n        v_texturePosition = a_texturePosition;\n    }");
const q=new G({a:d,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }"),u=new L({a:d,s:"projection"});H(u,p,q).link();new sa(d);const [t,w,A,R,S]=await Promise.all([N({a:d,src:"assets/Back Wall.png",name:"wall"}),
N({a:d,src:"assets/new floor Floor.png",name:"floor"}),N({a:d,src:"assets/Hero Breathing with axe.png",name:"idle"}),N({a:d,src:"assets/Enemy.png",name:"enemy"}),N({a:d,src:"assets/Hero Walking with axe.png",name:"walk"})]),m={top:52/w.c,w:w.w/360,c:38/360,d:166/360,G:218/w.c},da=new V(t,{main:[[t.w/360,-m.d/2,t.c/360,1,0,t.w/360,-m.d/2,0,1,1,0,-m.d/2,t.c/360,0,0,0,-m.d/2,0,0,1]]}),ea=new V(w,{main:[[m.w,m.d/2,-m.c,1,1,0,m.d/2,-m.c,0,1,m.w,m.d/2,0,1,m.G,0,m.d/2,0,0,m.G,m.w,-m.d/2,0,1,m.top,0,-m.d/
2,0,0,m.top]]});p=220/405;const ya=1.125*(387/405-p),fa=new V(A,{right:Z({A:p,v:405,o:434,u:A,g:5,count:16}),left:Z({A:1-p,v:405,o:434,u:A,g:5,count:16,l:!0})}),ha=new V(S,{right:Z({A:258/424,v:424,o:442,u:S,g:2,count:8}),left:Z({A:1-258/424,v:424,o:442,u:S,g:2,count:8,l:!0})});d=pa({name:"fade",width:32,height:32,a:d,L:ta()});const la=new V(R,{blink:ua({x:.15,width:.3,height:.3,I:108/R.w,H:108/R.c,g:2,count:6})}),ia=new V(d,{main:[[16/360,0,-16/360,1,0,16/360,0,16/360,1,1,-16/360,0,-16/360,0,0,-16/
360,0,16/360,0,1]]});let ja=0,ka=0;const wa=new Float32Array([360/l,0,0,0,0,-360/n,.25,0,0,360/n,0,0,-1,-1,0,1]),K=[];let xa=Date.now(),ba=Date.now(),B=0,Q=4,F=0,P=!1;requestAnimationFrame(a);e.onmousemove=f=>{ja=f.offsetX;ka=f.offsetY}};
