'use strict';class aa{constructor(a,b,c){this.name=c;this.D=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.D}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.D}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ba(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new aa(c[1],c[2],c[3]))});return b}
const ca=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function ea(a,b){a.a.uniformMatrix4fv(a.i,!1,b);a.b.push(b)}function G(a,b,c,e=0){var d=a.b;d=d.length?d[d.length-1]:ca;ea(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function fa(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ha{constructor(a,b){this.a=a;this.i=b;this.b=[];a.uniformMatrix4fv(b,!1,ca)}pop(){return this.b.pop()}push(a){var b=this.b;0===b.length?ea(this,a):(b=b[b.length-1],ea(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class la{constructor(a,b){this.name=a.name;var c=this.a=a.a;a=this.type=a.type;switch(a){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.b=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.Da=ba(b)}}
function ma(a,...b){const c=a.a,e=a.ca;b.forEach(d=>{a.ka.push(d);c.attachShader(e,d.b)});return a}class na{constructor(a){this.name=a.name;this.U=a.U;a=this.a=a.a;this.b=!1;this.ca=a.createProgram();this.ka=[];this.v={};this.A={};this.stack=null}link(){if(this.b)return this;var a=this.a,b=this.ca;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.b=!0;return this}}
function oa(a,b){var c=a.a,e=a.ca;c.useProgram(e);for(var d={},g={},h=a.ka,f=0;f<h.length;f++)for(var k=h[f].Da,l=0;l<k.length;l++){var p=k[l];1===p.type?p.D in d||(d[p.name]=c.getUniformLocation(e,p.D)):p.D in g||(g[p.name]=c.getAttribLocation(e,p.D))}a.v=d;a.A=g;if(e=a.U)if(e in a.v)a.stack=new ha(c,a.v[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.v={},a.A={},a.stack=null}}
class pa{constructor(a,b,c,e,d){this.a=a;this.name=b;this.w=c;this.j=e;this.b=d(a)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}function wa(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new pa(a.a,a.name,c,e,xa(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function ya(a){const b=a.width,c=a.height;return new pa(a.a,a.name,b,c,xa(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.la,0)}))}function za(a){return new pa(a.a,a.name,a.width,a.height,()=>a.ja)}
function xa(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);return c}};function K(a,b){const c=a.b.a;let e=a.i;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.i=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.C,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.b.bindTexture();c.uniform1i(b.v.texture,0);c.enableVertexAttribArray(b.A.texturePosition);c.vertexAttribPointer(b.A.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.A.position);c.vertexAttribPointer(b.A.position,3,c.FLOAT,!1,20,0)}
function L(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.b.a;const e=b.da;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Ra)}
class P{constructor(a,b){this.b=a;this.i=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],h=[],f=g.length;if(0===f)throw Error("Sprite declared with 0 points");const k=g[0].length;if(0==k)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=k/5;for(let p=0;p<f;p++){const q=g[p];if(q.length!==k)throw Error("Sprite declared with inconsistent lengths of elements");h.push(e);c.push.apply(c,q);e+=l}a[d]={bb:this,name:d,da:h,Ra:l}}this.C=new Float32Array(c)}}
function Aa(a,b,c){if(!a.Na.includes(b))throw Error(`${a} does not have mode ${b}`);a.i=0;a.ba=b;a.J=0;a.b=c+a.C[0]}function Ba(a,b,c){const e=a.ba;if(null==e)throw Error(`${a} tried rendering while inactive`);let d=a.J;var g=a.b;if(-1!==g&&g<=c){g=a.C;const h=d+1;h===g.length?a.i===a.Oa?a.b=-1:(a.i++,d=0,a.J=d,a.b=c+g[d]):(d=h,a.J=d,a.b=c+g[d])}K(a.pa,b);L(a.pa,e,d)}
class Ca{constructor(a,b){const c=a.qa;this.P=a.name;this.Na=a.ea;this.ba=null;this.Oa="number"===typeof c?c:c?-1:0;this.pa=a.set;this.C=b;this.i=0;this.b=this.J=-1}name(){return this.P}toString(){return`Sprite/${this.P}`}}
function Da(a){const b=a.name,c=a.oa,e=a.set.data;let d=-1;a.ea.forEach(h=>{const f=e[h];if(!f)throw Error(`Sprite/${b} has non-existent mode ${h}`);if(-1===d)d=f.da.length;else if(d!==f.da.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);const g="number"===typeof c?Array(d).fill(c):c;return()=>new Ca(a,g)}
function Ea({aa:a=0,jb:b=0,kb:c=0,$:e,R:d,X:g,Z:h,l:f,count:k,s:l=!1}){const p=e/g;g=d/g;return Q({x:a*p,y:b,z:c*g,width:p,height:g,Y:e/h.w,W:d/h.j,l:f,count:k,s:l})}function Q({x:a=0,y:b=0,z:c=0,width:e,height:d,Y:g,W:h,l:f,count:k,gb:l=0,hb:p=0,ib:q=g,fb:x=h,s:t=!1}){const z=[];for(let A=0;A<k;A++){const I=l+A%f*q,da=p+Math.floor(A/f)*x;z.push(Fa({x:a,y:b,z:c,width:e,height:d,Ba:I,za:I+g,Ca:da,Aa:da+h,s:t}))}return z}
function Fa({x:a=0,y:b=0,z:c=0,width:e,height:d,Ba:g,Ca:h,za:f,Aa:k,s:l=!1}){l?(l=f,f=a-e):(l=g,g=f,f=-a,a=e-a);return[a,b,-c,g,k,f,b,-c,l,k,a,b,d-c,g,h,f,b,d-c,l,h]};function V(a,b,c){a=a.i;null!=c?a.set(b,c):a.delete(b)}function Ga(a,b){b=a.i.get(b);const c=a.b;return!!b&&!!b.some(e=>(e=c.get(e))?(e.O=0,null!=e.S):!1)}function Ha(a){const b=a.i.get("showLights");if(b){const c=a.b;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.O,d.O=0,e):e,0)}return 0}function Ia(a,b,c){b=Ga(a,b)?1:0;return(Ga(a,c)?1:0)-b}
class Va{constructor(a){this.b=new Map;this.i=new Map;a.addEventListener("keydown",b=>{Wa(this,b,!0)});a.addEventListener("keyup",b=>{Wa(this,b,!1)});a.onblur=()=>{this.b.clear()};a.onfocus=()=>{this.b.clear()}}}function Wa(a,b,c){b=b.key;a=a.b;const e=a.get(b);c?null==e?a.set(b,{S:Date.now(),O:1}):(null==e.S&&(e.S=Date.now()),e.O++):null!=e&&(e.S=null)};function Xa(a,b){const c=a.i.a,e=a.b;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.P);c.viewport(0,0,e.w,e.j);oa(a.i,(d,g)=>{Ya(d,g,a,b)})}
class Za{constructor(a,b,c,e){b/=4;c/=4;var d=new la({a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),g=
new la({a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const h=new na({a,U:"projection"});ma(h,d,g).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=ya({name:"fade",width:64,height:64,a,la:$a(e)});this.i=h;this.b=za({ja:d,name:"lighting",
width:b,height:c,a});this.P=g;this.C=new P(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Ya(a,b,c,e){e.Pa?a.clearColor(0,0,0,1):a.clearColor(0,0,0,.2);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.Ta(a,b,()=>{const d=c.C;K(d,b);const g=b.v.threshold,h=e.Xa;e.Sa.forEach(f=>{if(!f.m){var k=f.startTime;k=(h-k)/(f.na-k);a.uniform1f(g,.5*k*k);G(b.stack,f.x,f.y,f.z);L(d,"main",0);b.stack.pop()}})})}
function $a(a){const b=new Uint8Array(16384),c=(g,h)=>{g/=a;h/=a;return g*g+h*h},e=Math.min(c(32,0),c(32,0));for(let g=0;64>g;g++)for(let h=0;64>h;h++){const f=4*(64*g+h);var d=c(h-32,g-32);const k=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const l=Math.max(Math.round(255*k*k),0);b[f]=d+Math.max(Math.round(20*k),0);b[f+1]=d;b[f+2]=d;b[f+3]=l}return b};function ab(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Y=434/1.8,bb=new Map;
async function cb(a){[a]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Da({name:"hero_idle",set:db({name:"hero_idle",ja:a,Za:405,Ja:434,$a:220,ab:434,Ha:16,Ga:[{g:388,h:104,c:385,f:170},{g:792,h:105,c:790,f:170},{g:1198,h:105,c:1195,f:169},{g:1602,h:106,c:1600,f:170},{g:2008,h:106,c:2005,f:172},{g:388,h:539,c:385,f:604},{g:794,h:540,c:790,f:605},{g:1196,h:539,c:1196,f:604},{g:1602,
h:539,c:1602,f:604},{g:2009,h:541,c:2007,f:604},{g:386,h:974,c:385,f:1036},{g:792,h:972,c:790,f:1033},{g:1198,h:974,c:1196,f:1038},{g:1602,h:972,c:1601,f:1036},{g:2010,h:974,c:2005,f:1044},{g:386,h:1406,c:385,f:1477}]}),ea:["left","right"],qa:!0,oa:1/12})();console.log(bb);return{Ma:a}}
function db(a){const b=a.ja,c=a.Za,e=a.Ja,d=a.$a,g=a.ab,h=a.Ha,f=Math.floor(b.w/c),k={x:d/Y,z:(e-g)/Y,width:c/Y,height:e/Y,Y:c/b.w,W:e/b.j,l:f,count:h},l=a.Ga.map(({g:p,h:q,c:x,f:t},z)=>({x:(p-(z%f*c+d))/Y,z:(Math.floor(z/f)*e+g-q)/Y,angle:ab(-(q-t),p-x)}));if(l.length!==h)throw Error(`flareData length ${l.length} but expects ${h}`);bb.set(a.name,l);return new P(b,{right:Q(k),left:Q({...k,s:!0})})};async function eb(a){[a]=await Promise.all([a("wall","assets/Back Wall.png"),a("floor","assets/floor.png")]);const b=a.w/360;return{Ya:new P(a,{main:[[b,.5,2.5,1,.5,b,.5,0,1,1,0,.5,2.5,0,.5,0,.5,0,0,1]]})}};function fb(a){return{V:a.V,N:[],u:a.u,F:a.F,G:a.G,ya:a.ya,ha:a.ha}};async function gb(a){const [b,c]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png")]);a=new P(b,{blink:Q({x:.25,z:.25,width:.5,height:.5,Y:108/b.w,W:108/b.j,l:2,count:6})});var e=Array(6).fill(.125);e[0]=4;a=Da({name:"creature_normal",set:a,ea:["blink"],qa:!0,oa:e});e=[];var d=92,g=-22;const h=Math.sqrt(d*d+g*g);d/=h;g/=h;for(let f=0;29>f;f++){const k=f%5,l=Math.floor(f/5),p=[],q=(x,t)=>{const z=100*x,A=77*t-48;p.push((z*d+A*g)/h,x,(z*-g+A*d)/360,100*(k+x)/c.w,
77*(l+t)/c.j)};q(1,1);q(0,1);q(1,0);q(0,0);e.push(p)}e=new P(c,{wiggle:e});return{Qa:a,Wa:e}}class hb{constructor(a,b,c,e){const d=a.V.ma.Qa();Aa(d,"blink",a.u);this.x=this.Va=b;this.y=c;this.z=e;this.va=this.wa=0;this.ia=[ib(0,b,c,-1,1),ib(1,b,c,-1,-1),ib(2,b,c,1,1),ib(3,b,c,1,-1)];this.Ua=d}}
function jb(a){const b=a.u;a.N.forEach(c=>{c.x=c.Va+Math.sin(b);var e=.5*Math.cos(b);if(b>c.wa){var d=c.va;c.va=(d+1)%c.ia.length;d=c.ia[d];e=c.x+.225*e+d.Ka;.05<Math.abs(e-d.T)&&(c.wa=b+.125,d.ua=b+.125,d.ra=d.T,d.sa=d.fa,d.ta=d.ga,d.T=e,d.fa=c.y+d.La,d.ga=0)}})}
function kb(a,b){const c=a.stack,e=b.V.ma.Wa,d=b.u;b.N.forEach(g=>{G(c,g.x,g.y,g.z);Ba(g.Ua,a,d);c.pop()});K(e,a);b.N.forEach(g=>{const h=g.z-.1875;g.ia.forEach(f=>{var k=g.x+f.Ea,l=g.y+f.Fa;let p=f.T,q=f.fa,x=f.ga;var t=f.ua;d<t&&(t=1-(t-d)/.125,p=lb(t,f.ra,k,p),q=lb(t,f.sa,l,q),x=lb(t,f.ta,h,x));k-=p;l-=q;t=h-x;const z=Math.sqrt(k*k+l*l+t*t);G(c,p,q,x);fa(c,ab(t,k));c.push(new Float32Array([z,0,0,0,0,l,0,0,0,0,1,0,0,0,0,1]));L(e,"wiggle",Math.abs((Math.floor(24*d)+f.Ia)%57+1-29));c.pop();c.pop();
c.pop()})})}function ib(a,b,c,e,d){const g=.4*e;d=.1*d;b+=g;c+=d;return{index:a,Ea:.05*e,Fa:0,Ka:g,La:d,ua:0,ra:b,sa:c,ta:0,T:b,fa:c,ga:0,Ia:0}}function lb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};const mb=[{H:422,I:285,L:415,M:353},{H:936,I:367,L:868,M:380},{H:1507,I:311,L:1469,M:318},{H:162,I:948,L:206,M:943},{H:1025,I:934,L:976,M:962}];
function nb(a){const b=1/18/18,c=g=>Math.max(0,Math.min(255,Math.round(256*(1-b*g*g)))),e=[];for(let g=0;2>g;g++)for(let h=0;18>h;h++)for(let f=0;2>f;f++){let k;var d=void 0;let l;d=h+6*f;18>d?(k=255,d=c(d),l=255):l=d=k=0;c(h+6*f);c(h+6*f+1);for(let p=0;2>p;p++)e.push(k,d,d,l)}a=ya({name:"spark",width:72,height:2,a,la:new Uint8Array(e)});return new P(a,{fading:Q({x:1/180,width:.04,height:2/180,Y:1/18,W:1,l:18,count:18})})}function ob(a,b){return a.m?b.m?0:1:b.m?-1:a.y-b.y}
function pb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var n=Math.sin(Math.PI*(u+0)/8)/2+Math.sin(Math.PI*(u+0)/3)/8,r=Math.sin(Math.PI*(u+170)/8)/2+Math.sin(Math.PI*(u+130)/3)/8;ia=Math.asin((n-r)/100);Ja=Math.cos(ia);Ka=Math.sin(ia);La=(n+r)/2;B===qa&&u-R<5/W||(Ga(k,"attack")?(B=qa,R=u,W=12,S&&S.stop(),n=M.createBufferSource(),n.buffer=Ma[Math.floor(Math.random()*Ma.length)],n.connect(M.destination),n.start(0)):(J=1.2*E*Ia(k,"left","right"),n=H+J,n<y.F+1.125?J=y.F+1.125-H:n>y.G-1.125&&(J=y.G-1.125-H),0!==
J?(H+=J,N=0>J,B!==ra&&(B=ra,R=u,W=8)):B!==T?(B=T,R=u,W=12,Aa(T,N?"left":"right",u)):null==S&&R<u-4&&(S=M.createBufferSource(),S.buffer=qb,S.connect(M.destination),S.start(0))));n=Math.floor(48*u)-Math.floor(48*(u-E));for(r=0;r<n;r++){var C=2*Math.random()+1.4;let m=.1*Math.sin(2*Math.PI*Math.random()),F;var w=void 0,v=void 0;if(B===T)v=bb.get(T.name())[T.J],F=H+v.x*(N?-1:1),w=v.z,v=v.angle;else if(F=H+(rb-(J?.05:0))*(N?-1:1),w=328/360,v=Math.PI/2,B===qa){w=Math.floor(W*(u-R));v=mb[w];F=H+(v.H-(w%
3*644+284))*(N?-1:1)/360;m=-Math.abs(m);w=(565-(v.I-565*Math.floor(w/3)))/360;var Z=(v.L-v.H)*(N?-1:1);v=Math.atan((v.I-v.M)/Z);0<Z&&(v+=Math.PI)}Z=Math.PI/4*(Math.random()-.5)+v;v=C*Math.sin(Z);C=C*Math.cos(Z)+J/E;100<U.length&&U.pop();U.push({m:!1,x:F,y:0,z:w,o:C,K:m,B:v,startTime:u,na:u+1.5,xa:!1})}const sb=9.8*Ja*E,tb=9.8*Ka*E,Na=1-.8*E;U.forEach(m=>{var F=m.m;if(!F&&u<m.na){m.x+=m.o*E;m.y+=m.K*E;m.z+=m.B*E;F=m.B;m.xa?(m.o*=Na,m.K*=Na):(F-=sb,m.o-=tb,m.B=F);if(m.x<y.F||m.x>y.G)m.m=!0;var O=m.y;
if(-.5>O||.5<O){const Oa=0<O?.5:-.5;m.y=Oa+(Oa-O);m.K=-m.K}O=y.ha;m.z<O&&(-.01<F?(m.z=180,m.B=O,m.xa=!0):(m.z=O-m.z,m.B=-.25*F))}else F||(m.m=!0)});U.sort(ob);jb(y)}function b(n,r,C){r.stack.push(da);G(r.stack,-Math.min(Math.max(H,y.F+2),y.G-2),0,-z);fa(r.stack,ia);G(r.stack,0,0,La);C(n,r);r.stack.pop();r.stack.pop();r.stack.pop()}function c(n,r){const C=r.stack;n=Pa.Ya;K(n,r);L(n,"main",0);K(Qa,r);L(Qa,"main",0);K(Ra,r);L(Ra,"main",0);G(C,H,0,0);B===T?(B.ba=N?"left":"right",Ba(B,r,u)):(K(B,r),L(B,
N?"left":"right",Math.floor(W*(u-R))));C.pop();kb(r,y);K(Sa,r);U.forEach(w=>{w.m||(G(C,w.x,w.y,w.z),fa(C,(0<=w.o?Math.PI:0)+Math.atan(w.B/w.o)),L(Sa,"fading",Math.floor(12*(u-w.startTime))),C.pop(),C.pop())})}function e(n,r){n.bindFramebuffer(n.FRAMEBUFFER,null);n.viewport(0,0,x,t);n.disable(n.BLEND);n.clearColor(0,0,0,1);n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);n.activeTexture(n.TEXTURE1);sa.b.bindTexture();n.uniform1i(r.v.lighting,1);n.activeTexture(n.TEXTURE0);b(n,r,c)}function d(){{const n=
(Date.now()-ub)/1E3;E=n-y.u;u=y.u=n;ja=-1===ja?60:1/E/16+.9375*ja;g.innerHTML=`fps=${Math.round(ja)}`}Ha(k)%2&&(p=!p);!ta&&Ga(k,"fullscreen")&&(ta=h.requestFullscreen());z+=E*Ia(k,"down","up");window.cameraZ=z;a();Xa(sa,{Ta:b,Xa:u,Sa:U,Pa:p});oa(Ta,e);requestAnimationFrame(d)}const g=document.getElementById("fps"),h=document.getElementById("canvas");var f=window.getComputedStyle(h);const k=new Va(document.body);V(k,"left",["a","ArrowLeft"]);V(k,"right",["d","ArrowRight"]);V(k,"showLights",["l"]);
V(k,"attack",["f"," "]);V(k,"fullscreen",["u"]);V(k,"up",["w","ArrowUp"]);V(k,"down",["s","ArrowDown"]);var l=parseInt(f.getPropertyValue("width"),10);f=parseInt(f.getPropertyValue("height"),10);let p=!1;var q=window.devicePixelRatio||1;const x=q*l,t=q*f;h.width=x;h.height=t;let z=1.25;var A=376/f;q=A/(484/f);var I=A/(268/f);A/=1.25;const da=new Float32Array([f/l*A,0,0,0,0,0,1,I-q,0,A,0,0,0,0,0,(q+I)/2]),D=h.getContext("webgl2",{antialias:!1,alpha:!1});D.enable(D.DEPTH_TEST);D.depthFunc(D.LEQUAL);
l=new la({a:D,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new la({a:D,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const Ta=new na({a:D,U:"projection"});ma(Ta,l,f).link();const sa=new Za(D,x,t,360),M=new AudioContext;l=(n,r)=>wa({a:D,name:n,src:r});const [Pa,ka,ua,va,Ma,qb,vb,X,Ua]=await Promise.all([eb(l),wa({a:D,src:"assets/floor.png",name:"floor"}),wa({a:D,src:"assets/Hero Walking with axe.png",name:"walk"}),wa({a:D,src:"assets/Axe Chop.png",name:"attack"}),Promise.all([pb(M,"assets/Grunt1.mp3"),pb(M,"assets/Grunt2.mp3"),pb(M,"assets/Grunt3.mp3")]),pb(M,"assets/Theres something here.mp3"),gb(l),l("ceiling",
"assets/ceiling.png"),cb(l)]);let S=null;f=220/ka.j;q=ka.w/360;l=70/360;I=442/ka.j;f/=2;q*=2;I/=2;const Qa=new P(ka,{main:[[q,-.5,-l,1,1,0,-.5,-l,0,1,q,-.5,0,1,I,0,-.5,0,0,I,q,.5,0,1,f,0,.5,0,0,f]]});f=X.w/360;f*=2;const Ra=new P(X,{main:[[f,-.5,2.5+l,1,0,0,-.5,2.5+l,0,0,f,-.5,2.5,1,31/X.j,0,-.5,2.5,0,31/X.j,f,.5,2.5,1,144/X.j,0,.5,2.5,0,144/X.j]]}),rb=1.125*(387/405-220/405),T=Ua.Ma,ra=new P(ua,{right:Ea({aa:258/424,$:424,R:444,Z:ua,X:360,l:2,count:8}),left:Ea({aa:1-258/424,$:424,R:444,Z:ua,X:360,
l:2,count:8,s:!0})}),qa=new P(va,{right:Ea({aa:284/644,$:644,R:565,Z:va,X:360,l:3,count:5}),left:Ea({aa:1-284/644,$:644,R:565,Z:va,X:360,l:3,count:5,s:!0})});new P(sa.b,{main:[Fa({width:2,height:1,Ba:0,Ca:0,za:1,Aa:1})]});const y=fb({V:{ma:vb,eb:Ua,cb:Pa},u:0,F:0,G:8,ya:2.5,ha:0}),Sa=nb(D),U=[];let ub=Date.now(),u=0,ja=-1,E=0,H=4,J=0,N=!1,R=0,B=ra,W=12,ta=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(ta=null)});y.N.push(new hb(y,H+2,0,.75));let ia,Ka,Ja,La;requestAnimationFrame(d);
h.onmousemove=()=>{}};
