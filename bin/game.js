'use strict';class aa{constructor(a,b,c){this.name=c;this.F=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.F}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.F}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ba(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new aa(c[1],c[2],c[3]))});return b}
const ca=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function da(a,b){a.b.uniformMatrix4fv(a.i,!1,b);a.a.push(b)}function H(a,b,c,e=0){var d=a.a;d=d.length?d[d.length-1]:ca;da(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function fa(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class ha{constructor(a,b){this.b=a;this.i=b;this.a=[];a.uniformMatrix4fv(b,!1,ca)}pop(){return this.a.pop()}push(a){var b=this.a;0===b.length?da(this,a):(b=b[b.length-1],da(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class ia{constructor(a,b){this.name=a.name;var c=this.b=a.b;a=this.type=a.type;switch(a){case "vertex":var e=this.b.VERTEX_SHADER;break;case "fragment":e=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.a=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.Fa=ba(b)}}
function ma(a,...b){const c=a.b,e=a.ea;b.forEach(d=>{a.ma.push(d);c.attachShader(e,d.a)});return a}class na{constructor(a){this.name=a.name;this.W=a.W;a=this.b=a.b;this.a=!1;this.ea=a.createProgram();this.ma=[];this.A={};this.B={};this.stack=null}link(){if(this.a)return this;var a=this.b,b=this.ea;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.a=!0;return this}}
function oa(a,b){var c=a.b,e=a.ea;c.useProgram(e);for(var d={},g={},k=a.ma,f=0;f<k.length;f++)for(var h=k[f].Fa,l=0;l<h.length;l++){var n=h[l];1===n.type?n.F in d||(d[n.name]=c.getUniformLocation(e,n.F)):n.F in g||(g[n.name]=c.getAttribLocation(e,n.F))}a.A=d;a.B=g;if(e=a.W)if(e in a.A)a.stack=new ha(c,a.A[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.A={},a.B={},a.stack=null}}
class pa{constructor(a,b,c,e,d){this.b=a;this.name=b;this.w=c;this.l=e;this.a=d(a)}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}}function qa(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new pa(a.b,a.name,c,e,ra(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function ya(a){const b=a.width,c=a.height;return new pa(a.b,a.name,b,c,ra(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.na,0)}))}function za(a){return new pa(a.b,a.name,a.width,a.height,()=>a.la)}
function ra(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);return c}};function J(a,b){const c=a.a.b;let e=a.i;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.i=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.D,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(b.A.texture,0);c.enableVertexAttribArray(b.B.texturePosition);c.vertexAttribPointer(b.B.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.B.position);c.vertexAttribPointer(b.B.position,3,c.FLOAT,!1,20,0)}
function L(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.a.b;const e=b.fa;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Ta)}
class M{constructor(a,b){this.a=a;this.i=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],k=[],f=g.length;if(0===f)throw Error("Sprite declared with 0 points");const h=g[0].length;if(0==h)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const l=h/5;for(let n=0;n<f;n++){const q=g[n];if(q.length!==h)throw Error("Sprite declared with inconsistent lengths of elements");k.push(e);c.push.apply(c,q);e+=l}a[d]={eb:this,name:d,fa:k,Ta:l}}this.D=new Float32Array(c)}}
function Aa(a,b,c){if(!a.Pa.includes(b))throw Error(`${a} does not have mode ${b}`);a.i=0;a.da=b;a.K=0;a.a=c+a.D[0]}function Ba(a,b,c){const e=a.da;if(null==e)throw Error(`${a} tried rendering while inactive`);let d=a.K;var g=a.a;if(-1!==g&&g<=c){g=a.D;const k=d+1;k===g.length?a.i===a.Qa?a.a=-1:(a.i++,d=0,a.K=d,a.a=c+g[d]):(d=k,a.K=d,a.a=c+g[d])}J(a.ra,b);L(a.ra,e,d)}
class Ca{constructor(a,b){const c=a.sa;this.R=a.name;this.Pa=a.ga;this.da=null;this.Qa="number"===typeof c?c:c?-1:0;this.ra=a.set;this.D=b;this.i=0;this.a=this.K=-1}name(){return this.R}toString(){return`Sprite/${this.R}`}}
function Da(a){const b=a.name,c=a.qa,e=a.set.data;let d=-1;a.ga.forEach(k=>{const f=e[k];if(!f)throw Error(`Sprite/${b} has non-existent mode ${k}`);if(-1===d)d=f.fa.length;else if(d!==f.fa.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);const g="number"===typeof c?Array(d).fill(c):c;return()=>new Ca(a,g)}
function Ea({ca:a=0,kb:b=0,lb:c=0,ba:e,S:d,Z:g,aa:k,m:f,count:h,s:l=!1}){const n=e/g;g=d/g;return Q({x:a*n,y:b,z:c*g,width:n,height:g,$:e/k.w,Y:d/k.l,m:f,count:h,s:l})}function Q({x:a=0,y:b=0,z:c=0,width:e,height:d,$:g,Y:k,m:f,count:h,hb:l=0,ib:n=0,jb:q=g,gb:y=k,s:z=!1}){const w=[];for(let t=0;t<h;t++){const I=l+t%f*q,ea=n+Math.floor(t/f)*y;w.push(Fa({x:a,y:b,z:c,width:e,height:d,Da:I,Ba:I+g,Ea:ea,Ca:ea+k,s:z}))}return w}
function Fa({x:a=0,y:b=0,z:c=0,width:e,height:d,Da:g,Ea:k,Ba:f,Ca:h,s:l=!1}){l?(l=f,f=a-e):(l=g,g=f,f=-a,a=e-a);return[a,b,-c,g,h,f,b,-c,l,h,a,b,d-c,g,k,f,b,d-c,l,k]};function V(a,b,c){a=a.i;null!=c?a.set(b,c):a.delete(b)}function Ga(a,b){b=a.i.get(b);const c=a.a;return!!b&&!!b.some(e=>(e=c.get(e))?(e.P=0,null!=e.T):!1)}function Ha(a){const b=a.i.get("showLights");if(b){const c=a.a;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.P,d.P=0,e):e,0)}return 0}function Ia(a,b,c){b=Ga(a,b)?1:0;return(Ga(a,c)?1:0)-b}
class Va{constructor(a){this.a=new Map;this.i=new Map;a.addEventListener("keydown",b=>{Wa(this,b,!0)});a.addEventListener("keyup",b=>{Wa(this,b,!1)});a.onblur=()=>{this.a.clear()};a.onfocus=()=>{this.a.clear()}}}function Wa(a,b,c){b=b.key;a=a.a;const e=a.get(b);c?null==e?a.set(b,{T:Date.now(),P:1}):(null==e.T&&(e.T=Date.now()),e.P++):null!=e&&(e.T=null)};function Xa(a,b){const c=a.i.b,e=a.a;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.R);c.viewport(0,0,e.w,e.l);oa(a.i,(d,g)=>{Ya(d,g,a,b)})}
class Za{constructor(a,b,c,e){b/=4;c/=4;var d=new ia({b:a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),g=
new ia({b:a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const k=new na({b:a,W:"projection"});ma(k,d,g).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=ya({name:"fade",width:64,height:64,b:a,na:$a(e)});this.i=k;this.a=za({la:d,name:"lighting",
width:b,height:c,b:a});this.R=g;this.D=new M(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Ya(a,b,c,e){e.Ra?a.clearColor(0,0,0,1):a.clearColor(0,0,0,window.a);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.Va(a,b,()=>{const d=c.D;J(d,b);const g=b.A.threshold,k=e.Za;e.Ua.forEach(f=>{if(!f.o){var h=f.startTime;h=(k-h)/(f.pa-h);a.uniform1f(g,.5*h*h);H(b.stack,f.x,f.y,f.z);L(d,"main",0);b.stack.pop()}})})}
function $a(a){const b=new Uint8Array(16384),c=(g,k)=>{g/=a;k/=a;return g*g+k*k},e=Math.min(c(32,0),c(32,0));for(let g=0;64>g;g++)for(let k=0;64>k;k++){const f=4*(64*g+k);var d=c(k-32,g-32);const h=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const l=Math.max(Math.round(255*h*h),0);b[f]=d+Math.max(Math.round(20*h),0);b[f+1]=d;b[f+2]=d;b[f+3]=l}return b};function ab(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Y=434/1.8,bb=new Map;class cb{constructor(a){this.j=a}}
async function db(a){[a]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Da({name:"hero_idle",set:eb({name:"hero_idle",la:a,ab:405,La:434,bb:220,cb:434,Ja:16,Ia:[{g:388,h:104,c:385,f:170},{g:792,h:105,c:790,f:170},{g:1198,h:105,c:1195,f:169},{g:1602,h:106,c:1600,f:170},{g:2008,h:106,c:2005,f:172},{g:388,h:539,c:385,f:604},{g:794,h:540,c:790,f:605},{g:1196,h:539,c:1196,f:604},{g:1602,
h:539,c:1602,f:604},{g:2009,h:541,c:2007,f:604},{g:386,h:974,c:385,f:1036},{g:792,h:972,c:790,f:1033},{g:1198,h:974,c:1196,f:1038},{g:1602,h:972,c:1601,f:1036},{g:2010,h:974,c:2005,f:1044},{g:386,h:1406,c:385,f:1477}]}),ga:["left","right"],sa:!0,qa:1/12})();console.log(bb);return{Oa:a}}
function eb(a){const b=a.la,c=a.ab,e=a.La,d=a.bb,g=a.cb,k=a.Ja,f=Math.floor(b.w/c),h={x:d/Y,z:(e-g)/Y,width:c/Y,height:e/Y,$:c/b.w,Y:e/b.l,m:f,count:k},l=a.Ia.map(({g:n,h:q,c:y,f:z},w)=>({x:(n-(w%f*c+d))/Y,z:(Math.floor(w/f)*e+g-q)/Y,angle:ab(-(q-z),n-y)}));if(l.length!==k)throw Error(`flareData length ${l.length} but expects ${k}`);bb.set(a.name,l);return new M(b,{right:Q(h),left:Q({...h,s:!0})})};async function fb(a){[a]=await Promise.all([a("wall","assets/Back Wall.png"),a("floor","assets/floor.png")]);const b=a.w/360;return{$a:new M(a,{main:[[b,.5,2.5,1,.5,b,.5,0,1,1,0,.5,2.5,0,.5,0,.5,0,0,1]]})}};function gb(a){return{X:a.X,O:[],v:a.v,G:a.G,H:a.H,Aa:a.Aa,ja:a.ja,U:a.U}};const hb=new Float32Array([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
async function ib(a){const [b,c]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png")]);a=new M(b,{blink:Q({x:.25,z:.25,width:.5,height:.5,$:108/b.w,Y:108/b.l,m:2,count:6,s:!0})});var e=Array(6).fill(.125);e[0]=4;a=Da({name:"creature_normal",set:a,ga:["blink"],sa:!0,qa:e});e=[];var d=92,g=-22;const k=Math.sqrt(d*d+g*g);d/=k;g/=k;for(let f=0;29>f;f++){const h=f%5,l=Math.floor(f/5),n=[],q=(y,z)=>{const w=100*y,t=77*z-48;n.push((w*d+t*g)/k,y,(w*-g+t*d)/360,100*(h+y)/
c.w,77*(l+z)/c.l)};q(1,1);q(0,1);q(1,0);q(0,0);e.push(n)}e=new M(c,{wiggle:e});return{Sa:a,Ya:e}}class jb{constructor(a,b,c,e){const d=a.X.oa.Sa();Aa(d,"blink",a.v);this.x=this.Xa=b;this.y=c;this.z=e;this.xa=this.ya=0;this.ka=[kb(0,b,c,-1,1),kb(1,b,c,-1,-1),kb(2,b,c,1,1),kb(3,b,c,1,-1)];this.Wa=d}}
function lb(a){const b=a.v;a.O.forEach(c=>{c.x=c.Xa+Math.sin(b);var e=.5*Math.cos(b);if(b>c.ya){var d=c.xa;c.xa=(d+1)%c.ka.length;d=c.ka[d];e=c.x+.225*e+d.Ma;.05<Math.abs(e-d.V)&&(c.ya=b+.125,d.wa=b+.125,d.ta=d.V,d.ua=d.ha,d.va=d.ia,d.V=e,d.ha=c.y+d.Na,d.ia=0)}})}
function mb(a,b){const c=a.stack,e=b.X.oa.Ya,d=b.v,{x:g,z:k}={x:b.U.j,z:1.7};b.O.forEach(f=>{var h=f.x;const l=f.z;H(c,h,f.y,l);let n=g<h;h=ab(k-l,g-h);n&&(c.push(hb),h=Math.PI-h);fa(c,h);Ba(f.Wa,a,d);c.pop();n&&c.pop();c.pop()});J(e,a);b.O.forEach(f=>{const h=f.z-.1875;f.ka.forEach(l=>{var n=f.x+l.Ga,q=f.y+l.Ha;let y=l.V,z=l.ha,w=l.ia;var t=l.wa;d<t&&(t=1-(t-d)/.125,y=nb(t,l.ta,n,y),z=nb(t,l.ua,q,z),w=nb(t,l.va,h,w));n-=y;q-=z;t=h-w;const I=Math.sqrt(n*n+q*q+t*t);H(c,y,z,w);fa(c,ab(t,n));c.push(new Float32Array([I,
0,0,0,0,q,0,0,0,0,1,0,0,0,0,1]));L(e,"wiggle",Math.abs((Math.floor(24*d)+l.Ka)%57+1-29));c.pop();c.pop();c.pop()})})}function kb(a,b,c,e,d){const g=.4*e;d=.1*d;b+=g;c+=d;return{index:a,Ga:.05*e,Ha:0,Ma:g,Na:d,wa:0,ta:b,ua:c,va:0,V:b,ha:c,ia:0,Ka:0}}function nb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};const ob=[{I:422,J:285,M:415,N:353},{I:936,J:367,M:868,N:380},{I:1507,J:311,M:1469,N:318},{I:162,J:948,M:206,N:943},{I:1025,J:934,M:976,N:962}];window.a=.1;
function pb(a){const b=1/18/18,c=g=>Math.max(0,Math.min(255,Math.round(256*(1-b*g*g)))),e=[];for(let g=0;2>g;g++)for(let k=0;18>k;k++)for(let f=0;2>f;f++){let h;var d=void 0;let l;d=k+6*f;18>d?(h=255,d=c(d),l=255):l=d=h=0;c(k+6*f);c(k+6*f+1);for(let n=0;2>n;n++)e.push(h,d,d,l)}a=ya({name:"spark",width:72,height:2,b:a,na:new Uint8Array(e)});return new M(a,{fading:Q({x:1/180,width:.04,height:2/180,$:1/18,Y:1,m:18,count:18})})}function qb(a,b){return a.o?b.o?0:1:b.o?-1:a.y-b.y}
function rb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var p=Math.sin(Math.PI*(u+0)/8)/2+Math.sin(Math.PI*(u+0)/3)/8,r=Math.sin(Math.PI*(u+170)/8)/2+Math.sin(Math.PI*(u+130)/3)/8;ja=Math.asin((p-r)/100);Ja=Math.cos(ja);Ka=Math.sin(ja);La=(p+r)/2;B===sa&&u-R<5/W||(Ga(h,"attack")?(B=sa,R=u,W=12,S&&S.stop(),p=N.createBufferSource(),p.buffer=Ma[Math.floor(Math.random()*Ma.length)],p.connect(N.destination),p.start(0)):(K=1.2*C*Ia(h,"left","right"),p=F.j+K,p<A.G+1.125?K=A.G+1.125-F.j:p>A.H-1.125&&(K=A.H-1.125-F.j),
0!==K?(F.j+=K,O=0>K,B!==ta&&(B=ta,R=u,W=8)):B!==T?(B=T,R=u,W=12,Aa(T,O?"left":"right",u)):null==S&&R<u-4&&(S=N.createBufferSource(),S.buffer=sb,S.connect(N.destination),S.start(0))));p=Math.floor(48*u)-Math.floor(48*(u-C));for(r=0;r<p;r++){var D=2*Math.random()+1.4;let m=.1*Math.sin(2*Math.PI*Math.random()),G;var x=void 0,v=void 0;if(B===T)v=bb.get(T.name())[T.K],G=F.j+v.x*(O?-1:1),x=v.z,v=v.angle;else if(G=F.j+(tb-(K?.05:0))*(O?-1:1),x=328/360,v=Math.PI/2,B===sa){x=Math.floor(W*(u-R));v=ob[x];G=
F.j+(v.I-(x%3*644+284))*(O?-1:1)/360;m=-Math.abs(m);x=(565-(v.J-565*Math.floor(x/3)))/360;var Z=(v.M-v.I)*(O?-1:1);v=Math.atan((v.J-v.N)/Z);0<Z&&(v+=Math.PI)}Z=Math.PI/4*(Math.random()-.5)+v;v=D*Math.sin(Z);D=D*Math.cos(Z)+K/C;100<U.length&&U.pop();U.push({o:!1,x:G,y:0,z:x,u:D,L:m,C:v,startTime:u,pa:u+1.5,za:!1})}const ub=9.8*Ja*C,vb=9.8*Ka*C,Na=1-.8*C;U.forEach(m=>{var G=m.o;if(!G&&u<m.pa){m.x+=m.u*C;m.y+=m.L*C;m.z+=m.C*C;G=m.C;m.za?(m.u*=Na,m.L*=Na):(G-=ub,m.u-=vb,m.C=G);if(m.x<A.G||m.x>A.H)m.o=
!0;var P=m.y;if(-.5>P||.5<P){const Oa=0<P?.5:-.5;m.y=Oa+(Oa-P);m.L=-m.L}P=A.ja;m.z<P&&(-.01<G?(m.z=180,m.C=P,m.za=!0):(m.z=P-m.z,m.C=-.25*G))}else G||(m.o=!0)});U.sort(qb);lb(A)}function b(p,r,D){r.stack.push(ea);H(r.stack,-Math.min(Math.max(F.j,A.G+2),A.H-2),0,-w);fa(r.stack,ja);H(r.stack,0,0,La);D(p,r);r.stack.pop();r.stack.pop();r.stack.pop()}function c(p,r){const D=r.stack;p=Pa.$a;J(p,r);L(p,"main",0);J(Qa,r);L(Qa,"main",0);J(Ra,r);L(Ra,"main",0);H(D,F.j,0,0);B===T?(B.da=O?"left":"right",Ba(B,
r,u)):(J(B,r),L(B,O?"left":"right",Math.floor(W*(u-R))));D.pop();mb(r,A);J(Sa,r);U.forEach(x=>{x.o||(H(D,x.x,x.y,x.z),fa(D,(0<=x.u?Math.PI:0)+Math.atan(x.C/x.u)),L(Sa,"fading",Math.floor(12*(u-x.startTime))),D.pop(),D.pop())})}function e(p,r){p.bindFramebuffer(p.FRAMEBUFFER,null);p.viewport(0,0,y,z);p.disable(p.BLEND);p.clearColor(0,0,0,1);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);p.activeTexture(p.TEXTURE1);ua.a.bindTexture();p.uniform1i(r.A.lighting,1);p.activeTexture(p.TEXTURE0);b(p,r,c)}
function d(){{const p=(Date.now()-wb)/1E3;C=p-A.v;u=A.v=p;ka=-1===ka?60:1/C/16+.9375*ka;g.innerHTML=`fps=${Math.round(ka)}`}window.a=Math.max(0,Math.min(1,window.a+C/4*Ia(h,"lightDown","lightUp")));Ha(h)%2&&(n=!n);!va&&Ga(h,"fullscreen")&&(va=k.requestFullscreen());w+=C*Ia(h,"down","up");window.cameraZ=w;a();Xa(ua,{Va:b,Za:u,Ua:U,Ra:n});oa(Ta,e);requestAnimationFrame(d)}const g=document.getElementById("fps"),k=document.getElementById("canvas");var f=window.getComputedStyle(k);const h=new Va(document.body);
V(h,"left",["a","ArrowLeft"]);V(h,"right",["d","ArrowRight"]);V(h,"showLights",["l"]);V(h,"attack",["f"," "]);V(h,"fullscreen",["u"]);V(h,"up",["w","ArrowUp"]);V(h,"down",["s","ArrowDown"]);V(h,"lightUp",["y"]);V(h,"lightDown",["h"]);var l=parseInt(f.getPropertyValue("width"),10);f=parseInt(f.getPropertyValue("height"),10);let n=!1;var q=window.devicePixelRatio||1;const y=q*l,z=q*f;k.width=y;k.height=z;let w=1.25;var t=376/f;q=t/(484/f);var I=t/(268/f);t/=1.25;const ea=new Float32Array([f/l*t,0,0,
0,0,0,1,I-q,0,t,0,0,0,0,0,(q+I)/2]),E=k.getContext("webgl2",{antialias:!1,alpha:!1});E.enable(E.DEPTH_TEST);E.depthFunc(E.LEQUAL);l=new ia({b:E,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new ia({b:E,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const Ta=new na({b:E,W:"projection"});ma(Ta,l,f).link();const ua=new Za(E,y,z,360),N=new AudioContext;l=(p,r)=>qa({b:E,name:p,src:r});const [Pa,la,wa,xa,Ma,sb,xb,X,Ua]=await Promise.all([fb(l),qa({b:E,src:"assets/floor.png",name:"floor"}),qa({b:E,src:"assets/Hero Walking with axe.png",name:"walk"}),qa({b:E,src:"assets/Axe Chop.png",name:"attack"}),Promise.all([rb(N,"assets/Grunt1.mp3"),rb(N,"assets/Grunt2.mp3"),rb(N,"assets/Grunt3.mp3")]),rb(N,"assets/Theres something here.mp3"),ib(l),l("ceiling",
"assets/ceiling.png"),db(l)]);let S=null;f=220/la.l;q=la.w/360;l=70/360;I=442/la.l;f/=2;q*=2;I/=2;const Qa=new M(la,{main:[[q,-.5,-l,1,1,0,-.5,-l,0,1,q,-.5,0,1,I,0,-.5,0,0,I,q,.5,0,1,f,0,.5,0,0,f]]});f=X.w/360;f*=2;const Ra=new M(X,{main:[[f,-.5,2.5+l,1,0,0,-.5,2.5+l,0,0,f,-.5,2.5,1,31/X.l,0,-.5,2.5,0,31/X.l,f,.5,2.5,1,144/X.l,0,.5,2.5,0,144/X.l]]}),tb=1.125*(387/405-220/405),T=Ua.Oa,ta=new M(wa,{right:Ea({ca:258/424,ba:424,S:444,aa:wa,Z:360,m:2,count:8}),left:Ea({ca:1-258/424,ba:424,S:444,aa:wa,
Z:360,m:2,count:8,s:!0})}),sa=new M(xa,{right:Ea({ca:284/644,ba:644,S:565,aa:xa,Z:360,m:3,count:5}),left:Ea({ca:1-284/644,ba:644,S:565,aa:xa,Z:360,m:3,count:5,s:!0})});new M(ua.a,{main:[Fa({width:2,height:1,Da:0,Ea:0,Ba:1,Ca:1})]});const F=new cb(4),A=gb({X:{oa:xb,U:Ua,fb:Pa},v:0,G:0,H:12,Aa:2.5,ja:0,U:F}),Sa=pb(E),U=[];let wb=Date.now(),u=0,ka=-1,C=0,K=0,O=!1,R=0,B=ta,W=12,va=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(va=null)});A.O.push(new jb(A,F.j+2,0,
.75));let ja,Ka,Ja,La;requestAnimationFrame(d);k.onmousemove=()=>{}};
