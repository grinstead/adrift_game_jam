'use strict';class t{constructor(b,d,c){this.name=c;this.i=`${d}${c}`;switch(b){case "uniform":this.type=1;if("u_"!==d)throw Error(`uniform field "${this.i}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==d)throw Error(`in field "${this.i}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function u(b){const d=[];b.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&d.push(new t(c[1],c[2],c[3]))});return d}
const v=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function x(b,d,c=0){var a=b.a;a=a[a.length-1]||v;d=new Float32Array([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],d*a[0]+0*a[4]+c*a[8]+a[12],d*a[1]+0*a[5]+c*a[9]+a[13],d*a[2]+0*a[6]+c*a[10]+a[14],d*a[3]+0*a[7]+c*a[11]+a[15]]);b.b.uniformMatrix4fv(b.c,!1,d);b.a.push(d)}class y{constructor(b,d){this.b=b;this.c=d;this.a=[];b.uniformMatrix4fv(d,!1,v)}pop(){return this.a.pop()}}
class z{constructor(b,d){this.name=b.name;var c=this.b=b.b;b=this.type=b.type;switch(b){case "vertex":var a=this.b.VERTEX_SHADER;break;case "fragment":a=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${b}"`);}a=this.a=c.createShader(a);c.shaderSource(a,d);c.compileShader(a);if(!c.getShaderParameter(a,c.COMPILE_STATUS))throw d=`Failed to compile ${this.name} ${b}-shader: ${c.getShaderInfoLog(a)}`,c.deleteShader(a),Error(d);this.s=u(d)}}
function A(b,...d){const c=b.b,a=b.h;d.forEach(e=>{b.j.push(e);c.attachShader(a,e.a)});return b}
class B{constructor(b){this.name=b.name;this.m=b.m;b=this.b=b.b;this.l=!1;this.h=b.createProgram();this.j=[];this.f={};this.c={};this.stack=null;this.a=[];this.A=()=>{var d=this.b,c=this.h;d.useProgram(c);for(var a={},e={},h=this.j,f=0;f<h.length;f++)for(var q=h[f].s,l=0;l<q.length;l++){var k=q[l];1===k.type?k.i in a||(a[k.name]=d.getUniformLocation(c,k.i)):k.i in e||(e[k.name]=d.getAttribLocation(c,k.i))}this.f=a;this.c=e;if(c=this.m)if(c in this.f)this.stack=new y(d,this.f[c]);else throw Error(`No anchor point "${c}" in program`);
try{var m=this.a;for(f=0;f<m.length;m++)m[f](d,this)}finally{this.f={},this.c={},this.stack=null,1===this.a.length?this.a=[]:this.a.pop()}}}link(){if(this.l)return this;var b=this.b,d=this.h;b.linkProgram(d);if(!b.getProgramParameter(d,b.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${b.getProgramInfoLog(d)}`;b.deleteProgram(d);throw Error(c);}this.l=!0;return this}}
class J{constructor(b,d,c,a,e){this.b=b;this.name=d;this.w=c;this.g=a;d=this.a=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);e(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,null)}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}}
function K(b){return(new Promise((d,c)=>{const a=new Image;a.onload=()=>void d(a);a.onerror=()=>{c(Error(`failed to load ${b.src}`))};a.mode="no-cors";a.src=b.src})).then(d=>{const c=d.naturalWidth,a=d.naturalHeight;return new J(b.b,b.name,c,a,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,a,0,e.RGBA,e.UNSIGNED_BYTE,d)})})}function L(b){const d=b.width,c=b.height;return new J(b.b,b.name,d,c,a=>{a.texImage2D(a.TEXTURE_2D,0,a.RGBA,d,c,0,a.RGBA,a.UNSIGNED_BYTE,b.v,0)})};class M{constructor(){this.l=null;this.f=60;this.a=this.c=0;this.j=()=>{{const d=this.a;var b=Date.now();const c=this.h;0!==c&&(this.c=1E3/(b-c)*.1+.9*this.c);this.h=b;try{const a=this.l;a()}finally{b=1E3/this.f-(Date.now()-b),this.a===d&&(this.a=setTimeout(this.j,Math.max(b,0)))}}};this.h=0}start(b=this.f){this.f=b;this.a||(this.h=0,this.c=b,this.a=setTimeout(this.j,0))}};function N(b,d){const c=b.a.b;let a=b.c;null!=a?c.bindBuffer(c.ARRAY_BUFFER,a):(b.c=a=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,a),c.bufferData(c.ARRAY_BUFFER,b.f,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);b.a.bindTexture();c.uniform1i(d.f.texture,0);c.enableVertexAttribArray(d.c.texturePosition);c.vertexAttribPointer(d.c.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(d.c.position);c.vertexAttribPointer(d.c.position,3,c.FLOAT,!1,20,0)}
function O(b,d){if(!b.data.hasOwnProperty(d))throw Error(`Can not render unknown "${d}"`);d=b.data[d];b=b.a.b;b.drawArrays(b.TRIANGLE_STRIP,d.u[0],d.B)}
class P{constructor(b,d){this.a=b;this.c=null;b=this.data={};const c=[];let a=0;for(const e in d){const h=d[e],f=[],q=h.length;if(0===q)throw Error("Sprite declared with 0 points");const l=h[0].length;if(0==l)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const k=l/5;for(let m=0;m<q;m++){const p=h[m];if(p.length!==l)throw Error("Sprite declared with inconsistent lengths of elements");f.push(a);c.push.apply(c,p);a+=k}b[e]={C:this,name:e,u:f,B:k}}this.f=new Float32Array(c)}}
;function Q(){const b=new Uint8Array(129600);for(let e=0;180>e;e++)for(let h=0;180>h;h++){const f=4*(180*e+h);var d=h-90,c=e-90;d=d*d+c*c;if(4>=d)b[f]=255,b[f+1]=255,b[f+2]=255,b[f+3]=255;else{var a=4/d;c=Math.floor(256*a);a=Math.floor(256*a*a);b[f]=255;b[f+1]=a;b[f+2]=a;b[f+3]=8100<=d?0:c}}return b}
window.onload=async function(){function b(r,n){r=n.stack;var C=R;r.b.uniformMatrix4fv(r.c,!1,C);r.a.push(C);x(n.stack,Math.sin((Date.now()-S)/1E3/4)-1.5,g.d/2+g.g);N(D,n);O(D,"main");N(E,n);O(E,"main");x(n.stack,4,0);N(F,n);O(F,"idle");n.stack.pop();n.stack.pop();N(G,n);x(n.stack,H/180,(h-I)/180);O(G,"main")}const d=document.getElementById("fps"),c=document.getElementById("canvas");var a=window.getComputedStyle(c);let e=parseInt(a.getPropertyValue("width"),10),h=parseInt(a.getPropertyValue("height"),
10);a=window.devicePixelRatio||1;1!==a&&(c.width=a*e,c.height=a*h);a=c.getContext("webgl2",{antialias:!1,alpha:!1});a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);const f=new z({b:a,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n        float variance = 1.f / (position.z + 1.f);\n\n        vec4 result = vec4(position.x, position.y * variance, -.5f * (position.z - 1.f) * variance, variance);\n        gl_Position = result;\n\n        v_texturePosition = a_texturePosition;\n    }\n"),
q=new z({b:a,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }\n"),l=new B({b:a,m:"projection"});A(l,f,q).link();const [k,m,p]=await Promise.all([K({b:a,src:"assets/Background Wall.png",name:"wall"}),K({b:a,
src:"assets/Floor 2.png",name:"floor"}),K({b:a,src:"assets/Hero Breathing0001.png",name:"idle"})]),g={w:m.w/360,g:34/360,d:175/360,o:175/209},D=new P(k,{main:[[k.w/360,-g.d/2,k.g/360,1,0,k.w/360,-g.d/2,0,1,1,0,-g.d/2,k.g/360,0,0,0,-g.d/2,0,0,1]]}),E=new P(m,{main:[[g.w,g.d/2,-g.g,1,1,0,g.d/2,-g.g,0,1,g.w,g.d/2,0,1,g.o,0,g.d/2,0,0,g.o,g.w,-g.d/2,0,1,0,0,-g.d/2,0,0,0]]}),F=new P(p,{idle:[[p.w/360,0,p.g/360,1,0,p.w/360,0,0,1,1,0,0,p.g/360,0,0,0,0,0,0,1]]});a=L({name:"fade",width:180,height:180,b:a,v:Q()});
const G=new P(a,{main:[[.5,0,-.5,1,0,.5,0,.5,1,1,-.5,0,-.5,0,0,-.5,0,.5,0,1]],white:[[40,0,0,.5,.5,40,0,20,.5,.5,0,0,0,.5,.5,0,0,20,.5,.5]]});let H=0,I=0;const R=new Float32Array([360/e,0,0,0,0,-360/h,.25,0,0,360/h,0,0,-1,-1,0,1]);let S=Date.now();const w=new M;w.l=function(){d.innerHTML=`fps=${Math.round(w.c)}/${w.f}`;l.a.includes(b)||l.a.push(b);requestAnimationFrame(l.A)};w.start(60);c.onmousemove=r=>{H=r.offsetX;I=r.offsetY}};
