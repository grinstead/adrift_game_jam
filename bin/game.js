'use strict';class v{constructor(a,c,b){this.name=b;this.i=`${c}${b}`;switch(a){case "uniform":this.type=1;if("u_"!==c)throw Error(`uniform field "${this.i}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==c)throw Error(`in field "${this.i}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function w(a){const c=[];a.split("\n").forEach(b=>{(b=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(b))&&c.push(new v(b[1],b[2],b[3]))});return c}
const z=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function A(a,c){a.a.uniformMatrix4fv(a.c,!1,c);a.b.push(c)}function B(a,c,b,e=0){var d=a.b;d=d[d.length-1]||z;A(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],c*d[0]+b*d[4]+e*d[8]+d[12],c*d[1]+b*d[5]+e*d[9]+d[13],c*d[2]+b*d[6]+e*d[10]+d[14],c*d[3]+b*d[7]+e*d[11]+d[15]]))}class F{constructor(a,c){this.a=a;this.c=c;this.b=[];a.uniformMatrix4fv(c,!1,z)}pop(){return this.b.pop()}}
class G{constructor(a,c){this.name=a.name;var b=this.a=a.a;a=this.type=a.type;switch(a){case "vertex":var e=this.a.VERTEX_SHADER;break;case "fragment":e=this.a.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.b=b.createShader(e);b.shaderSource(e,c);b.compileShader(e);if(!b.getShaderParameter(e,b.COMPILE_STATUS))throw c=`Failed to compile ${this.name} ${a}-shader: ${b.getShaderInfoLog(e)}`,b.deleteShader(e),Error(c);this.C=w(c)}}
function H(a,...c){const b=a.a,e=a.s;c.forEach(d=>{a.A.push(d);b.attachShader(e,d.b)});return a}function I(a,c){a.g.includes(c)||a.g.push(c);requestAnimationFrame(a.I)}
class J{constructor(a){this.name=a.name;this.u=a.u;a=this.a=a.a;this.B=!1;this.s=a.createProgram();this.A=[];this.c={};this.b={};this.stack=null;this.g=[];this.I=()=>{var c=this.a,b=this.s;c.useProgram(b);for(var e={},d={},h=this.A,f=0;f<h.length;f++)for(var l=h[f].C,k=0;k<l.length;k++){var n=l[k];1===n.type?n.i in e||(e[n.name]=c.getUniformLocation(b,n.i)):n.i in d||(d[n.name]=c.getAttribLocation(b,n.i))}this.c=e;this.b=d;if(b=this.u)if(b in this.c)this.stack=new F(c,this.c[b]);else throw Error(`No anchor point "${b}" in program`);
try{var r=this.g;this.g=[];for(f=0;f<r.length;r++)r[f](c,this)}finally{this.c={},this.b={},this.stack=null}}}link(){if(this.B)return this;var a=this.a,c=this.s;a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS)){var b=`Failed to link ${this.name} program: ${a.getProgramInfoLog(c)}`;a.deleteProgram(c);throw Error(b);}this.B=!0;return this}}
class K{constructor(a,c,b,e,d){this.a=a;this.name=c;this.w=b;this.f=e;c=this.b=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);d(a);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,null)}bindTexture(){this.a.bindTexture(this.a.TEXTURE_2D,this.b)}}
function T(a){return(new Promise((c,b)=>{const e=new Image;e.onload=()=>void c(e);e.onerror=()=>{b(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(c=>{const b=c.naturalWidth,e=c.naturalHeight;return new K(a.a,a.name,b,e,d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,e,0,d.RGBA,d.UNSIGNED_BYTE,c)})})}function U(a){const c=a.width,b=a.height;return new K(a.a,a.name,c,b,e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,c,b,0,e.RGBA,e.UNSIGNED_BYTE,a.F,0)})};function V(a,c){const b=a.b.a;let e=a.c;null!=e?b.bindBuffer(b.ARRAY_BUFFER,e):(a.c=e=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,e),b.bufferData(b.ARRAY_BUFFER,a.g,b.STATIC_DRAW));b.activeTexture(b.TEXTURE0);a.b.bindTexture();b.uniform1i(c.c.texture,0);b.enableVertexAttribArray(c.b.texturePosition);b.vertexAttribPointer(c.b.texturePosition,2,b.FLOAT,!1,20,12);b.enableVertexAttribArray(c.b.position);b.vertexAttribPointer(c.b.position,3,b.FLOAT,!1,20,0)}
function W(a,c,b){if(!a.data.hasOwnProperty(c))throw Error(`Can not render unknown "${c}"`);c=a.data[c];a=a.b.a;a.drawArrays(a.TRIANGLE_STRIP,c.D[b],c.J)}
class X{constructor(a,c){this.b=a;this.c=null;a=this.data={};const b=[];let e=0;for(const d in c){const h=c[d],f=[],l=h.length;if(0===l)throw Error("Sprite declared with 0 points");const k=h[0].length;if(0==k)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const n=k/5;for(let r=0;r<l;r++){const u=h[r];if(u.length!==k)throw Error("Sprite declared with inconsistent lengths of elements");f.push(e);b.push.apply(b,u);e+=n}a[d]={K:this,name:d,D:f,J:n}}this.g=new Float32Array(b)}}
;function Y(){const a=new Uint8Array(4096),c=(d,h)=>{d/=360;h/=360;return d*d+h*h},b=Math.min(c(16,0),c(16,0));for(let d=0;32>d;d++)for(let h=0;32>h;h++){const f=4*(32*d+h),l=c(h-16,d-16);if(1E-4>=l)a[f]=255,a[f+1]=255,a[f+2]=255,a[f+3]=255;else{var e=Math.sqrt(1E-4/l);const k=Math.floor(256*e);e=Math.floor(256*e*e);a[f]=255;a[f+1]=e;a[f+2]=e;a[f+3]=l>=b?0:k}}return a}function Z({x:a=0,y:c=0,z:b=0,width:e,height:d,m:h,o:f,j:l,l:k}){return[e-a,c,-b,l,k,-a,c,-b,h,k,e-a,c,d-b,l,f,-a,c,d-b,h,f]}
window.onload=async function(){function a(q,p){q=Date.now();const x=(q-L)/1E3;L=q;c.innerHTML=`fps=${Math.round(1/x)}`;A(p.stack,aa);q=(q-ba)/1E3;const ca=Math.floor(10*q)-Math.floor(10*M);for(let g=0;g<ca;g++){var C=(Math.random()-.5)*Math.PI/4+Math.PI/2;const N=2*Math.random()+1,da=4-t/2+282/360,ea=326/360,fa=N*Math.sin(C);C=N*Math.cos(C);100<D.length&&D.shift();D.push({x:da,y:0,z:ea,G:C,H:.1*Math.sin(2*Math.PI*Math.random()),h:fa})}M=q;B(p.stack,Math.sin(q/4)-1.5,0,m.d/2+m.f);V(O,p);W(O,"main",
0);V(P,p);W(P,"main",0);B(p.stack,4,0,0);V(Q,p);W(Q,"idle",Math.floor(4*q)%4);p.stack.pop();V(E,p);D.forEach(g=>{0<=g.z&&(g.h-=9.8*x,g.x+=g.G*x,g.y+=g.H*x,g.z+=g.h*x,0>g.z?(g.z=-g.z,g.h*=-.25):.01>g.z&&.1>Math.abs(g.h)&&(g.z=-1),B(p.stack,g.x,g.y,g.z),W(E,"main",0),p.stack.pop())});p.stack.pop();V(E,p);B(p.stack,R/180,0,(h-S)/180);W(E,"main",0);I(p,a)}const c=document.getElementById("fps"),b=document.getElementById("canvas");var e=window.getComputedStyle(b);let d=parseInt(e.getPropertyValue("width"),
10),h=parseInt(e.getPropertyValue("height"),10);e=window.devicePixelRatio||1;1!==e&&(b.width=e*d,b.height=e*h);var f=b.getContext("webgl2",{antialias:!1,alpha:!1});f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);f.enable(f.DEPTH_TEST);f.depthFunc(f.LEQUAL);var l=new G({a:f,type:"vertex"},"#version 300 es\n\n    in vec3 a_position;\n    in vec2 a_texturePosition;\n\n    uniform mat4 u_projection;\n\n    out vec2 v_texturePosition;\n\n    void main() {\n        vec4 position = u_projection * vec4(a_position, 1);\n        float variance = 1.f / (position.z + 1.f);\n\n        vec4 result = vec4(position.x, position.y * variance, -.5f * (position.z - 1.f) * variance, variance);\n        gl_Position = result;\n\n        v_texturePosition = a_texturePosition;\n    }\n"),
k=new G({a:f,type:"fragment"},"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n\n    in vec2 v_texturePosition;\n    out vec4 output_color;\n\n    void main() {\n        vec4 color = texture(u_texture, v_texturePosition.st);\n        if (color.a == 0.0) {\n            discard;\n        }\n        output_color = color;\n    }\n");e=new J({a:f,u:"projection"});H(e,l,k).link();const [n,r,u]=await Promise.all([T({a:f,src:"assets/Background Wall.png",name:"wall"}),T({a:f,
src:"assets/Floor 2.png",name:"floor"}),T({a:f,src:"assets/Hero Breathing.png",name:"idle"})]),m={w:r.w/360,f:34/360,d:175/360,v:175/209},O=new X(n,{main:[[n.w/360,-m.d/2,n.f/360,1,0,n.w/360,-m.d/2,0,1,1,0,-m.d/2,n.f/360,0,0,0,-m.d/2,0,0,1]]}),P=new X(r,{main:[[m.w,m.d/2,-m.f,1,1,0,m.d/2,-m.f,0,1,m.w,m.d/2,0,1,m.v,0,m.d/2,0,0,m.v,m.w,-m.d/2,0,1,0,0,-m.d/2,0,0,0]]}),t=294/360;l=434/360;k=294/u.w;const y=434/u.f,Q=new X(u,{idle:[Z({x:t/2,width:t,height:l,m:0,j:k,o:0,l:y}),Z({x:t/2,width:t,height:l,
m:k,j:2*k,o:0,l:y}),Z({x:t/2,width:t,height:l,m:2*k,j:3*k,o:0,l:y}),Z({x:t/2,width:t,height:l,m:0,j:k,o:y,l:2*y})]});f=U({name:"fade",width:32,height:32,a:f,F:Y()});const E=new X(f,{main:[[16/360,0,-16/360,1,0,16/360,0,16/360,1,1,-16/360,0,-16/360,0,0,-16/360,0,16/360,0,1]]});let R=0,S=0;const aa=new Float32Array([360/d,0,0,0,0,-360/h,.25,0,0,360/h,0,0,-1,-1,0,1]),D=[];let ba=Date.now(),L=Date.now(),M=0;I(e,a);b.onmousemove=q=>{R=q.offsetX;S=q.offsetY}};
