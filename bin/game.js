'use strict';class aa{constructor(a,b,c){this.name=c;this.G=`${b}${c}`;switch(a){case "uniform":this.type=1;if("u_"!==b)throw Error(`uniform field "${this.G}" invalid, must start with u_`);break;case "in":this.type=2;if("a_"!==b)throw Error(`in field "${this.G}" invalid, must start with a_`);break;default:throw Error("Impossible");}}}function ba(a){const b=[];a.split("\n").forEach(c=>{(c=/^\s*(in|uniform)\s(?:\w+\s)*([ua]_)(\w+);/.exec(c))&&b.push(new aa(c[1],c[2],c[3]))});return b}
const ja=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);function ka(a,b){a.b.uniformMatrix4fv(a.i,!1,b);a.a.push(b)}function G(a,b,c,e=0){var d=a.a;d=d.length?d[d.length-1]:ja;ka(a,new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],b*d[0]+c*d[4]+e*d[8]+d[12],b*d[1]+c*d[5]+e*d[9]+d[13],b*d[2]+c*d[6]+e*d[10]+d[14],b*d[3]+c*d[7]+e*d[11]+d[15]]))}function H(a,b){const c=Math.cos(b);b=Math.sin(b);a.push(new Float32Array([c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1]))}
class la{constructor(a,b){this.b=a;this.i=b;this.a=[];a.uniformMatrix4fv(b,!1,ja)}pop(){return this.a.pop()}push(a){var b=this.a;0===b.length?ka(this,a):(b=b[b.length-1],ka(this,new Float32Array([a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*
b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]])))}}
class M{constructor(a,b){this.name=a.name;var c=this.b=a.b;a=this.type=a.type;switch(a){case "vertex":var e=this.b.VERTEX_SHADER;break;case "fragment":e=this.b.FRAGMENT_SHADER;break;default:throw Error(`Unrecognized shader type "${a}"`);}e=this.a=c.createShader(e);c.shaderSource(e,b);c.compileShader(e);if(!c.getShaderParameter(e,c.COMPILE_STATUS))throw b=`Failed to compile ${this.name} ${a}-shader: ${c.getShaderInfoLog(e)}`,c.deleteShader(e),Error(b);this.Aa=ba(b)}}
function ma(a,...b){const c=a.b,e=a.ba;b.forEach(d=>{a.ma.push(d);c.attachShader(e,d.a)});return a}class na{constructor(a){this.name=a.name;this.K=a.K;a=this.b=a.b;this.a=!1;this.ba=a.createProgram();this.ma=[];this.A={};this.C={};this.stack=null}link(){if(this.a)return this;var a=this.b,b=this.ba;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS)){var c=`Failed to link ${this.name} program: ${a.getProgramInfoLog(b)}`;a.deleteProgram(b);throw Error(c);}this.a=!0;return this}}
function oa(a,b){var c=a.b,e=a.ba;c.useProgram(e);for(var d={},g={},l=a.ma,f=0;f<l.length;f++)for(var h=l[f].Aa,k=0;k<h.length;k++){var n=h[k];1===n.type?n.G in d||(d[n.name]=c.getUniformLocation(e,n.G)):n.G in g||(g[n.name]=c.getAttribLocation(e,n.G))}a.A=d;a.C=g;if(e=a.K)if(e in a.A)a.stack=new la(c,a.A[e]);else throw Error(`No anchor point "${e}" in program`);try{b(c,a)}finally{a.A={},a.C={},a.stack=null}}
class pa{constructor(a,b,c,e,d){this.b=a;this.name=b;this.w=c;this.j=e;this.a=d(a)}bindTexture(){this.b.bindTexture(this.b.TEXTURE_2D,this.a)}}function ta(a){return(new Promise((b,c)=>{const e=new Image;e.onload=()=>void b(e);e.onerror=()=>{c(Error(`failed to load ${a.src}`))};e.mode="no-cors";e.src=a.src})).then(b=>{const c=b.naturalWidth,e=b.naturalHeight;return new pa(a.b,a.name,c,e,ua(d=>{d.texImage2D(d.TEXTURE_2D,0,d.RGBA,c,e,0,d.RGBA,d.UNSIGNED_BYTE,b)}))})}
function va(a){const b=a.width,c=a.height;return new pa(a.b,a.name,b,c,ua(e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b,c,0,e.RGBA,e.UNSIGNED_BYTE,a.na,0)}))}function wa(a){return new pa(a.b,a.name,a.width,a.height,()=>a.N)}
function ua(a){return b=>{const c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);a(b);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);return c}};function N(a,b){const c=a.a.b;let e=a.i;null!=e?c.bindBuffer(c.ARRAY_BUFFER,e):(a.i=e=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,e),c.bufferData(c.ARRAY_BUFFER,a.F,c.STATIC_DRAW));c.activeTexture(c.TEXTURE0);a.a.bindTexture();c.uniform1i(b.A.texture,0);c.enableVertexAttribArray(b.C.texturePosition);c.vertexAttribPointer(b.C.texturePosition,2,c.FLOAT,!1,20,12);c.enableVertexAttribArray(b.C.position);c.vertexAttribPointer(b.C.position,3,c.FLOAT,!1,20,0)}
function O(a,b,c){if(!a.data.hasOwnProperty(b))throw Error(`Can not render unknown "${b}"`);b=a.data[b];a=a.a.b;const e=b.ca;a.drawArrays(a.TRIANGLE_STRIP,e[c%e.length],b.Ra)}
class R{constructor(a,b){this.a=a;this.i=null;a=this.data={};const c=[];let e=0;for(const d in b){const g=b[d],l=[],f=g.length;if(0===f)throw Error("Sprite declared with 0 points");const h=g[0].length;if(0==h)throw Error("Sprite declared with list of length 5 (must be non-zero multiple of 5)");const k=h/5;for(let n=0;n<f;n++){const r=g[n];if(r.length!==h)throw Error("Sprite declared with inconsistent lengths of elements");l.push(e);c.push.apply(c,r);e+=k}a[d]={fb:this,name:d,ca:l,Ra:k}}this.F=new Float32Array(c)}}
function xa(a,b){for(var c=a.B;-1!==c&&c<=b;){c=a.F;const e=a.a+1;e===c.length?a.i===a.Oa?a.B=c=-1:(a.i++,a.a=0,a.B=c=b+c[0]):(a.a=e,a.B=c=b+c[e])}}function U(a,b,c){if(!a.Ma.includes(b))throw Error(`${a} does not have mode ${b}`);a.i=0;a.aa=b;a.a=0;a.B=c+a.F[0]}function ya(a,b){const c=a.aa;if(null==c)throw Error(`${a} tried rendering while inactive`);N(a.qa,b);O(a.qa,c,a.a)}
class za{constructor(a,b){const c=a.v;this.T=a.name;this.Ma=a.W;this.aa=null;this.Oa="number"===typeof c?c:c?-1:0;this.qa=a.set;this.F=b;this.i=0;this.B=this.a=-1;this.La=a.Ta}S(){const a=this.La;return null!=a?a[this.a]:void 0}name(){return this.T}toString(){return`Sprite/${this.T}`}}
function Aa(a){const b=a.name,c=a.u,e=a.set.data;let d=-1;a.W.forEach(l=>{const f=e[l];if(!f)throw Error(`Sprite/${b} has non-existent mode ${l}`);if(-1===d)d=f.ca.length;else if(d!==f.ca.length)throw Error(`Sprite/${b} has inconsistent frame counts`);});if(-1===d)throw Error(`Sprite/${b} given 0 modes`);if("number"!==typeof c&&c.length!==d)throw Error(`Sprite/${b} given ${c.length} frame times for ${d} frames`);if(a.S&&a.S.length!==d)throw Error(`Sprite/${b} given ${a.S.length} frame data points for ${d} frames`);
const g="number"===typeof c?Array(d).fill(c):c;return()=>new za(a,g)}function W({x:a=0,y:b=0,z:c=0,width:e,height:d,$:g,Z:l,X:f,count:h,kb:k=0,lb:n=0,mb:r=g,jb:y=l,M:v=!1}){const z=[];for(let t=0;t<h;t++){const u=k+t%f*r,J=n+Math.floor(t/f)*y;z.push(Ba({x:a,y:b,z:c,width:e,height:d,Za:u,Xa:u+g,$a:J,Ya:J+l,M:v}))}return z}function Ba({x:a=0,y:b=0,z:c=0,width:e,height:d,Za:g,$a:l,Xa:f,Ya:h,M:k=!1}){k?(k=f,f=a-e):(k=g,g=f,f=-a,a=e-a);return[a,b,-c,g,h,f,b,-c,k,h,a,b,d-c,g,l,f,b,d-c,k,l]};function X(a,b,c){a=a.i;null!=c?a.set(b,c):a.delete(b)}function Y(a,b){b=a.i.get(b);const c=a.a;return!!b&&!!b.some(e=>(e=c.get(e))?(e.P=0,null!=e.U):!1)}function Ca(a){const b=a.i.get("showLights");if(b){const c=a.a;return b.reduce((e,d)=>(d=c.get(d))?(e+=d.P,d.P=0,e):e,0)}return 0}function Na(a,b,c){b=Y(a,b)?1:0;return(Y(a,c)?1:0)-b}
class Oa{constructor(a){this.a=new Map;this.i=new Map;a.addEventListener("keydown",b=>{Pa(this,b,!0)});a.addEventListener("keyup",b=>{Pa(this,b,!1)});a.onblur=()=>{this.a.clear()};a.onfocus=()=>{this.a.clear()}}}function Pa(a,b,c){b=b.key;a=a.a;const e=a.get(b);c?null==e?a.set(b,{U:Date.now(),P:1}):(null==e.U&&(e.U=Date.now()),e.P++):null!=e&&(e.U=null)};function Qa(a,b){const c=a.a.b,e=a.i;c.enable(c.BLEND);c.blendFunc(c.ONE,c.ONE);c.bindFramebuffer(c.FRAMEBUFFER,a.T);c.viewport(0,0,e.w,e.j);oa(a.a,(d,g)=>{Ra(d,g,a,b)})}
class Sa{constructor(a,b,c,e){b/=4;c/=4;var d=new M({b:a,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec2 v_texturePosition;\n\nvoid main() {\n  vec4 position = u_projection * vec4(a_position, 1);\n  // float inverse = 1.f / (1.f - position.z * .2f);\n\n  // vec4 result = vec4(position.x, -inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n  // gl_Position = result;\n  gl_Position = position;\n  \n  v_texturePosition = a_texturePosition;\n}"),g=
new M({b:a,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_threshold;\n\nin vec2 v_texturePosition;\nout vec4 output_color;\n\nvoid main() {\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    color.a -= u_threshold;\n    if (color.a <= u_threshold) {\n        discard;\n    }\n    output_color = color;\n}");const l=new na({b:a,K:"projection"});ma(l,d,g).link();d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);g=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,g);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0);a.bindFramebuffer(a.FRAMEBUFFER,null);const f=128/e;e=va({name:"fade",width:64,height:64,b:a,na:Ta(e)});this.a=l;this.i=wa({N:d,name:"lighting",
width:b,height:c,b:a});this.T=g;this.F=new R(e,{main:[[f,0,-f,1,0,f,0,f,1,1,-f,0,-f,0,0,-f,0,f,0,1]]})}}function Ra(a,b,c,e){e.Na?a.clearColor(0,0,0,1):a.clearColor(0,0,0,window.a);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);e.Ua(a,b,()=>{const d=c.F;N(d,b);const g=b.A.threshold,l=e.ab;e.Sa.forEach(f=>{if(!f.m){var h=f.startTime;h=(l-h)/(f.pa-h);a.uniform1f(g,.5*h*h);G(b.stack,f.x,f.y,f.z);O(d,"main",0);b.stack.pop()}})})}
function Ta(a){const b=new Uint8Array(16384),c=(g,l)=>{g/=a;l/=a;return g*g+l*l},e=Math.min(c(32,0),c(32,0));for(let g=0;64>g;g++)for(let l=0;64>l;l++){const f=4*(64*g+l);var d=c(l-32,g-32);const h=1-Math.sqrt(d/e);d=1E-4>=d?5:0;const k=Math.max(Math.round(255*h*h),0);b[f]=d+Math.max(Math.round(20*h),0);b[f+1]=d;b[f+2]=d;b[f+3]=k}return b};function Ua(a,b){return 0<b?Math.atan(a/b):0===b?0<a?Math.PI/2:0===a?0:-Math.PI/2:Math.atan(a/b)+Math.PI};const Z=434/1.8;class Va{constructor(a){this.l=a}}
async function Wa(a){const [b,c,e]=await Promise.all([a("hero_idle","assets/Hero Breathing with axe.png"),a("hero_walk","assets/Hero Walking with axe.png"),a("hero_attack","assets/Axe Chop.png")]);a=Xa({name:"hero_idle",N:b,ja:405,ea:434,ka:220,la:434,da:16,v:!0,u:1/12,R:[{g:388,h:104,c:385,f:170},{g:792,h:105,c:790,f:170},{g:1198,h:105,c:1195,f:169},{g:1602,h:106,c:1600,f:170},{g:2008,h:106,c:2005,f:172},{g:388,h:539,c:385,f:604},{g:794,h:540,c:790,f:605},{g:1196,h:539,c:1196,f:604},{g:1602,h:539,
c:1602,f:604},{g:2009,h:541,c:2007,f:604},{g:386,h:974,c:385,f:1036},{g:792,h:972,c:790,f:1033},{g:1198,h:974,c:1196,f:1038},{g:1602,h:972,c:1601,f:1036},{g:2010,h:974,c:2005,f:1044},{g:386,h:1406,c:385,f:1477}]})();const d=Xa({name:"hero_walk",N:c,ja:424,ea:444,ka:258,la:444,da:8,v:!0,u:.125,R:[{g:408,h:110,c:404,f:166},{g:830,h:110,c:829,f:166},{g:408,h:554,c:404,f:614},{g:830,h:554,c:829,f:614},{g:408,h:998,c:404,f:1055},{g:830,h:998,c:829,f:1055},{g:408,h:1444,c:404,f:1500},{g:830,h:1444,c:829,
f:1500}]})(),g=Xa({name:"hero_attack",N:e,ja:644,ea:565,ka:284,la:565,da:5,v:!1,u:1/12,R:[{g:422,h:285,c:415,f:353},{g:936,h:367,c:868,f:380},{g:1507,h:311,c:1469,f:318},{g:162,h:948,c:206,f:943},{g:1025,h:934,c:976,f:962}]})();return{Ka:a,bb:d,Ba:g}}
function Xa(a){var b=a.N;const c=a.ja,e=a.ea,d=a.ka,g=a.la,l=Math.floor(b.w/c),f={x:d/Z,z:(e-g)/Z,width:c/Z,height:e/Z,$:c/b.w,Z:e/b.j,X:l,count:a.da},h=a.R&&a.R.map(({g:k,h:n,c:r,f:y},v)=>({Ga:{x:(k-(v%l*c+d))/Z,z:(Math.floor(v/l)*e+g-n)/Z,angle:Ua(-(n-y),k-r)}}));b=new R(b,{right:W(f),left:W({...f,M:!0})});return Aa({name:a.name,set:b,W:["left","right"],v:a.v,u:a.u,Ta:h})};function Ya(a,b){var c=376/b;const e=c/(484/b),d=c/(268/b);c/=1.25;a=b/a*c;return{Qa:new Float32Array([a,0,0,0,0,0,1,d-e,0,c,0,0,0,0,0,(e+d)/2]),ob:e,nb:d,hb:a,ib:c}}async function Za(a,b){[b]=await Promise.all([b("wall","assets/Back Wall.png"),b("floor","assets/floor.png")]);return{K:a,eb:b}};function $a(a){const b=a.H,c=a.I;var e=a.L,d=a.o,g=a.ya,l=a.ha;{var f=c-b;const h=a.L.Ea.eb,k=648/h.j,n=(1-k)*h.j/2.5*f/h.w;f={cb:new R(h,{main:[[f-b,.5,2.5,n,k,f-b,.5,0,n,1,-b,.5,2.5,0,k,-b,.5,0,0,1]]})}}return{L:e,O:[],o:d,H:b,I:c,ya:g,ha:l,Fa:f,V:a.V}};const ab=new Float32Array([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);
async function bb(a){const [b,c,e]=await Promise.all([a("creature","assets/Enemy.png"),a("tentacle","assets/Tentacle.png"),a("creature_attack","assets/enemy_bite.png")]);var d=new R(b,{blink:W({x:.25,z:.25,width:.5,height:.5,$:108/b.w,Z:108/b.j,X:2,count:6,M:!0})});a=Aa({name:"creature_attack",set:new R(e,{bite:W({x:.5,z:.75,width:1,height:2,Z:530/e.j,$:278/e.w,X:7,count:42,M:!0})}),W:["bite"],v:!0,u:1/12});var g=Array(6).fill(.125);g[0]=4;d=Aa({name:"creature_normal",set:d,W:["blink"],v:!0,u:g});
g=[];var l=92,f=-22;const h=Math.sqrt(l*l+f*f);l/=h;f/=h;for(let k=0;29>k;k++){const n=k%5,r=Math.floor(k/5),y=[],v=(z,t)=>{const u=100*z,J=77*t-48;y.push((u*l+J*f)/h,z,(u*-f+J*l)/360,100*(n+z)/c.w,77*(r+t)/c.j)};v(1,1);v(0,1);v(1,0);v(0,0);g.push(y)}g=new R(c,{wiggle:g});return{Pa:d,gb:a,Wa:g}}class cb{constructor(a,b,c,e){const d=a.L.oa.Pa();U(d,"blink",a.o);this.x=this.Va=b;this.y=c;this.z=e;this.va=this.wa=0;this.ia=[db(0,b,c,-1,1),db(1,b,c,-1,-1),db(2,b,c,1,1),db(3,b,c,1,-1)];this.za=d}}
function eb(a){const b=a.o;a.O.forEach(c=>{c.x=c.Va+Math.sin(b);var e=.5*Math.cos(b);xa(c.za,a.o);if(b>c.wa){var d=c.va;c.va=(d+1)%c.ia.length;d=c.ia[d];e=c.x+.225*e+d.Ia;.05<Math.abs(e-d.Y)&&(c.wa=b+.125,d.ua=b+.125,d.ra=d.Y,d.sa=d.fa,d.ta=d.ga,d.Y=e,d.fa=c.y+d.Ja,d.ga=0)}})}
function fb(a,b){const c=a.stack,e=b.L.oa.Wa,d=b.o,{x:g,z:l}={x:b.V.l,z:1.7};b.O.forEach(f=>{var h=f.x;const k=f.z;G(c,h,f.y,k);let n=g<h;h=Ua(l-k,g-h);n&&(c.push(ab),h=Math.PI-h);H(c,h);ya(f.za,a);c.pop();n&&c.pop();c.pop()});N(e,a);b.O.forEach(f=>{const h=f.z-.1875;f.ia.forEach(k=>{var n=f.x+k.Ca,r=f.y+k.Da;let y=k.Y,v=k.fa,z=k.ga;var t=k.ua;d<t&&(t=1-(t-d)/.125,y=gb(t,k.ra,n,y),v=gb(t,k.sa,r,v),z=gb(t,k.ta,h,z));n-=y;r-=v;t=h-z;const u=Math.sqrt(n*n+r*r+t*t);G(c,y,v,z);H(c,Ua(t,n));c.push(new Float32Array([u,
0,0,0,0,r,0,0,0,0,1,0,0,0,0,1]));O(e,"wiggle",Math.abs((Math.floor(24*d)+k.Ha)%57+1-29));c.pop();c.pop();c.pop()})})}function db(a,b,c,e,d){const g=.4*e;d=.1*d;b+=g;c+=d;return{index:a,Ca:.05*e,Da:0,Ia:g,Ja:d,ua:0,ra:b,sa:c,ta:0,Y:b,fa:c,ga:0,Ha:0}}function gb(a,b,c,e){return a*(a*e+(1-a)*c)+(1-a)*(a*c+(1-a)*b)};window.a=.1;function hb(a){const b=1/18/18,c=g=>Math.max(0,Math.min(255,Math.round(256*(1-b*g*g)))),e=[];for(let g=0;2>g;g++)for(let l=0;18>l;l++)for(let f=0;2>f;f++){let h;var d=void 0;let k;d=l+6*f;18>d?(h=255,d=c(d),k=255):k=d=h=0;c(l+6*f);c(l+6*f+1);for(let n=0;2>n;n++)e.push(h,d,d,k)}a=va({name:"spark",width:72,height:2,b:a,na:new Uint8Array(e)});return new R(a,{fading:W({x:1/180,width:.04,height:2/180,$:1/18,Z:1,X:18,count:18})})}function ib(a,b){return a.m?b.m?0:1:b.m?-1:a.y-b.y}
function jb(a,b){return fetch(b).then(c=>{if(!c.ok)throw Error(`failed to load ${b}`);return c.arrayBuffer()}).then(c=>a.decodeAudioData(c))}
window.onload=async function(){function a(){var m=Math.sin(Math.PI*(w+0)/8)/2+Math.sin(Math.PI*(w+0)/3)/8,q=Math.sin(Math.PI*(w+170)/8)/2+Math.sin(Math.PI*(w+130)/3)/8;ca=Math.asin((m-q)/100);Da=Math.cos(ca);Ea=Math.sin(ca);Fa=(m+q)/2;if(E!==da||-1===da.B)Y(h,"attack")?(E=da,U(da,"right",w),P&&P.stop(),m=K.createBufferSource(),m.buffer=Ga[Math.floor(Math.random()*Ga.length)],m.connect(K.destination),m.start(0)):(L=1.2*A*Na(h,"left","right"),m=F.l+L,m<x.H+1.125?L=x.H+1.125-F.l:m>x.I-1.125&&(L=x.I-
1.125-F.l),0!==L?(F.l+=L,V=0>L,E!==ea&&(E=ea,U(ea,V?"left":"right",w))):E!==qa?(E=qa,U(qa,V?"left":"right",w)):null==P&&0<w-4&&(P=K.createBufferSource(),P.buffer=kb,P.connect(K.destination),P.start(0)));xa(E,w);m=Math.floor(48*w)-Math.floor(48*(w-A));for(q=0;q<m;q++){var B=2*Math.random()+1.4;let p=.1*Math.sin(2*Math.PI*Math.random());var C=E.S(),S=C&&C.Ga;if(!S)continue;C=F.l+S.x*(V?-1:1);const I=S.z,D=Math.PI/4*(Math.random()-.5)+S.angle;S=B*Math.sin(D);B=B*Math.cos(D)+L/A;100<Q.length&&Q.pop();
Q.push({m:!1,x:C,y:.01,z:I,s:B,J:p,D:S,startTime:w,pa:w+1.5,xa:!1})}const lb=9.8*Da*A,mb=9.8*Ea*A,Ha=1-.8*A;Q.forEach(p=>{var I=p.m;if(!I&&w<p.pa){p.x+=p.s*A;p.y+=p.J*A;p.z+=p.D*A;I=p.D;p.xa?(p.s*=Ha,p.J*=Ha):(I-=lb,p.s-=mb,p.D=I);if(p.x<x.H||p.x>x.I)p.m=!0;var D=p.y;if(-.5>D||.5<D){const Ia=0<D?.5:-.5;p.y=Ia+(Ia-D);p.J=-p.J}D=x.ha;p.z<D&&(-.01<I?(p.z=180,p.D=D,p.xa=!0):(p.z=D-p.z,p.D=-.25*I))}else I||(p.m=!0)});Q.sort(ib);eb(x)}function b(m,q,B){q.stack.push(t.Qa);G(q.stack,-Math.min(Math.max(F.l,
x.H+2),x.I-2),0,-z);H(q.stack,ca);G(q.stack,0,0,Fa);B(m,q);q.stack.pop();q.stack.pop();q.stack.pop()}function c(m,q){const B=q.stack;m=x.Fa.cb;N(m,q);O(m,"main",0);N(Ja,q);O(Ja,"main",0);N(Ka,q);O(Ka,"main",0);G(B,F.l,0,0);E.aa=V?"left":"right";ya(E,q);B.pop();fb(q,x);N(La,q);Q.forEach(C=>{C.m||(G(B,C.x,C.y,C.z),H(B,(0<=C.s?Math.PI:0)+Math.atan(C.D/C.s)),O(La,"fading",Math.floor(12*(w-C.startTime))),B.pop(),B.pop())})}function e(m,q){m.bindFramebuffer(m.FRAMEBUFFER,null);m.viewport(0,0,y,v);m.disable(m.BLEND);
m.clearColor(0,0,0,1);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.activeTexture(m.TEXTURE1);Ma.i.bindTexture();m.uniform1i(q.A.lighting,1);m.activeTexture(m.TEXTURE0);b(m,q,c)}function d(){{const m=(Date.now()-nb)/1E3;A=m-x.o;w=x.o=m;fa=-1===fa?60:1/A/16+.9375*fa;g.innerHTML=`fps=${Math.round(fa)}`}window.a=Math.max(0,Math.min(1,window.a+A/4*Na(h,"lightDown","lightUp")));Ca(h)%2&&(n=!n);!ra&&Y(h,"fullscreen")&&(ra=l.requestFullscreen());z+=A*Na(h,"down","up");window.cameraZ=z;a();Qa(Ma,{Ua:b,
ab:w,Sa:Q,Na:n});oa(J,e);requestAnimationFrame(d)}const g=document.getElementById("fps"),l=document.getElementById("canvas");var f=window.getComputedStyle(l);const h=new Oa(document.body);X(h,"left",["a","ArrowLeft"]);X(h,"right",["d","ArrowRight"]);X(h,"showLights",["l"]);X(h,"attack",["f"," "]);X(h,"fullscreen",["u"]);X(h,"up",["w","ArrowUp"]);X(h,"down",["s","ArrowDown"]);X(h,"lightUp",["y"]);X(h,"lightDown",["h"]);var k=parseInt(f.getPropertyValue("width"),10);f=parseInt(f.getPropertyValue("height"),
10);let n=!1;var r=window.devicePixelRatio||1;const y=r*k,v=r*f;l.width=y;l.height=v;let z=1.25;const t=Ya(k,f);console.log(t);const u=l.getContext("webgl2",{antialias:!1,alpha:!1});u.enable(u.DEPTH_TEST);u.depthFunc(u.LEQUAL);k=new M({b:u,type:"vertex"},"#version 300 es\nin vec3 a_position;\nin vec2 a_texturePosition;\n\nuniform mat4 u_projection;\n\nout vec4 v_clipSpace;\nout vec2 v_texturePosition;\n\nvoid main() {\n    vec4 position = u_projection * vec4(a_position, 1);\n    // float inverse = 1.f / (1.f - position.z * .2f);\n\n    // vec4 result = vec4(position.x, inverse * position.y * (1.f - .5f * position.z), inverse * position.z, inverse * position.w);\n    // vec4 result = vec4(position.x * position.w, position.y, position.z, position.w);\n    vec4 result = position;\n    gl_Position = result;\n    \n    v_clipSpace = result;\n    v_texturePosition = a_texturePosition;\n}");
f=new M({b:u,type:"fragment"},"#version 300 es\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_lighting;\n\nin vec2 v_texturePosition;\nin vec4 v_clipSpace;\nout vec4 output_color;\n\nvoid main() {\n    vec4 clipSpace = v_clipSpace / v_clipSpace.w; //vec4(.5f * (v_clipSpace.x + 1.f), -.5f * (v_clipSpace.y - 1.f), v_clipSpace.z, v_clipSpace.w) / v_clipSpace.w;\n    clipSpace.x = .5f * (clipSpace.x + 1.f);\n    clipSpace.y = 1.f - .5f * (1.f - clipSpace.y); // why????\n\n    vec4 color = texture(u_texture, v_texturePosition.st);\n    if (color.a == 0.0) {\n        discard;\n    }\n\n    vec4 light = texture(u_lighting, clipSpace.xy);\n    vec3 math = min(light.xyz + color.xyz * light.a, vec3(1.f, 1.f, 1.f));\n    output_color = vec4(math, color.a);\n}");
const J=new na({b:u,K:"projection"});ma(J,k,f).link();const Ma=new Sa(u,y,v,360),K=new AudioContext;k=(m,q)=>ta({b:u,name:m,src:q});const [ob,ha,Ga,kb,pb,T,ia]=await Promise.all([Za(t,k),ta({b:u,src:"assets/floor.png",name:"floor"}),Promise.all([jb(K,"assets/Grunt1.mp3"),jb(K,"assets/Grunt2.mp3"),jb(K,"assets/Grunt3.mp3")]),jb(K,"assets/Theres something here.mp3"),bb(k),k("ceiling","assets/ceiling.png"),Wa(k)]);let P=null;f=220/ha.j;r=ha.w/360;k=70/360;var sa=442/ha.j;f/=2;r*=2;sa/=2;const Ja=new R(ha,
{main:[[r,-.5,-k,1,1,0,-.5,-k,0,1,r,-.5,0,1,sa,0,-.5,0,0,sa,r,.5,0,1,f,0,.5,0,0,f]]});f=T.w/360;f*=2;const Ka=new R(T,{main:[[f,-.5,2.5+k,1,0,0,-.5,2.5+k,0,0,f,-.5,2.5,1,31/T.j,0,-.5,2.5,0,31/T.j,f,.5,2.5,1,144/T.j,0,.5,2.5,0,144/T.j]]}),qa=ia.Ka,ea=ia.bb,da=ia.Ba,F=new Va(4),x=$a({L:{oa:pb,V:ia,Ea:ob},o:0,H:0,I:12,ya:2.5,ha:0,V:F}),La=hb(u),Q=[];let nb=Date.now(),w=0,fa=-1,A=0,L=0,V=!1,E=ea,ra=null;document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(ra=null)});x.O.push(new cb(x,
F.l+2,0,.75));let ca,Ea,Da,Fa;requestAnimationFrame(d);l.onmousemove=()=>{}};
